var reprintsDesk={downloadable:false,issn:null,year:null,docTotalPages:null,permId:null,verifyIdRD:null,price:null,pdfCoupons:false,couponAllowed:'true',cashPdfCoupon:false,anonymous:true,campaignDownloadsIncluded:false,init:function(){var docMetaData=$('#doc_meta_data').metadata();reprintsDesk.docTotalPages=parseInt(docMetaData.plain_total_pages);if(reprintsDesk.docTotalPages==-1){reprintsDesk.docTotalPages=10;}
reprintsDesk.downloadable=docMetaData.download_status;reprintsDesk.issn=docMetaData.issn;reprintsDesk.year=docMetaData.year;reprintsDesk.pdfCoupons=$('#user_meta_data').metadata().pdfCoupons;reprintsDesk.couponAllowed=docMetaData.couponAllowed==='true';reprintsDesk.cashPdfCoupon=$('#user_meta_data').metadata().cashPdfCoupon;reprintsDesk.anonymous=$('#user_meta_data').metadata().anonymous;reprintsDesk.permId=docMetaData.perm_id;reprintsDesk.campaignDownloadsIncluded=$('#user_meta_data').metadata().campaignDownloadsIncluded;var disabled=docMetaData.disableReprintsDeskDownload;var isCrawler=docMetaData.isCrawler;if(disabled){reprintsDesk.setDownloadRD(false);}else if(reprintsDesk.downloadable!=='allowed'&&reprintsDesk.downloadable!=='purchased'){var totalCharge=docMetaData.reprintsDeskDownloadTotalCharge;var verifyId=docMetaData.reprintsDeskDownloadVerifyId;if(totalCharge&&verifyId){reprintsDesk.price=totalCharge;reprintsDesk.verifyIdRD=verifyId;reprintsDesk.setDownloadRD(totalCharge);}else{if(!isCrawler&&!reprintsDesk.anonymous){$.get('/get-price-estimate-rd?issn='+reprintsDesk.issn+'&year='+reprintsDesk.year+'&totalPages='+reprintsDesk.docTotalPages+'&permId='+reprintsDesk.permId,function(e){},"json").done(function(data){if(data.msg==='success'){reprintsDesk.price=data.results.totalCharge;reprintsDesk.verifyIdRD=data.verifyId;reprintsDesk.setDownloadRD(reprintsDesk.price);}else{reprintsDesk.setDownloadRD(false);}}).fail(function(data){reprintsDesk.setDownloadRD(false);});}}}},setDownloadRD:function(price){htmlPriceString='<i class="icon-download-alt"></i> Download PDF';htmlCouponPriceString='<i class="icon-download-alt"></i> Download PDF';htmlCouponPriceStringFreemium='<i class="icon-download-alt"></i> Download PDF';if(price===false){$('#purchaseDownload').html('<i class="icon-download-alt"></i> Download PDF').addClass('disabled');$('#purchaseDownloadFreemiumComplete').html('<strong><i class="icon-download-alt"></i> Download PDF</strong><br><small>Not available</small>').addClass('disabled');return;}else if(reprintsDesk.anonymous||reprintsDesk.campaignDownloadsIncluded){$('#purchaseDownload').html('<i class="icon-download-alt"></i> Download PDF');$('#purchaseDownloadFreemiumComplete').html('<strong><i class="icon-download-alt"></i> Download PDF</strong><br><small>&nbsp;</small>');}else if((reprintsDesk.pdfCoupons||reprintsDesk.cashPdfCoupon)&&reprintsDesk.couponAllowed==='true'){htmlPriceString='<i class="icon-download-alt"></i> Download PDF $'+reprintsDesk.getCouponPriceRD();htmlCouponPriceString='<i class="icon-download-alt"></i> Download PDF $<strike>'+price+'</strike> $'+reprintsDesk.getCouponPriceRD();htmlCouponPriceStringFreemium='<strong><i class="icon-download-alt"></i> Download PDF</strong><br><small> $<strike>'+price+'</strike> $'+reprintsDesk.getCouponPriceRD()+'</small>';}else{htmlPriceString='<i class="icon-download-alt"></i> Download PDF $'+reprintsDesk.getCouponPriceRD();htmlCouponPriceString='<i class="icon-download-alt"></i> Download PDF $'+reprintsDesk.getCouponPriceRD();htmlCouponPriceStringFreemium='<strong><i class="icon-download-alt"></i> Download PDF</strong><br><small> $'+reprintsDesk.getCouponPriceRD()+'</small>';}
$('#purchaseDownload').html(htmlCouponPriceString);$('#purchaseDownloadFreemiumComplete').html(htmlCouponPriceStringFreemium);$('.pdfCouponPrice').html(htmlCouponPriceString);if($('#purchaseType').attr('value')==="reprintsDeskDownload"){$('.pdfPrice').text('$'+reprintsDesk.getCouponPriceRD());}
$('.reprintsDeskPrice').text('$'+reprintsDesk.getCouponPriceRD());if(reprintsDesk.anonymous){$('#docDownloadShortcut, #purchaseDownload').attr('href','#bsModalRental').unbind('click.modal').bind('click.modal',function(e){e.preventDefault();$('#bs'+$(this).attr('href').substr(1)+'Modal').modal('show');});}else{$('#docDownloadShortcut, #purchaseDownload').attr('href','#bsDownloadRDModal').unbind('click.modal').bind('click.modal',function(e){e.preventDefault();$('#bs'+$(this).attr('href').substr(1)+'Modal').modal('show');});}
$('#purchaseDownloadFreemiumComplete').attr('href','#bsDownloadRDModal');$('.docviewCCChoice a').each(function(){if($('#purchaseType').attr('value')==="reprintsDeskDownload"){var _href=$(this).attr('href');$(this).attr('href',_href+"&downloadPriceRD="+reprintsDesk.getCouponPriceRD());}});},getCouponPriceRD:function(){if(reprintsDesk.couponAllowed&&(reprintsDesk.pdfCoupons||reprintsDesk.anonymous)){return(reprintsDesk.price*0.8).toFixed(2);}else if(reprintsDesk.couponAllowed&&reprintsDesk.cashPdfCoupon){return(reprintsDesk.price-reprintsDesk.cashPdfCoupon).toFixed(2);}else{return reprintsDesk.price;}}};$(document).ready(function(){reprintsDesk.init();});;var controlTray;controlTray={init:function(){$(".closeControlTray").click(function(e){e.preventDefault();controlTray.closeControlTray();});$(".showControlTray").click(function(e){e.preventDefault();controlTray.showControlTray();});$('.js-toolbar-swd').click(function(e){e.preventDefault();if($('.js-toolbar-swd').closest('li').hasClass("active")){controlTray.closeControlTray();}else{$('.expandDoc').closest('li').removeClass("active");$('.js-toolbar-swd').closest('li').addClass("active");controlTray.showSwdResults();}});$('.js-toolbar-references').click(function(e){e.preventDefault();if($('.js-toolbar-references').closest('li').hasClass("active")){controlTray.closeControlTray();}else{$('.expandDoc').closest('li').removeClass("active");$('.js-toolbar-references').closest('li').addClass("active");controlTray.showReferences();}});$('.js-toolbar-recommendations').click(function(e){e.preventDefault();if($('.js-toolbar-recommendations').closest('li').hasClass("active")){controlTray.closeControlTray();}else{$('.expandDoc').closest('li').removeClass("active");$('.js-toolbar-recommendations').closest('li').addClass("active");controlTray.showRecommendations();}});$("#shareFB").tooltip();$("#shareTT").tooltip();$("#shareEmail").tooltip();$("#docViewer .page .img").width("auto");if($('#docViewControlTray').length>0&&$(window).width()>767){$('#docViewControlTray').affix({offset:{top:$('#docViewControlTray').offset().top}});}
if($('.js-toolbar-references').length>0){$('.js-toolbar-references .badge').text($('#references ul li').length);}
if($('#related').length>0&&$('#related').is(':visible')){controlTray.logRecImpression();}
if($(window).width()<767){$('.js-toolbar-recommendations').closest('li').removeClass("active");}},showControlTray:function(){if($("#docViewControlTray").is(":visible")&&$(window).width()>767){return false;}
if($(window).width()<767){$('#docViewControlTray').show();$('.dd-docview-toolbar .btn-navbar').click();$.scrollTo('#docViewControlTray',200);return true;}
$('#docViewerWrapper').removeClass('span12').addClass('span9');$('#docViewControlTray').addClass("animated bounceInRight").removeClass("bounceOutRight").show();docViewer.adjustToWindow();docViewer.rotate(0);$(window).scroll();$(".showControlTray").hide();$(".closeControlTray").show();docViewer.zoomReset();return true;},closeControlTray:function(){if(!$("#docViewControlTray").is(":visible")){return false;}
$('#docViewerWrapper').removeClass('span9').addClass('span12');$('#docViewControlTray').removeClass("bounceInRight animated");$("#docViewControlTray").hide();docViewer.adjustToWindow();$(".closeControlTray").hide();$(".showControlTray").show();$(".expandDoc").closest('li').removeClass("active");return true;},showSwdResults:function(e){if(docViewer.isFullScreen()){docViewer.exitFullScreen();}
controlTray.showControlTray();$('#articleTrayTabs a[href="#swdTab"]').tab('show');docViewer.adjustToWindow();$('#swdResults').show();},showRecommendations:function(e){if(docViewer.isFullScreen()){docViewer.exitFullScreen();}
controlTray.showControlTray();$('#articleTrayTabs a[href="#related"]').tab('show');docViewer.adjustToWindow();controlTray.logRecImpression();},showReferences:function(e){if(docViewer.isFullScreen()){docViewer.exitFullScreen();}
controlTray.showControlTray();$('#articleTrayTabs a[href="#references"]').tab('show');docViewer.adjustToWindow();controlTray.logRefImpression();},logRecImpression:function(){$.post("/impression-event",{description:"docview-recommendations",metadata:"{perm_id:'"+docViewer.permId+"'}",impressionId:docViewer.recImpressionId});},logRefImpression:function(){$.post("/impression-event",{description:"docview-references",metadata:"{perm_id:'"+docViewer.permId+"'}",impressionId:docViewer.refImpressionId});},};$(document).ready(function(){controlTray.init();});;(function($){var methods={init:function(options){var o=$.extend({items:1,itemsOnPage:1,pages:0,displayedPages:5,edges:2,currentPage:1,hrefTextPrefix:'#page-',hrefTextSuffix:'',prevText:'Prev',nextText:'Next',ellipseText:'&hellip;',cssStyle:'light-theme',selectOnClick:true,onPageClick:function(pageNumber,event){},onInit:function(){}},options||{});var self=this;o.pages=o.pages?o.pages:Math.ceil(o.items/o.itemsOnPage)?Math.ceil(o.items/o.itemsOnPage):1;o.currentPage=o.currentPage-1;o.halfDisplayed=o.displayedPages/2;this.each(function(){self.addClass(o.cssStyle+' simple-pagination').data('pagination',o);methods._draw.call(self);});o.onInit();return this;},selectPage:function(page){methods._selectPage.call(this,page-1);return this;},prevPage:function(){var o=this.data('pagination');if(o.currentPage>0){methods._selectPage.call(this,o.currentPage-1);}
return this;},nextPage:function(){var o=this.data('pagination');if(o.currentPage<o.pages-1){methods._selectPage.call(this,o.currentPage+1);}
return this;},getPagesCount:function(){return this.data('pagination').pages;},getCurrentPage:function(){return this.data('pagination').currentPage+1;},destroy:function(){this.empty();return this;},redraw:function(){methods._draw.call(this);return this;},disable:function(){var o=this.data('pagination');o.disabled=true;this.data('pagination',o);methods._draw.call(this);return this;},enable:function(){var o=this.data('pagination');o.disabled=false;this.data('pagination',o);methods._draw.call(this);return this;},_draw:function(){var o=this.data('pagination'),interval=methods._getInterval(o),i;methods.destroy.call(this);var $panel=this.prop("tagName")==="UL"?this:$('<ul></ul>').appendTo(this);if(o.prevText){methods._appendItem.call(this,o.currentPage-1,{text:o.prevText,classes:'prev'});}
if(interval.start>0&&o.edges>0){var end=Math.min(o.edges,interval.start);for(i=0;i<end;i++){methods._appendItem.call(this,i);}
if(o.edges<interval.start&&(interval.start-o.edges!=1)){$panel.append('<li class="disabled"><span class="ellipse">'+o.ellipseText+'</span></li>');}else if(interval.start-o.edges==1){methods._appendItem.call(this,o.edges);}}
for(i=interval.start;i<interval.end;i++){methods._appendItem.call(this,i);}
if(interval.end<o.pages&&o.edges>0){if(o.pages-o.edges>interval.end&&(o.pages-o.edges-interval.end!=1)){$panel.append('<li class="disabled"><span class="ellipse">'+o.ellipseText+'</span></li>');}else if(o.pages-o.edges-interval.end==1){methods._appendItem.call(this,interval.end++);}
var begin=Math.max(o.pages-o.edges,interval.end);for(i=begin;i<o.pages;i++){methods._appendItem.call(this,i);}}
if(o.nextText){methods._appendItem.call(this,o.currentPage+1,{text:o.nextText,classes:'next'});}},_getInterval:function(o){return{start:Math.ceil(o.currentPage>o.halfDisplayed?Math.max(Math.min(o.currentPage-o.halfDisplayed,(o.pages-o.displayedPages)),0):0),end:Math.ceil(o.currentPage>o.halfDisplayed?Math.min(o.currentPage+o.halfDisplayed,o.pages):Math.min(o.displayedPages,o.pages))};},_appendItem:function(pageIndex,opts){var self=this,options,$link,o=self.data('pagination'),$linkWrapper=$('<li></li>'),$ul=self.find('ul');pageIndex=pageIndex<0?0:(pageIndex<o.pages?pageIndex:o.pages-1);options=$.extend({text:pageIndex+1,classes:''},opts||{});if(pageIndex==o.currentPage||o.disabled){if(o.disabled||(pageIndex==o.currentPage&&(options.classes=='prev'||options.classes=='next'))){$linkWrapper.addClass('disabled');}else{$linkWrapper.addClass('active');}
$link=$('<span class="current">'+(options.text)+'</span>');}else{$link=$('<a href="'+o.hrefTextPrefix+(pageIndex+1)+o.hrefTextSuffix+'" class="page-link">'+(options.text)+'</a>');$link.click(function(event){return methods._selectPage.call(self,pageIndex,event);});}
if(options.classes){$link.addClass(options.classes);}
$linkWrapper.append($link);if($ul.length){$ul.append($linkWrapper);}else{self.append($linkWrapper);}},_selectPage:function(pageIndex,event){var o=this.data('pagination');o.currentPage=pageIndex;if(o.selectOnClick){methods._draw.call(this);}
return o.onPageClick(pageIndex+1,event);}};$.fn.pagination=function(method){if(methods[method]&&method.charAt(0)!='_'){return methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist on jQuery.pagination');}};})(jQuery);;jQuery.extend({highlight:function(node,re,nodeName,className){if(node.nodeType===3){var match=node.data.match(re);if(match){var highlight=document.createElement(nodeName||'span');highlight.className=className||'highlight';var wordNode=node.splitText(match.index);wordNode.splitText(match[0].length);var wordClone=wordNode.cloneNode(true);highlight.appendChild(wordClone);wordNode.parentNode.replaceChild(highlight,wordNode);return 1;}}else if((node.nodeType===1&&node.childNodes)&&!/(script|style)/i.test(node.tagName)&&!(node.tagName===nodeName.toUpperCase()&&node.className===className)){for(var i=0;i<node.childNodes.length;i++){i+=jQuery.highlight(node.childNodes[i],re,nodeName,className);}}
return 0;}});jQuery.fn.unhighlight=function(options){var settings={className:'highlight',element:'span'};jQuery.extend(settings,options);return this.find(settings.element+"."+settings.className).each(function(){var parent=this.parentNode;parent.replaceChild(this.firstChild,this);parent.normalize();}).end();};jQuery.fn.highlight=function(words,options){var settings={className:'highlight',element:'span',caseSensitive:false,wordsOnly:false};jQuery.extend(settings,options);if(words.constructor===String){words=[words];}
words=jQuery.grep(words,function(word,i){return word!='';});words=jQuery.map(words,function(word,i){var w=word.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");w=w.replace(/fi/,"(?:fi|ﬁ)");return w;});if(words.length==0){return this;};var flag=settings.caseSensitive?"":"i";var pattern="("+words.join("|")+")";if(settings.wordsOnly){pattern="\\b"+pattern+"\\b";}
var re=new RegExp(pattern,flag);return this.each(function(){jQuery.highlight(this,re,settings.element,settings.className);});};;;(function(factory){if(typeof define==='function'&&define.amd){define(factory);}else{window.purl=factory();}})(function(){var tag2attr={a:'href',img:'src',form:'action',base:'href',script:'src',iframe:'src',link:'href',embed:'src',object:'data'},key=['source','protocol','authority','userInfo','user','password','host','port','relative','path','directory','file','query','fragment'],aliases={'anchor':'fragment'},parser={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},isint=/^[0-9]+$/;function parseUri(url,strictMode){var str=decodeURI(url),res=parser[strictMode||false?'strict':'loose'].exec(str),uri={attr:{},param:{},seg:{}},i=14;while(i--){uri.attr[key[i]]=res[i]||'';}
uri.param['query']=parseString(uri.attr['query']);uri.param['fragment']=parseString(uri.attr['fragment']);uri.seg['path']=uri.attr.path.replace(/^\/+|\/+$/g,'').split('/');uri.seg['fragment']=uri.attr.fragment.replace(/^\/+|\/+$/g,'').split('/');uri.attr['base']=uri.attr.host?(uri.attr.protocol?uri.attr.protocol+'://'+uri.attr.host:uri.attr.host)+(uri.attr.port?':'+uri.attr.port:''):'';return uri;}
function getAttrName(elm){var tn=elm.tagName;if(typeof tn!=='undefined')return tag2attr[tn.toLowerCase()];return tn;}
function promote(parent,key){if(parent[key].length===0)return parent[key]={};var t={};for(var i in parent[key])t[i]=parent[key][i];parent[key]=t;return t;}
function parse(parts,parent,key,val){var part=parts.shift();if(!part){if(isArray(parent[key])){parent[key].push(val);}else if('object'==typeof parent[key]){parent[key]=val;}else if('undefined'==typeof parent[key]){parent[key]=val;}else{parent[key]=[parent[key],val];}}else{var obj=parent[key]=parent[key]||[];if(']'==part){if(isArray(obj)){if(''!==val)obj.push(val);}else if('object'==typeof obj){obj[keys(obj).length]=val;}else{obj=parent[key]=[parent[key],val];}}else if(~part.indexOf(']')){part=part.substr(0,part.length-1);if(!isint.test(part)&&isArray(obj))obj=promote(parent,key);parse(parts,obj,part,val);}else{if(!isint.test(part)&&isArray(obj))obj=promote(parent,key);parse(parts,obj,part,val);}}}
function merge(parent,key,val){if(~key.indexOf(']')){var parts=key.split('[');parse(parts,parent,'base',val);}else{if(!isint.test(key)&&isArray(parent.base)){var t={};for(var k in parent.base)t[k]=parent.base[k];parent.base=t;}
if(key!==''){set(parent.base,key,val);}}
return parent;}
function parseString(str){return reduce(String(str).split(/&|;/),function(ret,pair){try{pair=decodeURIComponent(pair.replace(/\+/g,' '));}catch(e){}
var eql=pair.indexOf('='),brace=lastBraceInKey(pair),key=pair.substr(0,brace||eql),val=pair.substr(brace||eql,pair.length);val=val.substr(val.indexOf('=')+1,val.length);if(key===''){key=pair;val='';}
return merge(ret,key,val);},{base:{}}).base;}
function set(obj,key,val){var v=obj[key];if(typeof v==='undefined'){obj[key]=val;}else if(isArray(v)){v.push(val);}else{obj[key]=[v,val];}}
function lastBraceInKey(str){var len=str.length,brace,c;for(var i=0;i<len;++i){c=str[i];if(']'==c)brace=false;if('['==c)brace=true;if('='==c&&!brace)return i;}}
function reduce(obj,accumulator){var i=0,l=obj.length>>0,curr=arguments[2];while(i<l){if(i in obj)curr=accumulator.call(undefined,curr,obj[i],i,obj);++i;}
return curr;}
function isArray(vArg){return Object.prototype.toString.call(vArg)==="[object Array]";}
function keys(obj){var key_array=[];for(var prop in obj){if(obj.hasOwnProperty(prop))key_array.push(prop);}
return key_array;}
function purl(url,strictMode){if(arguments.length===1&&url===true){strictMode=true;url=undefined;}
strictMode=strictMode||false;url=url||window.location.toString();return{data:parseUri(url,strictMode),attr:function(attr){attr=aliases[attr]||attr;return typeof attr!=='undefined'?this.data.attr[attr]:this.data.attr;},param:function(param){return typeof param!=='undefined'?this.data.param.query[param]:this.data.param.query;},fparam:function(param){return typeof param!=='undefined'?this.data.param.fragment[param]:this.data.param.fragment;},segment:function(seg){if(typeof seg==='undefined'){return this.data.seg.path;}else{seg=seg<0?this.data.seg.path.length+seg:seg-1;return this.data.seg.path[seg];}},fsegment:function(seg){if(typeof seg==='undefined'){return this.data.seg.fragment;}else{seg=seg<0?this.data.seg.fragment.length+seg:seg-1;return this.data.seg.fragment[seg];}}};}
purl.jQuery=function($){if($!=null){$.fn.url=function(strictMode){var url='';if(this.length){url=$(this).attr(getAttrName(this[0]))||'';}
return purl(url,strictMode);};$.url=purl;}};purl.jQuery(window.jQuery);return purl;});;var purchase=(function($){var print;var init=function(){$("#purchaseDownload").click(function(e){if(!($(this).hasClass('purchaseRequest'))){if(docViewer.loggedIn){trackEvent('doc-viewer','download-modal/open',docViewer.permId,false);}else{trackEvent('doc-viewer','download-modal/open/not-login',docViewer.permId,false);}}});$('#purchaseOptions .purchaseRequest').click(function(e){var type=$(this).attr('href').substr(1);if(docViewer.loggedIn){trackEvent('doc-viewer','request-'+type,docViewer.permId,false);}else{trackEvent('doc-viewer','request-'+type+'/not-login',docViewer.permId,false);}});};return{init:init,print:print};})(jQuery);purchase.print=(function($){var docParams;var printPrice;var totalPrice;var printButton;var printShortcut;var pageSelector;var printConfirmButton;var paidPageCount;var isActive;var test=false;var setVars=function(){docParams=$('#priceMetadata').metadata();docViewerParams=$('#doc_meta_data').metadata();docPermId=docParams.permId;printPrice=parseInt(docParams.printPrice);printButton=$('#purchasePrint');pageSelector=$('#pageSelector');printConfirmButton=$('#purchasePrintConfirm');paidPageCount=pageSelector.find('.pageThumb.selected.paid').length;printPagesLeft=parseInt(docParams.printPagesLeft);isActive=true;};var getSelectedPages=function(filter){var selection;if(filter==='unpaid'){selection='#pageSelector .pageThumb.selected:not(.paid)';}else{selection='#pageSelector .pageThumb.selected';}
var printPages='';$(selection).each(function(){printPages+=','+$(this).text();});printPages=printPages.substring(1);return printPages;};var togglePrintConfirmButton=function(){var pageCount=pageSelector.find('.pageThumb.selected').length;paidPageCount=pageSelector.find('.pageThumb.selected.paid').length;var printIncluded=$('#purchasePrint').is('.printIncluded');$.cookie('printPages-'+docPermId,getSelectedPages(),{path:'/'});if(pageCount>0){totalPrice=(pageCount-paidPageCount)*printPrice;$('.newPrintPages').text('');printConfirmButton.unbind('click').bind('click',function(e){e.preventDefault();if(printConfirmButton.hasClass('disabled')){return;}
if(docViewerParams.internal_rental_state==='rentable'){rentalActions.useRentalSlot(e,'print');}else{printActions.usePrintSlot(e);}});var pageCountWithText=(pageCount>1)?pageCount+' pages':pageCount+' page';printConfirmButton.find('.printPageCount').text(pageCountWithText);if(!printIncluded){printConfirmButton.find('.printPageCost').text(totalPrice);}
printConfirmButton.toggleClass('disabled',false);}else{totalPrice=0;printConfirmButton.find('.printPageCount').text(pageCount+' pages');if(!printIncluded){printConfirmButton.find('.printPageCost').text(totalPrice);}
printConfirmButton.toggleClass('disabled',true);}};var init=function(){if($('#priceMetadata').length<=0){return;}
setVars();printConfirmButton.toggleClass('disabled',true);if($.cookie('printPages-'+docPermId)){var printPages=$.cookie('printPages-'+docPermId);printPages=printPages.split(',');for(var page in printPages){pageSelector.find('.pageThumb:eq('+(printPages[page]-1)+')').addClass('selected');}
paidPageCount=pageSelector.find('.pageThumb.selected.paid').length;togglePrintConfirmButton();}
pageSelector.find('.pageThumb').click(function(e){e.preventDefault();var newSelectedPages=pageSelector.find('.pageThumb.selected').length-paidPageCount;var remainingPages=printPagesLeft-newSelectedPages;if($(this).hasClass('selected')&&!$(this).hasClass('paid')){$(this).toggleClass('selected');$('#bsPrintModalNew .alert-error').addClass('hide');}else if($(this).hasClass('paid')){$(this).toggleClass('selected');}else{if(printPagesLeft<=newSelectedPages){var userErrorMsg="You don't have enough free pages available this month.";$('#bsPrintModalNew .alert-error').html(userErrorMsg).removeClass('hide');}else{$(this).toggleClass('selected');$('#bsPrintModalNew .alert-error').addClass('hide');}}
togglePrintConfirmButton();trackEvent('doc-viewer','print-options/select-page',docViewer.permId,false);});$('.printUrl').click(function(){trackEvent('doc-viewer','print-purchase/print',docViewer.permId,false);});$('#printAllPages').click(function(){pageSelector.find('.pageThumb').each(function(){if(!$(this).hasClass('selected')){$(this).trigger('click');}});});$('#clearAllPages').click(function(){pageSelector.find('.pageThumb').each(function(){if($(this).hasClass('selected')){$(this).trigger('click');}});});};return{init:init,getSelectedPages:getSelectedPages,};})(jQuery);$(document).ready(function(){purchase.init();if($('#docPrintOptions').length>0){purchase.print.init();}});