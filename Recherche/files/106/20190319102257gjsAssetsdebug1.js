this.Handlebars={};(function(Handlebars){Handlebars.VERSION="1.0.0-rc.3";Handlebars.COMPILER_REVISION=2;Handlebars.REVISION_CHANGES={1:'<= 1.0.rc.2',2:'>= 1.0.0-rc.3'};Handlebars.helpers={};Handlebars.partials={};Handlebars.registerHelper=function(name,fn,inverse){if(inverse){fn.not=inverse;}
this.helpers[name]=fn;};Handlebars.registerPartial=function(name,str){this.partials[name]=str;};Handlebars.registerHelper('helperMissing',function(arg){if(arguments.length===2){return undefined;}else{throw new Error("Could not find property '"+arg+"'");}});var toString=Object.prototype.toString,functionType="[object Function]";Handlebars.registerHelper('blockHelperMissing',function(context,options){var inverse=options.inverse||function(){},fn=options.fn;var ret="";var type=toString.call(context);if(type===functionType){context=context.call(this);}
if(context===true){return fn(this);}else if(context===false||context==null){return inverse(this);}else if(type==="[object Array]"){if(context.length>0){return Handlebars.helpers.each(context,options);}else{return inverse(this);}}else{return fn(context);}});Handlebars.K=function(){};Handlebars.createFrame=Object.create||function(object){Handlebars.K.prototype=object;var obj=new Handlebars.K();Handlebars.K.prototype=null;return obj;};Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:'debug',1:'info',2:'warn',3:'error'},log:function(level,obj){if(Handlebars.logger.level<=level){var method=Handlebars.logger.methodMap[level];if(typeof console!=='undefined'&&console[method]){console[method].call(console,obj);}}}};Handlebars.log=function(level,obj){Handlebars.logger.log(level,obj);};Handlebars.registerHelper('each',function(context,options){var fn=options.fn,inverse=options.inverse;var i=0,ret="",data;if(options.data){data=Handlebars.createFrame(options.data);}
if(context&&typeof context==='object'){if(context instanceof Array){for(var j=context.length;i<j;i++){if(data){data.index=i;}
ret=ret+fn(context[i],{data:data});}}else{for(var key in context){if(context.hasOwnProperty(key)){if(data){data.key=key;}
ret=ret+fn(context[key],{data:data});i++;}}}}
if(i===0){ret=inverse(this);}
return ret;});Handlebars.registerHelper('if',function(context,options){var type=toString.call(context);if(type===functionType){context=context.call(this);}
if(!context||Handlebars.Utils.isEmpty(context)){return options.inverse(this);}else{return options.fn(this);}});Handlebars.registerHelper('unless',function(context,options){var fn=options.fn,inverse=options.inverse;options.fn=inverse;options.inverse=fn;return Handlebars.helpers['if'].call(this,context,options);});Handlebars.registerHelper('with',function(context,options){return options.fn(context);});Handlebars.registerHelper('log',function(context,options){var level=options.data&&options.data.level!=null?parseInt(options.data.level,10):1;Handlebars.log(level,context);});}(this.Handlebars));;var handlebars=(function(){var parser={trace:function trace(){},yy:{},symbols_:{"error":2,"root":3,"program":4,"EOF":5,"simpleInverse":6,"statements":7,"statement":8,"openInverse":9,"closeBlock":10,"openBlock":11,"mustache":12,"partial":13,"CONTENT":14,"COMMENT":15,"OPEN_BLOCK":16,"inMustache":17,"CLOSE":18,"OPEN_INVERSE":19,"OPEN_ENDBLOCK":20,"path":21,"OPEN":22,"OPEN_UNESCAPED":23,"OPEN_PARTIAL":24,"partialName":25,"params":26,"hash":27,"DATA":28,"param":29,"STRING":30,"INTEGER":31,"BOOLEAN":32,"hashSegments":33,"hashSegment":34,"ID":35,"EQUALS":36,"PARTIAL_NAME":37,"pathSegments":38,"SEP":39,"$accept":0,"$end":1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"DATA",30:"STRING",31:"INTEGER",32:"BOOLEAN",35:"ID",36:"EQUALS",37:"PARTIAL_NAME",39:"SEP"},productions_:[0,[3,2],[4,2],[4,3],[4,2],[4,1],[4,1],[4,0],[7,1],[7,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[6,2],[17,3],[17,2],[17,2],[17,1],[17,1],[26,2],[26,1],[29,1],[29,1],[29,1],[29,1],[29,1],[27,1],[33,2],[33,1],[34,3],[34,3],[34,3],[34,3],[34,3],[25,1],[21,1],[38,3],[38,1]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return $$[$0-1];break;case 2:this.$=new yy.ProgramNode([],$$[$0]);break;case 3:this.$=new yy.ProgramNode($$[$0-2],$$[$0]);break;case 4:this.$=new yy.ProgramNode($$[$0-1],[]);break;case 5:this.$=new yy.ProgramNode($$[$0]);break;case 6:this.$=new yy.ProgramNode([],[]);break;case 7:this.$=new yy.ProgramNode([]);break;case 8:this.$=[$$[$0]];break;case 9:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 10:this.$=new yy.BlockNode($$[$0-2],$$[$0-1].inverse,$$[$0-1],$$[$0]);break;case 11:this.$=new yy.BlockNode($$[$0-2],$$[$0-1],$$[$0-1].inverse,$$[$0]);break;case 12:this.$=$$[$0];break;case 13:this.$=$$[$0];break;case 14:this.$=new yy.ContentNode($$[$0]);break;case 15:this.$=new yy.CommentNode($$[$0]);break;case 16:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 17:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 18:this.$=$$[$0-1];break;case 19:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1]);break;case 20:this.$=new yy.MustacheNode($$[$0-1][0],$$[$0-1][1],true);break;case 21:this.$=new yy.PartialNode($$[$0-1]);break;case 22:this.$=new yy.PartialNode($$[$0-2],$$[$0-1]);break;case 23:break;case 24:this.$=[[$$[$0-2]].concat($$[$0-1]),$$[$0]];break;case 25:this.$=[[$$[$0-1]].concat($$[$0]),null];break;case 26:this.$=[[$$[$0-1]],$$[$0]];break;case 27:this.$=[[$$[$0]],null];break;case 28:this.$=[[new yy.DataNode($$[$0])],null];break;case 29:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 30:this.$=[$$[$0]];break;case 31:this.$=$$[$0];break;case 32:this.$=new yy.StringNode($$[$0]);break;case 33:this.$=new yy.IntegerNode($$[$0]);break;case 34:this.$=new yy.BooleanNode($$[$0]);break;case 35:this.$=new yy.DataNode($$[$0]);break;case 36:this.$=new yy.HashNode($$[$0]);break;case 37:$$[$0-1].push($$[$0]);this.$=$$[$0-1];break;case 38:this.$=[$$[$0]];break;case 39:this.$=[$$[$0-2],$$[$0]];break;case 40:this.$=[$$[$0-2],new yy.StringNode($$[$0])];break;case 41:this.$=[$$[$0-2],new yy.IntegerNode($$[$0])];break;case 42:this.$=[$$[$0-2],new yy.BooleanNode($$[$0])];break;case 43:this.$=[$$[$0-2],new yy.DataNode($$[$0])];break;case 44:this.$=new yy.PartialNameNode($$[$0]);break;case 45:this.$=new yy.IdNode($$[$0]);break;case 46:$$[$0-2].push($$[$0]);this.$=$$[$0-2];break;case 47:this.$=[$$[$0]];break;}},table:[{3:1,4:2,5:[2,7],6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],22:[1,14],23:[1,15],24:[1,16]},{1:[3]},{5:[1,17]},{5:[2,6],7:18,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,6],22:[1,14],23:[1,15],24:[1,16]},{5:[2,5],6:20,8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,5],22:[1,14],23:[1,15],24:[1,16]},{17:23,18:[1,22],21:24,28:[1,25],35:[1,27],38:26},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{4:28,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],24:[1,16]},{4:29,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],24:[1,16]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{17:30,21:24,28:[1,25],35:[1,27],38:26},{17:31,21:24,28:[1,25],35:[1,27],38:26},{17:32,21:24,28:[1,25],35:[1,27],38:26},{25:33,37:[1,34]},{1:[2,1]},{5:[2,2],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,2],22:[1,14],23:[1,15],24:[1,16]},{17:23,21:24,28:[1,25],35:[1,27],38:26},{5:[2,4],7:35,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,4],22:[1,14],23:[1,15],24:[1,16]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,23],14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],24:[2,23]},{18:[1,36]},{18:[2,27],21:41,26:37,27:38,28:[1,45],29:39,30:[1,42],31:[1,43],32:[1,44],33:40,34:46,35:[1,47],38:26},{18:[2,28]},{18:[2,45],28:[2,45],30:[2,45],31:[2,45],32:[2,45],35:[2,45],39:[1,48]},{18:[2,47],28:[2,47],30:[2,47],31:[2,47],32:[2,47],35:[2,47],39:[2,47]},{10:49,20:[1,50]},{10:51,20:[1,50]},{18:[1,52]},{18:[1,53]},{18:[1,54]},{18:[1,55],21:56,35:[1,27],38:26},{18:[2,44],35:[2,44]},{5:[2,3],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,3],22:[1,14],23:[1,15],24:[1,16]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{18:[2,25],21:41,27:57,28:[1,45],29:58,30:[1,42],31:[1,43],32:[1,44],33:40,34:46,35:[1,47],38:26},{18:[2,26]},{18:[2,30],28:[2,30],30:[2,30],31:[2,30],32:[2,30],35:[2,30]},{18:[2,36],34:59,35:[1,60]},{18:[2,31],28:[2,31],30:[2,31],31:[2,31],32:[2,31],35:[2,31]},{18:[2,32],28:[2,32],30:[2,32],31:[2,32],32:[2,32],35:[2,32]},{18:[2,33],28:[2,33],30:[2,33],31:[2,33],32:[2,33],35:[2,33]},{18:[2,34],28:[2,34],30:[2,34],31:[2,34],32:[2,34],35:[2,34]},{18:[2,35],28:[2,35],30:[2,35],31:[2,35],32:[2,35],35:[2,35]},{18:[2,38],35:[2,38]},{18:[2,47],28:[2,47],30:[2,47],31:[2,47],32:[2,47],35:[2,47],36:[1,61],39:[2,47]},{35:[1,62]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{21:63,35:[1,27],38:26},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],24:[2,21]},{18:[1,64]},{18:[2,24]},{18:[2,29],28:[2,29],30:[2,29],31:[2,29],32:[2,29],35:[2,29]},{18:[2,37],35:[2,37]},{36:[1,61]},{21:65,28:[1,69],30:[1,66],31:[1,67],32:[1,68],35:[1,27],38:26},{18:[2,46],28:[2,46],30:[2,46],31:[2,46],32:[2,46],35:[2,46],39:[2,46]},{18:[1,70]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],24:[2,22]},{18:[2,39],35:[2,39]},{18:[2,40],35:[2,40]},{18:[2,41],35:[2,41]},{18:[2,42],35:[2,42]},{18:[2,43],35:[2,43]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]}],defaultActions:{17:[2,1],25:[2,28],38:[2,26],57:[2,24]},parseError:function parseError(str,hash){throw new Error(str);},parse:function parse(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1;this.lexer.setInput(input);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;this.yy.parser=this;if(typeof this.lexer.yylloc=="undefined")
this.lexer.yylloc={};var yyloc=this.lexer.yylloc;lstack.push(yyloc);var ranges=this.lexer.options&&this.lexer.options.ranges;if(typeof this.yy.parseError==="function")
this.parseError=this.yy.parseError;function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n;}
function lex(){var token;token=self.lexer.lex()||1;if(typeof token!=="number"){token=self.symbols_[token]||token;}
return token;}
var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;while(true){state=stack[stack.length-1];if(this.defaultActions[state]){action=this.defaultActions[state];}else{if(symbol===null||typeof symbol=="undefined"){symbol=lex();}
action=table[state]&&table[state][symbol];}
if(typeof action==="undefined"||!action.length||!action[0]){var errStr="";if(!recovering){expected=[];for(p in table[state])
if(this.terminals_[p]&&p>2){expected.push("'"+this.terminals_[p]+"'");}
if(this.lexer.showPosition){errStr="Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'";}else{errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==1?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'");}
this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected});}}
if(action[0]instanceof Array&&action.length>1){throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);}
switch(action[0]){case 1:stack.push(symbol);vstack.push(this.lexer.yytext);lstack.push(this.lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;if(recovering>0)
recovering--;}else{symbol=preErrorSymbol;preErrorSymbol=null;}
break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};if(ranges){yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]];}
r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack);if(typeof r!=="undefined"){return r;}
if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len);}
stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true;}}
return true;}};var lexer=(function(){var lexer=({EOF:1,parseError:function parseError(str,hash){if(this.yy.parser){this.yy.parser.parseError(str,hash);}else{throw new Error(str);}},setInput:function(input){this._input=input;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match='';this.conditionStack=['INITIAL'];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges)this.yylloc.range=[0,0];this.offset=0;return this;},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.offset++;this.match+=ch;this.matched+=ch;var lines=ch.match(/(?:\r\n?|\n).*/g);if(lines){this.yylineno++;this.yylloc.last_line++;}else{this.yylloc.last_column++;}
if(this.options.ranges)this.yylloc.range[1]++;this._input=this._input.slice(1);return ch;},unput:function(ch){var len=ch.length;var lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-len-1);this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);if(lines.length-1)this.yylineno-=lines.length-1;var r=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len};if(this.options.ranges){this.yylloc.range=[r[0],r[0]+this.yyleng-len];}
return this;},more:function(){this._more=true;return this;},less:function(n){this.unput(this.match.slice(n));},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?'...':'')+past.substr(-20).replace(/\n/g,"");},upcomingInput:function(){var next=this.match;if(next.length<20){next+=this._input.substr(0,20-next.length);}
return(next.substr(0,20)+(next.length>20?'...':'')).replace(/\n/g,"");},showPosition:function(){var pre=this.pastInput();var c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^";},next:function(){if(this.done){return this.EOF;}
if(!this._input)this.done=true;var token,match,tempMatch,index,col,lines;if(!this._more){this.yytext='';this.match='';}
var rules=this._currentRules();for(var i=0;i<rules.length;i++){tempMatch=this._input.match(this.rules[rules[i]]);if(tempMatch&&(!match||tempMatch[0].length>match[0].length)){match=tempMatch;index=i;if(!this.options.flex)break;}}
if(match){lines=match[0].match(/(?:\r\n?|\n).*/g);if(lines)this.yylineno+=lines.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;if(this.options.ranges){this.yylloc.range=[this.offset,this.offset+=this.yyleng];}
this._more=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,rules[index],this.conditionStack[this.conditionStack.length-1]);if(this.done&&this._input)this.done=false;if(token)return token;else return;}
if(this._input===""){return this.EOF;}else{return this.parseError('Lexical error on line '+(this.yylineno+1)+'. Unrecognized text.\n'+this.showPosition(),{text:"",token:null,line:this.yylineno});}},lex:function lex(){var r=this.next();if(typeof r!=='undefined'){return r;}else{return this.lex();}},begin:function begin(condition){this.conditionStack.push(condition);},popState:function popState(){return this.conditionStack.pop();},_currentRules:function _currentRules(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules;},topState:function(){return this.conditionStack[this.conditionStack.length-2];},pushState:function begin(condition){this.begin(condition);}});lexer.options={};lexer.performAction=function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START
switch($avoiding_name_collisions){case 0:if(yy_.yytext.slice(-1)!=="\\")this.begin("mu");if(yy_.yytext.slice(-1)==="\\")yy_.yytext=yy_.yytext.substr(0,yy_.yyleng-1),this.begin("emu");if(yy_.yytext)return 14;break;case 1:return 14;break;case 2:if(yy_.yytext.slice(-1)!=="\\")this.popState();if(yy_.yytext.slice(-1)==="\\")yy_.yytext=yy_.yytext.substr(0,yy_.yyleng-1);return 14;break;case 3:yy_.yytext=yy_.yytext.substr(0,yy_.yyleng-4);this.popState();return 15;break;case 4:this.begin("par");return 24;break;case 5:return 16;break;case 6:return 20;break;case 7:return 19;break;case 8:return 19;break;case 9:return 23;break;case 10:return 23;break;case 11:this.popState();this.begin('com');break;case 12:yy_.yytext=yy_.yytext.substr(3,yy_.yyleng-5);this.popState();return 15;break;case 13:return 22;break;case 14:return 36;break;case 15:return 35;break;case 16:return 35;break;case 17:return 39;break;case 18:break;case 19:this.popState();return 18;break;case 20:this.popState();return 18;break;case 21:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2).replace(/\\"/g,'"');return 30;break;case 22:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2).replace(/\\'/g,"'");return 30;break;case 23:yy_.yytext=yy_.yytext.substr(1);return 28;break;case 24:return 32;break;case 25:return 32;break;case 26:return 31;break;case 27:return 35;break;case 28:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2);return 35;break;case 29:return'INVALID';break;case 30:break;case 31:this.popState();return 37;break;case 32:return 5;break;}};lexer.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[} ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@[a-zA-Z]+)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:[0-9]+(?=[}\s]))/,/^(?:[a-zA-Z0-9_$-]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:\s+)/,/^(?:[a-zA-Z0-9_$-/]+)/,/^(?:$)/];lexer.conditions={"mu":{"rules":[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,32],"inclusive":false},"emu":{"rules":[2],"inclusive":false},"com":{"rules":[3],"inclusive":false},"par":{"rules":[30,31],"inclusive":false},"INITIAL":{"rules":[0,1,32],"inclusive":true}};return lexer;})()
parser.lexer=lexer;function Parser(){this.yy={};}Parser.prototype=parser;parser.Parser=Parser;return new Parser;})();;Handlebars.Parser=handlebars;Handlebars.parse=function(input){if(input.constructor===Handlebars.AST.ProgramNode){return input;}
Handlebars.Parser.yy=Handlebars.AST;return Handlebars.Parser.parse(input);};Handlebars.print=function(ast){return new Handlebars.PrintVisitor().accept(ast);};;(function(){Handlebars.AST={};Handlebars.AST.ProgramNode=function(statements,inverse){this.type="program";this.statements=statements;if(inverse){this.inverse=new Handlebars.AST.ProgramNode(inverse);}};Handlebars.AST.MustacheNode=function(rawParams,hash,unescaped){this.type="mustache";this.escaped=!unescaped;this.hash=hash;var id=this.id=rawParams[0];var params=this.params=rawParams.slice(1);var eligibleHelper=this.eligibleHelper=id.isSimple;this.isHelper=eligibleHelper&&(params.length||hash);};Handlebars.AST.PartialNode=function(partialName,context){this.type="partial";this.partialName=partialName;this.context=context;};var verifyMatch=function(open,close){if(open.original!==close.original){throw new Handlebars.Exception(open.original+" doesn't match "+close.original);}};Handlebars.AST.BlockNode=function(mustache,program,inverse,close){verifyMatch(mustache.id,close);this.type="block";this.mustache=mustache;this.program=program;this.inverse=inverse;if(this.inverse&&!this.program){this.isInverse=true;}};Handlebars.AST.ContentNode=function(string){this.type="content";this.string=string;};Handlebars.AST.HashNode=function(pairs){this.type="hash";this.pairs=pairs;};Handlebars.AST.IdNode=function(parts){this.type="ID";this.original=parts.join(".");var dig=[],depth=0;for(var i=0,l=parts.length;i<l;i++){var part=parts[i];if(part===".."||part==="."||part==="this"){if(dig.length>0){throw new Handlebars.Exception("Invalid path: "+this.original);}
else if(part===".."){depth++;}
else{this.isScoped=true;}}
else{dig.push(part);}}
this.parts=dig;this.string=dig.join('.');this.depth=depth;this.isSimple=parts.length===1&&!this.isScoped&&depth===0;this.stringModeValue=this.string;};Handlebars.AST.PartialNameNode=function(name){this.type="PARTIAL_NAME";this.name=name;};Handlebars.AST.DataNode=function(id){this.type="DATA";this.id=id;};Handlebars.AST.StringNode=function(string){this.type="STRING";this.string=string;this.stringModeValue=string;};Handlebars.AST.IntegerNode=function(integer){this.type="INTEGER";this.integer=integer;this.stringModeValue=Number(integer);};Handlebars.AST.BooleanNode=function(bool){this.type="BOOLEAN";this.bool=bool;this.stringModeValue=bool==="true";};Handlebars.AST.CommentNode=function(comment){this.type="comment";this.comment=comment;};})();;var errorProps=['description','fileName','lineNumber','message','name','number','stack'];Handlebars.Exception=function(message){var tmp=Error.prototype.constructor.apply(this,arguments);for(var idx=0;idx<errorProps.length;idx++){this[errorProps[idx]]=tmp[errorProps[idx]];}};Handlebars.Exception.prototype=new Error();Handlebars.SafeString=function(string){this.string=string;};Handlebars.SafeString.prototype.toString=function(){return this.string.toString();};(function(){var escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var badChars=/[&<>"'`]/g;var possible=/[&<>"'`]/;var escapeChar=function(chr){return escape[chr]||"&amp;";};Handlebars.Utils={escapeExpression:function(string){if(string instanceof Handlebars.SafeString){return string.toString();}else if(string==null||string===false){return"";}
if(!possible.test(string)){return string;}
return string.replace(badChars,escapeChar);},isEmpty:function(value){if(!value&&value!==0){return true;}else if(Object.prototype.toString.call(value)==="[object Array]"&&value.length===0){return true;}else{return false;}}};})();;Handlebars.Compiler=function(){};Handlebars.JavaScriptCompiler=function(){};(function(Compiler,JavaScriptCompiler){Compiler.prototype={compiler:Compiler,disassemble:function(){var opcodes=this.opcodes,opcode,out=[],params,param;for(var i=0,l=opcodes.length;i<l;i++){opcode=opcodes[i];if(opcode.opcode==='DECLARE'){out.push("DECLARE "+opcode.name+"="+opcode.value);}else{params=[];for(var j=0;j<opcode.args.length;j++){param=opcode.args[j];if(typeof param==="string"){param="\""+param.replace("\n","\\n")+"\"";}
params.push(param);}
out.push(opcode.opcode+" "+params.join(" "));}}
return out.join("\n");},equals:function(other){var len=this.opcodes.length;if(other.opcodes.length!==len){return false;}
for(var i=0;i<len;i++){var opcode=this.opcodes[i],otherOpcode=other.opcodes[i];if(opcode.opcode!==otherOpcode.opcode||opcode.args.length!==otherOpcode.args.length){return false;}
for(var j=0;j<opcode.args.length;j++){if(opcode.args[j]!==otherOpcode.args[j]){return false;}}}
return true;},guid:0,compile:function(program,options){this.children=[];this.depths={list:[]};this.options=options;var knownHelpers=this.options.knownHelpers;this.options.knownHelpers={'helperMissing':true,'blockHelperMissing':true,'each':true,'if':true,'unless':true,'with':true,'log':true};if(knownHelpers){for(var name in knownHelpers){this.options.knownHelpers[name]=knownHelpers[name];}}
return this.program(program);},accept:function(node){return this[node.type](node);},program:function(program){var statements=program.statements,statement;this.opcodes=[];for(var i=0,l=statements.length;i<l;i++){statement=statements[i];this[statement.type](statement);}
this.isSimple=l===1;this.depths.list=this.depths.list.sort(function(a,b){return a-b;});return this;},compileProgram:function(program){var result=new this.compiler().compile(program,this.options);var guid=this.guid++,depth;this.usePartial=this.usePartial||result.usePartial;this.children[guid]=result;for(var i=0,l=result.depths.list.length;i<l;i++){depth=result.depths.list[i];if(depth<2){continue;}
else{this.addDepth(depth-1);}}
return guid;},block:function(block){var mustache=block.mustache,program=block.program,inverse=block.inverse;if(program){program=this.compileProgram(program);}
if(inverse){inverse=this.compileProgram(inverse);}
var type=this.classifyMustache(mustache);if(type==="helper"){this.helperMustache(mustache,program,inverse);}else if(type==="simple"){this.simpleMustache(mustache);this.opcode('pushProgram',program);this.opcode('pushProgram',inverse);this.opcode('emptyHash');this.opcode('blockValue');}else{this.ambiguousMustache(mustache,program,inverse);this.opcode('pushProgram',program);this.opcode('pushProgram',inverse);this.opcode('emptyHash');this.opcode('ambiguousBlockValue');}
this.opcode('append');},hash:function(hash){var pairs=hash.pairs,pair,val;this.opcode('pushHash');for(var i=0,l=pairs.length;i<l;i++){pair=pairs[i];val=pair[1];if(this.options.stringParams){this.opcode('pushStringParam',val.stringModeValue,val.type);}else{this.accept(val);}
this.opcode('assignToHash',pair[0]);}
this.opcode('popHash');},partial:function(partial){var partialName=partial.partialName;this.usePartial=true;if(partial.context){this.ID(partial.context);}else{this.opcode('push','depth0');}
this.opcode('invokePartial',partialName.name);this.opcode('append');},content:function(content){this.opcode('appendContent',content.string);},mustache:function(mustache){var options=this.options;var type=this.classifyMustache(mustache);if(type==="simple"){this.simpleMustache(mustache);}else if(type==="helper"){this.helperMustache(mustache);}else{this.ambiguousMustache(mustache);}
if(mustache.escaped&&!options.noEscape){this.opcode('appendEscaped');}else{this.opcode('append');}},ambiguousMustache:function(mustache,program,inverse){var id=mustache.id,name=id.parts[0],isBlock=program!=null||inverse!=null;this.opcode('getContext',id.depth);this.opcode('pushProgram',program);this.opcode('pushProgram',inverse);this.opcode('invokeAmbiguous',name,isBlock);},simpleMustache:function(mustache){var id=mustache.id;if(id.type==='DATA'){this.DATA(id);}else if(id.parts.length){this.ID(id);}else{this.addDepth(id.depth);this.opcode('getContext',id.depth);this.opcode('pushContext');}
this.opcode('resolvePossibleLambda');},helperMustache:function(mustache,program,inverse){var params=this.setupFullMustacheParams(mustache,program,inverse),name=mustache.id.parts[0];if(this.options.knownHelpers[name]){this.opcode('invokeKnownHelper',params.length,name);}else if(this.knownHelpersOnly){throw new Error("You specified knownHelpersOnly, but used the unknown helper "+name);}else{this.opcode('invokeHelper',params.length,name);}},ID:function(id){this.addDepth(id.depth);this.opcode('getContext',id.depth);var name=id.parts[0];if(!name){this.opcode('pushContext');}else{this.opcode('lookupOnContext',id.parts[0]);}
for(var i=1,l=id.parts.length;i<l;i++){this.opcode('lookup',id.parts[i]);}},DATA:function(data){this.options.data=true;this.opcode('lookupData',data.id);},STRING:function(string){this.opcode('pushString',string.string);},INTEGER:function(integer){this.opcode('pushLiteral',integer.integer);},BOOLEAN:function(bool){this.opcode('pushLiteral',bool.bool);},comment:function(){},opcode:function(name){this.opcodes.push({opcode:name,args:[].slice.call(arguments,1)});},declare:function(name,value){this.opcodes.push({opcode:'DECLARE',name:name,value:value});},addDepth:function(depth){if(isNaN(depth)){throw new Error("EWOT");}
if(depth===0){return;}
if(!this.depths[depth]){this.depths[depth]=true;this.depths.list.push(depth);}},classifyMustache:function(mustache){var isHelper=mustache.isHelper;var isEligible=mustache.eligibleHelper;var options=this.options;if(isEligible&&!isHelper){var name=mustache.id.parts[0];if(options.knownHelpers[name]){isHelper=true;}else if(options.knownHelpersOnly){isEligible=false;}}
if(isHelper){return"helper";}
else if(isEligible){return"ambiguous";}
else{return"simple";}},pushParams:function(params){var i=params.length,param;while(i--){param=params[i];if(this.options.stringParams){if(param.depth){this.addDepth(param.depth);}
this.opcode('getContext',param.depth||0);this.opcode('pushStringParam',param.stringModeValue,param.type);}else{this[param.type](param);}}},setupMustacheParams:function(mustache){var params=mustache.params;this.pushParams(params);if(mustache.hash){this.hash(mustache.hash);}else{this.opcode('emptyHash');}
return params;},setupFullMustacheParams:function(mustache,program,inverse){var params=mustache.params;this.pushParams(params);this.opcode('pushProgram',program);this.opcode('pushProgram',inverse);if(mustache.hash){this.hash(mustache.hash);}else{this.opcode('emptyHash');}
return params;}};var Literal=function(value){this.value=value;};JavaScriptCompiler.prototype={nameLookup:function(parent,name){if(/^[0-9]+$/.test(name)){return parent+"["+name+"]";}else if(JavaScriptCompiler.isValidJavaScriptVariableName(name)){return parent+"."+name;}
else{return parent+"['"+name+"']";}},appendToBuffer:function(string){if(this.environment.isSimple){return"return "+string+";";}else{return{appendToBuffer:true,content:string,toString:function(){return"buffer += "+string+";";}};}},initializeBuffer:function(){return this.quotedString("");},namespace:"Handlebars",compile:function(environment,options,context,asObject){this.environment=environment;this.options=options||{};Handlebars.log(Handlebars.logger.DEBUG,this.environment.disassemble()+"\n\n");this.name=this.environment.name;this.isChild=!!context;this.context=context||{programs:[],environments:[],aliases:{}};this.preamble();this.stackSlot=0;this.stackVars=[];this.registers={list:[]};this.compileStack=[];this.inlineStack=[];this.compileChildren(environment,options);var opcodes=environment.opcodes,opcode;this.i=0;for(l=opcodes.length;this.i<l;this.i++){opcode=opcodes[this.i];if(opcode.opcode==='DECLARE'){this[opcode.name]=opcode.value;}else{this[opcode.opcode].apply(this,opcode.args);}}
return this.createFunctionContext(asObject);},nextOpcode:function(){var opcodes=this.environment.opcodes;return opcodes[this.i+1];},eat:function(){this.i=this.i+1;},preamble:function(){var out=[];if(!this.isChild){var namespace=this.namespace;var copies="helpers = helpers || "+namespace+".helpers;";if(this.environment.usePartial){copies=copies+" partials = partials || "+namespace+".partials;";}
if(this.options.data){copies=copies+" data = data || {};";}
out.push(copies);}else{out.push('');}
if(!this.environment.isSimple){out.push(", buffer = "+this.initializeBuffer());}else{out.push("");}
this.lastContext=0;this.source=out;},createFunctionContext:function(asObject){var locals=this.stackVars.concat(this.registers.list);if(locals.length>0){this.source[1]=this.source[1]+", "+locals.join(", ");}
if(!this.isChild){for(var alias in this.context.aliases){this.source[1]=this.source[1]+', '+alias+'='+this.context.aliases[alias];}}
if(this.source[1]){this.source[1]="var "+this.source[1].substring(2)+";";}
if(!this.isChild){this.source[1]+='\n'+this.context.programs.join('\n')+'\n';}
if(!this.environment.isSimple){this.source.push("return buffer;");}
var params=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var i=0,l=this.environment.depths.list.length;i<l;i++){params.push("depth"+this.environment.depths.list[i]);}
var source=this.mergeSource();if(!this.isChild){var revision=Handlebars.COMPILER_REVISION,versions=Handlebars.REVISION_CHANGES[revision];source="this.compilerInfo = ["+revision+",'"+versions+"'];\n"+source;}
if(asObject){params.push(source);return Function.apply(this,params);}else{var functionSource='function '+(this.name||'')+'('+params.join(',')+') {\n  '+source+'}';Handlebars.log(Handlebars.logger.DEBUG,functionSource+"\n\n");return functionSource;}},mergeSource:function(){var source='',buffer;for(var i=0,len=this.source.length;i<len;i++){var line=this.source[i];if(line.appendToBuffer){if(buffer){buffer=buffer+'\n    + '+line.content;}else{buffer=line.content;}}else{if(buffer){source+='buffer += '+buffer+';\n  ';buffer=undefined;}
source+=line+'\n  ';}}
return source;},blockValue:function(){this.context.aliases.blockHelperMissing='helpers.blockHelperMissing';var params=["depth0"];this.setupParams(0,params);this.replaceStack(function(current){params.splice(1,0,current);return"blockHelperMissing.call("+params.join(", ")+")";});},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing='helpers.blockHelperMissing';var params=["depth0"];this.setupParams(0,params);var current=this.topStack();params.splice(1,0,current);params[params.length-1]='options';this.source.push("if (!"+this.lastHelper+") { "+current+" = blockHelperMissing.call("+params.join(", ")+"); }");},appendContent:function(content){this.source.push(this.appendToBuffer(this.quotedString(content)));},append:function(){this.flushInline();var local=this.popStack();this.source.push("if("+local+" || "+local+" === 0) { "+this.appendToBuffer(local)+" }");if(this.environment.isSimple){this.source.push("else { "+this.appendToBuffer("''")+" }");}},appendEscaped:function(){this.context.aliases.escapeExpression='this.escapeExpression';this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"));},getContext:function(depth){if(this.lastContext!==depth){this.lastContext=depth;}},lookupOnContext:function(name){this.push(this.nameLookup('depth'+this.lastContext,name,'context'));},pushContext:function(){this.pushStackLiteral('depth'+this.lastContext);},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"';this.replaceStack(function(current){return"typeof "+current+" === functionType ? "+current+".apply(depth0) : "+current;});},lookup:function(name){this.replaceStack(function(current){return current+" == null || "+current+" === false ? "+current+" : "+this.nameLookup(current,name,'context');});},lookupData:function(id){this.push(this.nameLookup('data',id,'data'));},pushStringParam:function(string,type){this.pushStackLiteral('depth'+this.lastContext);this.pushString(type);if(typeof string==='string'){this.pushString(string);}else{this.pushStackLiteral(string);}},emptyHash:function(){this.pushStackLiteral('{}');if(this.options.stringParams){this.register('hashTypes','{}');}},pushHash:function(){this.hash={values:[],types:[]};},popHash:function(){var hash=this.hash;this.hash=undefined;if(this.options.stringParams){this.register('hashTypes','{'+hash.types.join(',')+'}');}
this.push('{\n    '+hash.values.join(',\n    ')+'\n  }');},pushString:function(string){this.pushStackLiteral(this.quotedString(string));},push:function(expr){this.inlineStack.push(expr);return expr;},pushLiteral:function(value){this.pushStackLiteral(value);},pushProgram:function(guid){if(guid!=null){this.pushStackLiteral(this.programExpression(guid));}else{this.pushStackLiteral(null);}},invokeHelper:function(paramSize,name){this.context.aliases.helperMissing='helpers.helperMissing';var helper=this.lastHelper=this.setupHelper(paramSize,name,true);this.push(helper.name);this.replaceStack(function(name){return name+' ? '+name+'.call('+
helper.callParams+") "+": helperMissing.call("+
helper.helperMissingParams+")";});},invokeKnownHelper:function(paramSize,name){var helper=this.setupHelper(paramSize,name);this.push(helper.name+".call("+helper.callParams+")");},invokeAmbiguous:function(name,helperCall){this.context.aliases.functionType='"function"';this.pushStackLiteral('{}');var helper=this.setupHelper(0,name,helperCall);var helperName=this.lastHelper=this.nameLookup('helpers',name,'helper');var nonHelper=this.nameLookup('depth'+this.lastContext,name,'context');var nextStack=this.nextStack();this.source.push('if ('+nextStack+' = '+helperName+') { '+nextStack+' = '+nextStack+'.call('+helper.callParams+'); }');this.source.push('else { '+nextStack+' = '+nonHelper+'; '+nextStack+' = typeof '+nextStack+' === functionType ? '+nextStack+'.apply(depth0) : '+nextStack+'; }');},invokePartial:function(name){var params=[this.nameLookup('partials',name,'partial'),"'"+name+"'",this.popStack(),"helpers","partials"];if(this.options.data){params.push("data");}
this.context.aliases.self="this";this.push("self.invokePartial("+params.join(", ")+")");},assignToHash:function(key){var value=this.popStack(),type;if(this.options.stringParams){type=this.popStack();this.popStack();}
var hash=this.hash;if(type){hash.types.push("'"+key+"': "+type);}
hash.values.push("'"+key+"': ("+value+")");},compiler:JavaScriptCompiler,compileChildren:function(environment,options){var children=environment.children,child,compiler;for(var i=0,l=children.length;i<l;i++){child=children[i];compiler=new this.compiler();var index=this.matchExistingProgram(child);if(index==null){this.context.programs.push('');index=this.context.programs.length;child.index=index;child.name='program'+index;this.context.programs[index]=compiler.compile(child,options,this.context);this.context.environments[index]=child;}else{child.index=index;child.name='program'+index;}}},matchExistingProgram:function(child){for(var i=0,len=this.context.environments.length;i<len;i++){var environment=this.context.environments[i];if(environment&&environment.equals(child)){return i;}}},programExpression:function(guid){this.context.aliases.self="this";if(guid==null){return"self.noop";}
var child=this.environment.children[guid],depths=child.depths.list,depth;var programParams=[child.index,child.name,"data"];for(var i=0,l=depths.length;i<l;i++){depth=depths[i];if(depth===1){programParams.push("depth0");}
else{programParams.push("depth"+(depth-1));}}
if(depths.length===0){return"self.program("+programParams.join(", ")+")";}else{programParams.shift();return"self.programWithDepth("+programParams.join(", ")+")";}},register:function(name,val){this.useRegister(name);this.source.push(name+" = "+val+";");},useRegister:function(name){if(!this.registers[name]){this.registers[name]=true;this.registers.list.push(name);}},pushStackLiteral:function(item){return this.push(new Literal(item));},pushStack:function(item){this.flushInline();var stack=this.incrStack();if(item){this.source.push(stack+" = "+item+";");}
this.compileStack.push(stack);return stack;},replaceStack:function(callback){var prefix='',inline=this.isInline(),stack;if(inline){var top=this.popStack(true);if(top instanceof Literal){stack=top.value;}else{var name=this.stackSlot?this.topStackName():this.incrStack();prefix='('+this.push(name)+' = '+top+'),';stack=this.topStack();}}else{stack=this.topStack();}
var item=callback.call(this,stack);if(inline){if(this.inlineStack.length||this.compileStack.length){this.popStack();}
this.push('('+prefix+item+')');}else{if(!/^stack/.test(stack)){stack=this.nextStack();}
this.source.push(stack+" = ("+prefix+item+");");}
return stack;},nextStack:function(){return this.pushStack();},incrStack:function(){this.stackSlot++;if(this.stackSlot>this.stackVars.length){this.stackVars.push("stack"+this.stackSlot);}
return this.topStackName();},topStackName:function(){return"stack"+this.stackSlot;},flushInline:function(){var inlineStack=this.inlineStack;if(inlineStack.length){this.inlineStack=[];for(var i=0,len=inlineStack.length;i<len;i++){var entry=inlineStack[i];if(entry instanceof Literal){this.compileStack.push(entry);}else{this.pushStack(entry);}}}},isInline:function(){return this.inlineStack.length;},popStack:function(wrapped){var inline=this.isInline(),item=(inline?this.inlineStack:this.compileStack).pop();if(!wrapped&&(item instanceof Literal)){return item.value;}else{if(!inline){this.stackSlot--;}
return item;}},topStack:function(wrapped){var stack=(this.isInline()?this.inlineStack:this.compileStack),item=stack[stack.length-1];if(!wrapped&&(item instanceof Literal)){return item.value;}else{return item;}},quotedString:function(str){return'"'+str.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/\n/g,'\\n').replace(/\r/g,'\\r')+'"';},setupHelper:function(paramSize,name,missingParams){var params=[];this.setupParams(paramSize,params,missingParams);var foundHelper=this.nameLookup('helpers',name,'helper');return{params:params,name:foundHelper,callParams:["depth0"].concat(params).join(", "),helperMissingParams:missingParams&&["depth0",this.quotedString(name)].concat(params).join(", ")};},setupParams:function(paramSize,params,useRegister){var options=[],contexts=[],types=[],param,inverse,program;options.push("hash:"+this.popStack());inverse=this.popStack();program=this.popStack();if(program||inverse){if(!program){this.context.aliases.self="this";program="self.noop";}
if(!inverse){this.context.aliases.self="this";inverse="self.noop";}
options.push("inverse:"+inverse);options.push("fn:"+program);}
for(var i=0;i<paramSize;i++){param=this.popStack();params.push(param);if(this.options.stringParams){types.push(this.popStack());contexts.push(this.popStack());}}
if(this.options.stringParams){options.push("contexts:["+contexts.join(",")+"]");options.push("types:["+types.join(",")+"]");options.push("hashTypes:hashTypes");}
if(this.options.data){options.push("data:data");}
options="{"+options.join(",")+"}";if(useRegister){this.register('options',options);params.push('options');}else{params.push(options);}
return params.join(", ");}};var reservedWords=("break else new var"+" case finally return void"+" catch for switch while"+" continue function this with"+" default if throw"+" delete in try"+" do instanceof typeof"+" abstract enum int short"+" boolean export interface static"+" byte extends long super"+" char final native synchronized"+" class float package throws"+" const goto private transient"+" debugger implements protected volatile"+" double import public let yield").split(" ");var compilerWords=JavaScriptCompiler.RESERVED_WORDS={};for(var i=0,l=reservedWords.length;i<l;i++){compilerWords[reservedWords[i]]=true;}
JavaScriptCompiler.isValidJavaScriptVariableName=function(name){if(!JavaScriptCompiler.RESERVED_WORDS[name]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(name)){return true;}
return false;};})(Handlebars.Compiler,Handlebars.JavaScriptCompiler);Handlebars.precompile=function(input,options){if(!input||(typeof input!=='string'&&input.constructor!==Handlebars.AST.ProgramNode)){throw new Handlebars.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+input);}
options=options||{};if(!('data'in options)){options.data=true;}
var ast=Handlebars.parse(input);var environment=new Handlebars.Compiler().compile(ast,options);return new Handlebars.JavaScriptCompiler().compile(environment,options);};Handlebars.compile=function(input,options){if(!input||(typeof input!=='string'&&input.constructor!==Handlebars.AST.ProgramNode)){throw new Handlebars.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+input);}
options=options||{};if(!('data'in options)){options.data=true;}
var compiled;function compile(){var ast=Handlebars.parse(input);var environment=new Handlebars.Compiler().compile(ast,options);var templateSpec=new Handlebars.JavaScriptCompiler().compile(environment,options,undefined,true);return Handlebars.template(templateSpec);}
return function(context,options){if(!compiled){compiled=compile();}
return compiled.call(this,context,options);};};;Handlebars.VM={template:function(templateSpec){var container={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(i,fn,data){var programWrapper=this.programs[i];if(data){return Handlebars.VM.program(fn,data);}else if(programWrapper){return programWrapper;}else{programWrapper=this.programs[i]=Handlebars.VM.program(fn);return programWrapper;}},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop,compilerInfo:null};return function(context,options){options=options||{};var result=templateSpec.call(container,Handlebars,context,options.helpers,options.partials,options.data);var compilerInfo=container.compilerInfo||[],compilerRevision=compilerInfo[0]||1,currentRevision=Handlebars.COMPILER_REVISION;if(compilerRevision!==currentRevision){if(compilerRevision<currentRevision){var runtimeVersions=Handlebars.REVISION_CHANGES[currentRevision],compilerVersions=Handlebars.REVISION_CHANGES[compilerRevision];throw"Template was precompiled with an older version of Handlebars than the current runtime. "+"Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+").";}else{throw"Template was precompiled with a newer version of Handlebars than the current runtime. "+"Please update your runtime to a newer version ("+compilerInfo[1]+").";}}
return result;};},programWithDepth:function(fn,data,$depth){var args=Array.prototype.slice.call(arguments,2);return function(context,options){options=options||{};return fn.apply(this,[context,options.data||data].concat(args));};},program:function(fn,data){return function(context,options){options=options||{};return fn(context,options.data||data);};},noop:function(){return"";},invokePartial:function(partial,name,context,helpers,partials,data){var options={helpers:helpers,partials:partials,data:data};if(partial===undefined){throw new Handlebars.Exception("The partial "+name+" could not be found");}else if(partial instanceof Function){return partial(context,options);}else if(!Handlebars.compile){throw new Handlebars.Exception("The partial "+name+" could not be compiled when running in runtime-only mode");}else{partials[name]=Handlebars.compile(partial,{data:data!==undefined});return partials[name](context,options);}}};Handlebars.template=Handlebars.VM.template;;;function trackPageview(page){ga('send','pageview',page);}
function trackEvent(category,action,opt_label,wPageview){ga('send','event',category,action,opt_label);if(wPageview){ga('send','pageview','/'+category+'/'+action+'/'+opt_label);}}
function getUrlParameter(sParam){var sPageURL=decodeURIComponent(window.location.search.substring(1)),sURLVariables=sPageURL.split('&'),sParameterName,i;for(i=0;i<sURLVariables.length;i++){sParameterName=sURLVariables[i].split('=');if(sParameterName[0]===sParam){return sParameterName[1]===undefined?true:sParameterName[1];}}}
var wosLink={init:function(){$('.times-cited-link').click(function(){trackEvent('timesCited','click','wos-docview-click',false);});}};var signupFlowFreelancerButton={init:function(){$('.js-signup-flow-my-library').click(function(){trackEvent('signupFlowFreelancer','click','signup-flow-freelancer',false);});}};var anonPlanMatrixFreelancerButton={init:function(){$('.js-anon-plan-matrix-freelancer').click(function(){trackEvent('anonPlanMatrixFreelancer','click','anon-plan-matrix-freelancer',false);});}};var anonPlanMatrixProfessionalButton={init:function(){$('.js-anon-plan-matrix-professional').click(function(){trackEvent('anonPlanMatrixProfessional','click','anon-plan-matrix-professional',false);});}};var linkoutSerp={init:function(){var user=$('#user_meta_data').metadata();var anon=user.anonymous?'anonymous':'logged-in';$('.js-pubmed-serp:not(a[href="#pubmedSearchResults"])').on('click submit',function(e){if(e.type=='submit')e.preventDefault();trackEvent('linkoutSerp','pm-serp-link-click',anon,false);if(e.type=='submit')window.location=$(this).find('.js-pubmed-serp').attr('href');});$('.js-scholar-serp:not(a[href="#scholarSearchResults"])').on('click submit',function(e){if(e.type=='submit')e.preventDefault();trackEvent('linkoutSerp','google-scholar-serp-link-click',anon,false);if(e.type=='submit')window.location=$(this).find('.js-scholar-serp').attr('href');});$('.js-serp-link-to-plugin').on('click',function(e){trackEvent('linkoutSerp','plugin-serp-install-intent',anon,false);});linkoutSerp._setupTabs(anon);},_setupTabs:function(anon){$('.js-linkout-serp-tabs a[href="#ddSearchResults"]').on('click',function(e){e.preventDefault();$(this).tab('show');trackEvent('linkoutSerp','view-deepdyve-results-tab',anon,false);});$('.js-linkout-serp-tabs a[href="#pubmedSearchResults"]').on('click',function(e){e.preventDefault();$(this).tab('show');trackEvent('linkoutSerp','view-pubmed-plugin-tab',anon,false);});$('.js-linkout-serp-tabs a[href="#scholarSearchResults"]').on('click',function(e){e.preventDefault();$(this).tab('show');trackEvent('linkoutSerp','view-scholar-plugin-tab',anon,false);});}};function logClick(e){var params;if($(e.target).is('a')||$(e.target).is('input')){params=$(e.target).metadata();}else if($(e.target).parents('a, input').length>0){params=$(e.target).parents('a, input').metadata();}
if(params){var current_time=new Date().getTime();var event_name=params.event_name;if(typeof event_name!=='string'||event_name===''){return true;}
params.current_time_millis=current_time;var paramBuffer=[];for(var key in params){if(params.hasOwnProperty(key)){paramBuffer.push(key+'='+encodeURIComponent(params[key]));}}
$.ajax({url:"/php-logger/log_click.php",async:params.async,data:paramBuffer.join('&'),type:"POST",complete:function(r){}});}}
function trendingEvent(permId,rentalState){$.ajax({url:"/trending-event",async:true,data:'permId='+permId+'&rentalState='+rentalState,type:"POST",complete:function(r){}});}
function getUrlVars(urlString){var vars=[],hash,hashes;if(urlString!==undefined){hashes=urlString.slice(urlString.indexOf('?')+1).split('&');}else{hashes=window.location.href.slice(window.location.href.indexOf('?')+1).split('&');}
for(var i=0;i<hashes.length;i++){hash=hashes[i].split('=');vars.push(hash[0]);vars[hash[0]]=hash[1];}
return vars;}
function searchEvent(){}
function browseEvent(){}
jQuery.fn.extend({disableSelection:function(){return this.each(function(){this.ondragstart=function(){return false;};this.onselectstart=function(){return false;};this.unselectable="on";jQuery(this).css('user-select','none');jQuery(this).css('-o-user-select','none');jQuery(this).css('-moz-user-select','none');jQuery(this).css('-khtml-user-select','none');jQuery(this).css('-webkit-user-select','none');});},smoothAnchor:function(){return this.each(function(){$(this).click(function(e){e.preventDefault();$.scrollTo('a[name='+$(this).attr('href').substr(1)+']',500);});});},tipBubble:function(){return this.each(function(){$(this).find('.tipBubble').removeClass('hide').hide();$(this).hover(function(){$(this).find('.tipBubble').fadeIn(300);},function(){$(this).find('.tipBubble').fadeOut(300);});});},toggleContent:function(){return this.each(function(){if(!($(this).hasClass('on'))||$.cookie('hide-'+$(this).attr('href').substr(1))){$(this).removeClass('on');$('#'+$(this).attr('href').substr(1)).hide();}
$(this).click(function(e){e.preventDefault();$(this).toggleClass('on');var targetID=$(this).attr('href').substr(1);if($(this).hasClass('on')){$.cookie('hide-'+targetID,null,{expires:365,path:'/'});$('#'+targetID).slideDown(200);}else{$.cookie('hide-'+targetID,true,{expires:365,path:'/'});$('#'+targetID).slideUp(200);}});});},selectLinks:function(){return this.each(function(){$(this).change(function(){if($(this).val()!=='')location.href=$(this).val();});});}});function removeDuplicate(originalArray){var hashSet={};for(var i in originalArray){if(originalArray[i]===undefined)continue;if(jQuery.type(originalArray[i])==='string'){hashSet[originalArray[i].toLowerCase()]=originalArray[i];}}
var newArray=[];for(var key in hashSet){if(hashSet.hasOwnProperty(key))newArray.push(hashSet[key]);}
return newArray;}
function checkAllChecked(checkboxes){checkboxes=$(checkboxes);if(checkboxes.length==checkboxes.filter(':checked').length)
return true;else
return false;}
(function($){$.fn.setupSelectAllNone=function(){this.find('.multipleSelect .selectAll').click(function(e){e.preventDefault();this.find('input').attr('checked','checked');});this.find('.multipleSelect .selectNone').click(function(e){e.preventDefault();this.find('input').removeAttr('checked');});return this;};})(jQuery);(function($){$.fn.cancelAllChecked=function(){if(checkAllChecked(this))
this.removeAttr('checked');return this;};})(jQuery);function syncCheckboxLists(originalList,newList){originalList.each(function(i){if($(originalList.get(i)).attr('checked')){$(newList.get(i)).attr('checked','checked');}else{$(newList.get(i)).removeAttr('checked');}});}
var tooltipUtils={updateTooltipsForElements:function($elementsWithTooltip,newMessage){if(newMessage){$elementsWithTooltip.attr('title',newMessage);}
$elementsWithTooltip.tooltip('destroy');$elementsWithTooltip.tooltip({placement:'bottom',container:'body',html:true,});},};var journalFollow={markAsReadList:[],markAsReadInterval:null,init:function(){if($('.followJournalField').length>0){var d=new Date().getTime();$.getJSON('/get-all-journals',function(data){if(typeof data.response==='undefined'){return;}
$.get('/log-event',{event_name:'get_all_journals_time',time:new Date().getTime()-d,num:data.response.docs.length});$('.followJournalForm').removeClass('hide');$(".followJournalField").autocomplete(data.response.docs,{minChars:1,max:100,width:500,matchContains:"word",formatItem:function(item){return item.journal_display_name;},formatMatch:function(item){return item.journal_display_name;},formatResult:function(item){return item.journal_display_name;}}).result(function(e,item){$('.followJournalField').addClass('disabled').attr('disabled','disabled');if($('#activationForm, .js-signupConfirm-signupForm').length>0){$('.followedJournalList').append('<li class="animated bounceInUp"><i class="icon-check-sign text-success"></i> '+item.journal_display_name+'</li>');$('#continueBttn').removeClass('disabled').removeAttr('disabled');}
journalFollow.follow(item.journal_id,true,'auto-complete-field');});});var justFollowedJournal=$.cookie('justFollowedJournal');$('#journal-'+justFollowedJournal).addClass('attn');$.cookie('justFollowedJournal',null,{path:'/'});}
if($('#feedDocs').length>0){$('#feedDocs').click(function(e){var thisDocItem;if($(e.target).is('.editrl, .editrl>i')){return;}else if($(e.target).is('li.doc')){thisDocItem=$(e.target);}else{thisDocItem=$(e.target).parents('li.doc');}
if(!thisDocItem.hasClass('read')){journalFollow.markAsRead(thisDocItem);}});$('.markAllAsRead').click(function(e){e.preventDefault();journalFollow.markAllAsRead();journalFollow.getMoreDocs();});$('#loadMore .loadMoreLink').click(function(e){e.preventDefault();$('#loadMore').addClass('hide');journalFollow.getMoreDocs();});}
var $homeNav=$('.homeNav-body');if($homeNav.length){$homeNav.on('click','.js-remove-journal',function(event){event.preventDefault();$(this).find('.icon-remove-sign').addClass('icon-spin');journalFollow.follow($(this).attr('href').substr(1),false,'homenav-remove');});}
if($homeNav.length){$(window).on("scroll resize",function(){var top=$(window).width()>979?87:56;$homeNav.animate({top:$(this).scrollTop()<=top?top-$(this).scrollTop():0},25,"linear");});}
var $loadAllJournalsBtn=$('.js-load-all-journals');if($loadAllJournalsBtn.length){$loadAllJournalsBtn.on('click',function(event){event.preventDefault();$(this).hide();$('li.journalName').removeClass('hidden');$('.js-journals-list ~ .js-endOfList').removeClass('hidden');$('li.journalName.clearfix').addClass('journal-li');});}},follow:function(journalId,follow,trackSource){var maxListLength=5;var params={journalId:journalId,unfollow:!follow,};var hoverText=$('.js-followIcon[data-journalid="'+journalId+'"]').data('original-title')||"";$.ajax({type:'GET',url:'/follow-journal',dataType:'json',data:params,beforeSend:function(){if($('.followJournalField').length>0){$('.myJournals #journal-'+journalId).fadeTo(300,0.3);}
$('.followIcon[href="#'+journalId+'"] i').addClass('icon-spin');$('.js-followIcon[data-journalid="'+journalId+'"]').addClass('is-loading');$('.js-followIcon[data-journalid="'+journalId+'"] .js-followIcon__icon').removeClass('icon-plus-sign-alt icon-minus-sign-alt icon-check-sign').addClass('icon-spinner icon-spin');tooltipUtils.updateTooltipsForElements($('.js-followIcon[data-journalid="'+journalId+'"]'),"Saving changes ...");$('.followBtn[href="#'+journalId+'"] i').addClass('icon-spin');$.ajax({url:"/get-related-subject-areas-journals",data:'cmd=journal&journalId='+journalId,dataType:"json",type:"GET",success:function(response){if(response.results&&response.results.length>0){var resultsList='<span class="dd-relatedJournals-list js-relatedJournals-list">';$.each(response.results,function(i,journal){if(i>=maxListLength){return false;}
resultsList+='<span class="journalName"><a href="/browse/journals/'+journal.journalUrl+'">'+journal.journalTitle+'</a></span>';if(i<response.results.length-1&&i<maxListLength-1){resultsList+=', ';}});resultsList+='</span>';$('.js-followJournalDialog-relatedJournals .js-relatedJournals-list').replaceWith(resultsList);$('.js-followJournalDialog-relatedJournals').show();}else{$('.js-followJournalDialog-relatedJournals').hide();}}});},success:function(response){if(response.msg=='followed'){trackEvent('follow-add',trackSource,journalId,false);_cio.track('followed-journal');$('.followIcon[href="#'+journalId+'"]').addClass('followed');$('.followIcon[href="#'+journalId+'"] span').text('Followed');$('.followIcon[href="#'+journalId+'"] strong').text('Following');$('.followIcon[href="#'+journalId+'"] i').removeClass('icon-plus-sign-alt icon-minus-sign-alt icon-spin').addClass('icon-check-sign');$('.js-followIcon[data-journalid="'+journalId+'"]').removeClass('is-loading');$('.js-followIcon[data-journalid="'+journalId+'"]').addClass('is-followed');$('.js-followIcon[data-journalid="'+journalId+'"] .js-followIcon__icon').removeClass('icon-plus-sign-alt icon-minus-sign-alt icon-spinner icon-spin').addClass('icon-check-sign');tooltipUtils.updateTooltipsForElements($('.js-followIcon[data-journalid="'+journalId+'"]'),hoverText.replace(/^<span>Add\s/g,"<span>Remove ").replace(/to My Journals<\/span>$/g,"from My Journals</span>"));$('.followBtn[href="#'+journalId+'"]').addClass('followed');$('.followBtn[href="#'+journalId+'"] span').text('Added to My Library');$('.followBtn[href="#'+journalId+'"] strong').text('Adding');$('.followBtn[href="#'+journalId+'"] i').removeClass('icon-plus-sign-alt icon-minus-sign-alt icon-spin').addClass('icon-check-sign');if($('.followJournalField').length>0&&$('.followJournalField').is(':visible')){if($('#activationForm, .js-signupConfirm-signupForm').length>0){$('.followJournalField').val('').removeClass('disabled').removeAttr('disabled');$('.followJournalField').focus();}else{setTimeout(function(){window.location.href=window.location.href.split('?')[0]+'?journalId='+journalId;},100);}}else if($('#docViewerWrapper').length>0){$('#bsFollowJournalModal .journalTitle').text($('.followIcon[href="#'+journalId+'"]').attr('title'));$('#bsFollowJournalModal .journalTitle').text($('.followBtn[href="#'+journalId+'"]').attr('title'));$('#bsFollowJournalModal').modal('show');}}else if(response.msg=='unfollowed'){trackEvent('follow-remove',trackSource,journalId,false);_cio.track('unfollowed-journal');if($('.followJournalField').length>0&&$('.followJournalField').is(':visible')){setTimeout(function(){window.location.href=window.location.href.split('?')[0];},100);}
$('.followIcon[href="#'+journalId+'"]').removeClass('followed');$('.followIcon[href="#'+journalId+'"] span').text('Unfollowed');$('.followIcon[href="#'+journalId+'"] strong').text('Follow');$('.followIcon[href="#'+journalId+'"] i').removeClass('icon-check-sign icon-minus-sign-alt icon-spin').addClass('icon-plus-sign-alt');$('.js-followIcon[data-journalid="'+journalId+'"]').removeClass('is-loading');$('.js-followIcon[data-journalid="'+journalId+'"]').removeClass('is-followed');$('.js-followIcon[data-journalid="'+journalId+'"] .js-followIcon__icon').removeClass('icon-check-sign icon-minus-sign-alt icon-spinner icon-spin').addClass('icon-plus-sign-alt');tooltipUtils.updateTooltipsForElements($('.js-followIcon[data-journalid="'+journalId+'"]'),hoverText.replace(/^<span>Remove\s/g,"<span>Add ").replace(/from My Journals<\/span>$/g,"to My Journals</span>"));$('.followBtn[href="#'+journalId+'"]').removeClass('followed');$('.followBtn[href="#'+journalId+'"] span').text('Removed');$('.followBtn[href="#'+journalId+'"] strong').text('Follow');$('.followBtn[href="#'+journalId+'"] i').removeClass('icon-check-sign icon-minus-sign-alt icon-spin').addClass('icon-plus-sign-alt');$('a#journal-'+journalId).parent().remove();}else{$('.js-followIcon[data-journalid="'+journalId+'"]').removeClass('is-loading');$('.js-followIcon[data-journalid="'+journalId+'"] .js-followIcon__icon').removeClass('icon-spinner icon-spin').addClass(follow?'icon-plus-sign-alt':'icon-check-sign');tooltipUtils.updateTooltipsForElements($('.js-followIcon[data-journalid="'+journalId+'"]'),hoverText);}}});},autoLoad:function(){if(journalFollow.isNearBottom()){journalFollow.getMoreDocs();}},getMoreDocs:function(){if(!$('#scrollLoading').hasClass('hide')){return false;}
var skip;$('#scrollLoading').removeClass('hide');if($('#showAllArticles').hasClass('active')){skip=10;}else{skip=$('#feedDocs .doc:not(.read)').length;}
var params=$('#loadMore a').attr('href').substr(1);var getDocsAjax=function(){$.get('/my-deepdyve?skip='+skip+params,function(data){var docItemCount=$('<div>').append(data).find('li.doc').length;if(docItemCount<10||data===''||data===null){$('#loadMore').addClass('nomore');}
$('#feedDocs').append(data);$('#scrollLoading').addClass('hide');$('#loadMore').removeClass('hide');directory.adjustDirectoryMenuHeight();resultButtons.setupBookmark($('.bookmark'));resultButtons.setupRemove($('.bookmarked'));});};if(journalFollow.markAsReadList.length===0)
getDocsAjax();else
journalFollow.markAsReadCall(getDocsAjax);},isNearBottom:function(){if(navigator.userAgent.match(/iPad/i)!==null){if(($(document).scrollTop()+$(window).height())>($('#footerSearch').offset().top-$(document).scrollTop()-($(window).height()*2))){return true;}}else{if(($(document).scrollTop()+$(window).height())>($('#footerSearch').offset().top-100)){return true;}}
return false;},markAllAsRead:function(){$('#feedDocs .doc').each(function(){journalFollow.markAsRead($(this));$(this).slideUp(600);});},markAsRead:function(doc){doc=$(doc);doc.addClass('read');journalFollow.markAsReadList.push(doc.attr('id'));$.cookie('markAsReadList',journalFollow.markAsReadList.join(','),{path:'/'});$('#allNewArticleCount').text(parseInt($('#allNewArticleCount').text())-1);var journalId=doc.find('.followIcon').attr('href').substr(1);var journalId=doc.find('.followBtn').attr('href').substr(1);var newCount=parseInt($('.myJournals #journal-'+journalId+' span').text())-1;if(newCount<=0){$('.myJournals #journal-'+journalId+' span').remove();}else{$('.myJournals #journal-'+journalId+' span').text(newCount);}
var newGroupCount=parseInt($('.myJournals #journal-'+journalId).parents('.journalFeedsGroup').find('.journalFeeds span').text())-1;if(newGroupCount<=0){$('.myJournals #journal-'+journalId).parents('.journalFeedsGroup').find('.journalFeeds span').remove();}else{$('.myJournals #journal-'+journalId).parents('.journalFeedsGroup').find('.journalFeeds span').text(newGroupCount);}},markAsReadCall:function(callbackFn){if(journalFollow.markAsReadList.length===0)
return false;$.ajax({type:'GET',url:'/mark-as-read',dataType:'json',data:'permId='+journalFollow.markAsReadList,success:function(response){if(response.msg=='marked'){journalFollow.markAsReadList=[];$.cookie('markAsReadList',journalFollow.markAsReadList.join(','),{path:'/'});if(typeof callbackFn!='undefined'){callbackFn();}}}});}};var resultButtons={setup:function(){resultButtons.setupBookmark($('.bookmark'));resultButtons.setupRemove($('.bookmarked'));resultButtons.followJournal($('.followIcon'));resultButtons.followJournal($('.followBtn'));resultButtons.followJournal($('.js-followIcon'));tooltipUtils.updateTooltipsForElements($('.js-followIcon'));},followJournal:function(followBtn){followBtn.each(function(){var withText=($(this).children('strong').length>0)?true:false;if(withText){followBtn.hover(function(e){if($(this).hasClass('followed')){$(this).children('strong').text('Remove from My Library');}},function(e){if($(this).hasClass('followed')){$(this).children('strong').text('Added to My Library');}});}
$(this).click(function(e){e.preventDefault();var icon=$(this);var journalId=icon.data('journalid')||icon.attr('href').substr(1);if(icon.hasClass('notPermitted')){$('#bsFollowJournalModal').modal('show');trackEvent('follow','not-login',journalId,false);return false;}
var doFollow=true;if(icon.hasClass('followed')||icon.hasClass('is-followed')){doFollow=false;}
journalFollow.follow(journalId,doFollow,'doc-meta-data');}).hover(function(e){e.preventDefault();var icon=$(this);var loading=$(this).hasClass('is-loading');if(!loading){if(icon.hasClass('followed')||icon.hasClass('is-followed')){icon.find('.js-followIcon__icon, i').removeClass('icon-plus-sign-alt, icon-check-sign').addClass('icon-minus-sign-alt');}else{$(icon).find('.js-followIcon__icon, i').removeClass('icon-check-sign, icon-minus-sign-alt').addClass('icon-plus-sign-alt');}}},function(e){e.preventDefault();var icon=$(this);var loading=$(this).hasClass('is-loading');if(!loading){if(icon.hasClass('followed')||icon.hasClass('is-followed')){icon.find('.js-followIcon__icon, i').removeClass('icon-check-sign icon-plus-sign-alt icon-minus-sign-alt').addClass('icon-check-sign');}else{$(icon).find('.js-followIcon__icon, i').removeClass('icon-check-sign icon-plus-sign-alt icon-minus-sign-alt').addClass('icon-plus-sign-alt');}}});});},'BOOKMARKICON_LOADING_CLASSES':'icon-spinner icon-spin icon-remove','BOOKMARKICON_LOADING':'icon-spinner icon-spin','BOOKMARKICON_LOADING_FAILED':'icon-remove','BOOKMARKICON_CLASSES':'icon-ok icon-remove icon-bookmark-empty icon-bookmark icon-spinner icon-spin','BOOKMARKICON_BOOKMARKED':'icon-bookmark','BOOKMARKICON_NOT_BOOKMARKED':'icon-bookmark-empty',setupBookmark:function(bookmarkButtons){bookmarkButtons.click(function(e){e.preventDefault();var button=$(this);var icon=button.find('i');var permId=button.attr('href').substr(1);var title=button.text();var $buttons=$('.js-bookmark[href="#'+permId+'"]');var $icons=$buttons.find('i');if(button.hasClass('notPermitted')){$('#bsSaveDocumentModal').modal('show');trackEvent('bookmark','not-login',permId,false);}else{$.ajax({type:'POST',url:'/editsaved',dataType:'json',data:'cmd=adddoc&id='+permId,beforeSend:function(){if(!icon.hasClass('anon')){if(button.hasClass('js-bookmark')){$icons.removeClass(resultButtons.BOOKMARKICON_CLASSES).addClass(resultButtons.BOOKMARKICON_LOADING);}else{icon.removeClass(resultButtons.BOOKMARKICON_CLASSES).addClass(resultButtons.BOOKMARKICON_LOADING);}}},complete:function(){},success:function(response){if(response.success===true){if(button.hasClass('js-bookmark')){$buttons.removeClass('bookmark').addClass('bookmarked').unbind('click');$buttons.find('.icon-spinner').removeClass(resultButtons.BOOKMARKICON_CLASSES).addClass(resultButtons.BOOKMARKICON_BOOKMARKED);resultButtons.setupRemove($buttons);}else{button.removeClass('bookmark').addClass('bookmarked').unbind('click');button.html('<span><i class="icon-bookmark icon-large"></i> Bookmarked</span>');resultButtons.setupRemove(button);}
trackEvent('bookmark','add',permId,false);_cio.track("Bookmarked-article",{permid:permId,articletitle:title});}else{if(button.hasClass("js-bookmark")){$buttons.find('.icon-spinner').removeClass(resultButtons.BOOKMARKICON_CLASSES).addClass(resultButtons.BOOKMARKICON_LOADING_FAILED).delay(800).addClass(resultButtons.BOOKMARKICON_BOOKMARKED);}else{icon.removeClass(resultButtons.BOOKMARKICON_CLASSES).addClass(resultButtons.BOOKMARKICON_BOOKMARKED);}}}});}});},setupBookmarkSignupConfirm:function(bookmarkDocs){bookmarkDocs.click(function(e){e.preventDefault();var doc=$(this);var icon=doc.find('i');var permId=doc.attr('href').substr(1);var title=doc.find('.docTitle').text();$.ajax({type:'POST',url:'/editsaved',dataType:'json',data:'cmd=adddoc&id='+permId,beforeSend:function(){icon.removeClass(resultButtons.BOOKMARKICON_CLASSES).addClass(resultButtons.BOOKMARKICON_LOADING);},complete:function(){},success:function(response){doc.removeClass('bookmark').unbind('click');icon.removeClass(resultButtons.BOOKMARKICON_LOADING).addClass(resultButtons.BOOKMARKICON_BOOKMARKED);trackEvent('bookmark','add',permId,false);_cio.track("Bookmarked-article",{permid:permId,articletitle:title});}});});},setupRemove:function(removeButtons){removeButtons.click(function(e){e.preventDefault();var button=$(this);var permId=button.attr('href').substr(1);var title=button.text();var $buttons=$('.js-bookmark[href="#'+permId+'"]');var $icons=$buttons.find('i');$.ajax({type:'POST',url:'/editsaved',dataType:'json',data:'cmd=removedoc&id='+permId,beforeSend:function(){if(button.hasClass('js-bookmark')){$icons.removeClass(resultButtons.BOOKMARKICON_CLASSES).addClass(resultButtons.BOOKMARKICON_LOADING);}else{icon.removeClass(resultButtons.BOOKMARKICON_CLASSES).addClass(resultButtons.BOOKMARKICON_LOADING);}},complete:function(){},success:function(response){if(response.success===true){if(button.hasClass('js-bookmark')){$buttons.removeClass('bookmarked').addClass('bookmark').unbind('click');$buttons.find('.icon-spinner').removeClass(resultButtons.BOOKMARKICON_CLASSES).addClass(resultButtons.BOOKMARKICON_NOT_BOOKMARKED);resultButtons.setupBookmark($buttons);}else{button.removeClass('bookmarked').addClass('bookmark').unbind('click');button.html('<span><i class="icon-bookmark-empty icon-small"></i> Bookmark</span>');resultButtons.setupBookmark(button);}
if(button.parents('#bookmarkedArticles, #overview-bookmarked, #rentalHistory').length>0){button.parents('li').addClass('animated bounceOutRight');var timeout=window.setTimeout(function(){$(button).closest('.doc').slideUp();},600);}
$.ajax({type:'POST',url:'/removecurrentlyreading',dataType:'json',data:'permid='+permId});$('.bookmarkCount').each(function(){$(this).text(Number($(this).text())-1);});trackEvent('bookmark','remove',permId,false);_cio.track("Unbookmarked-article",{permid:permId,articletitle:title});}else{if(button.hasClass('js-bookmark')){$buttons.find('.icon-spinner').removeClass(resultButtons.BOOKMARKICON_LOADING_CLASSES).addClass(resultButtons.BOOKMARKICON_LOADING_FAILED).delay(800).addClass(resultButtons.BOOKMARKICON_BOOKMARKED);}else{button.html('<span><i class="icon-bookmark icon-small"></i> Bookmark</span>');}}}});});},setupMLT:function(mltButtons){}};var MLT={getRelatedArticles:function(relatedDiv,viewMode){var loadingDiv=relatedDiv.find('.loading');var urlParams='';var permId;if($('#impression_id').length>0){var params=$('#impression_id').metadata();permId=params.perm_id;urlParams=params.rec_query_params;}else if($('.js-docMetadata').length>0){permId=$('.js-docMetadata').metadata().permId;}
var relatedUL=relatedDiv.find('ul');var filterString=relatedDiv.find('.filterString').text();if(typeof viewMode==='undefined'){viewMode='';}
$.ajax({type:'POST',url:'/relateddocs',dataType:'json',data:'id='+permId+'&size=7&'+filterString+'&viewMode='+viewMode+'&urlParams='+urlParams,beforeSend:function(){},complete:function(){loadingDiv.hide();},success:function(response){if(response.success===true){loadingDiv.hide();relatedUL.show().append(response.html).show();$('.nextArticle .loading').hide();$('.nextArticle ul').append(relatedUL.find('li').first().clone());relatedUL.find('li a').click(function(){trackEvent('doc-view','mlt-results/click',permId,false);});relatedUL.removeClass('loadAjax');if(viewMode==='simpleBookmark'){resultButtons.setupBookmarkSignupConfirm($('.simpleBookmark'));}else{resultButtons.setupBookmark($('.bookmark'));resultButtons.setupRemove($('.bookmarked'));}
readingListActions.init();docTools.setupAuthors($('.relatedDocs .doc .additionalAuthors'));if($('.js-toolbar-recommendations').length>0){$('.js-toolbar-recommendations .badge').text(relatedUL.find('li').length);}}else{}}});}};var abstractPreviewPane={init:function(){if($(".search-main").length){$('.js-abstractPreviewPane [data-toggle*="tooltip"]').tooltip({html:true,placement:'bottom'});$('.js-abstractPreviewPane__addToList.notPermitted').on('click',function(e){e.stopPropagation();$('#bsSignUpModal').modal('show');});$('.js-togglePreviewPane').css({cursor:'pointer'});$('.js-togglePreviewPane').on('mousedown',function(e){if(!($(e.target).closest('a, button, input, label').length>0)){$(this).css({'box-shadow':'0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)'});}}).on('mouseup',function(e){if(!($(e.target).closest('a, button, input, label').length>0)){$(this).css({'box-shadow':""});}});$('.js-togglePreviewPane').on('click',function(e){if(!($(e.target).closest('a, button, input, label').length>0)){var $this=$(this);var willUpdate=$(e.target).hasClass('js-quickView')||!$(this).hasClass('is-active');$(this).closest('.docsList').find('.js-togglePreviewPane').removeClass('is-active');$this.toggleClass("is-active",willUpdate);abstractPreviewPane.toggle(willUpdate,function(){if(!willUpdate){abstractPreviewPane.clear();}});abstractPreviewPane.update($this);}});$(document).on('keydown','.search-main, .js-abstractPreviewPane',debounce(function(e){switch(e.which){case 27:if($('.modal.in').length===0){e.preventDefault();abstractPreviewPane.hide();}
break;case 74:case 39:case 40:e.preventDefault();abstractPreviewPane.next();break;case 75:case 37:case 38:e.preventDefault();abstractPreviewPane.prev();break;default:break;}},100));$(document).on('click',function(e){if($('.js-abstractPreviewPane').hasClass('slideInRight')&&$(e.target).closest('.js-abstractPreviewPane').length===0&&$(e.target).closest('.js-togglePreviewPane').length===0&&$(e.target).closest('.modal').length===0){abstractPreviewPane.hide();}});$('.js-abstractPreviewPane__closeButton').on('click',function(){abstractPreviewPane.hide();});if(window.localStorage.getItem('f')==='-1'){$('.doc.js-togglePreviewPane:last-of-type()').addClass('is-active');abstractPreviewPane.prev();abstractPreviewPane.next();}else if(window.localStorage.getItem('f')==='1'){$('.doc.js-togglePreviewPane:first-of-type()').click();abstractPreviewPane.next();abstractPreviewPane.prev();};}
window.localStorage.removeItem('f');},next:function(){var $next=$('.doc.js-togglePreviewPane.is-active').next();$next=$next.length?$next:$('.js-togglePreviewPane:first-of-type()');if($next.length){if($next.is($('.doc.js-togglePreviewPane').get(0))){if($('.js-pagination-next').length){window.localStorage.setItem('f',1);$('.js-pagination-next').get(0).click();}else{window.localStorage.removeItem('f');}}else{$('html, body').animate({scrollTop:$next.offset().top-20,},50);$next.focus();$next.click();$('.js-abstractPreviewPane').focus();}}
trackEvent('flyout','keypress','next',false);},prev:function(){var $prev=$('.doc.js-togglePreviewPane.is-active').prev();$prev=$prev.length?$prev:$('.doc.js-togglePreviewPane:last-of-type()');if($prev.length){if($prev.is($('.js-togglePreviewPane').get(-1))){if($('.js-pagination-prev').length){window.localStorage.setItem('f',-1);$('.js-pagination-prev').get(0).click();}else{window.localStorage.removeItem('f');}}else{$('html, body').animate({scrollTop:$prev.offset().top-20,},50);$prev.focus();$prev.click();$('.js-abstractPreviewPane').focus();}}
trackEvent('flyout','keypress','prev',false);},toggle:function(show,cb){if(show){abstractPreviewPane.show(cb);}else{abstractPreviewPane.hide(cb);}},show:function(cb){if(typeof cb==='function'){$('.js-abstractPreviewPane').removeClass('slideOutRight').addClass('slideInRight');}else{$('.js-abstractPreviewPane').removeClass('slideOutRight').addClass('slideInRight');}
var anonUser=$('#user_meta_data').metadata().anonymous;if(anonUser){trackEvent('flyout','anon-show','show',false);}else{trackEvent('flyout','user-show','show',false);}},hide:function(cb){if(typeof cb==='function'){$('.js-abstractPreviewPane').removeClass('slideInRight').addClass('slideOutRight');}else{$('.js-abstractPreviewPane').removeClass('slideInRight').addClass('slideOutRight');}
var anonUser=$('#user_meta_data').metadata().anonymous;if(anonUser){trackEvent('flyout','anon-hide','hide',false);}else{trackEvent('flyout','user-hide','hide',false);}},update:function($doc){$('.js-abstractPreviewPane__title').text($doc.find('.docTitle').text());$('.js-abstractPreviewPane__abstract').text($doc.data('doc-abstract'));$('.js-abstractPreviewPane__readArticleLink').attr('href',$doc.find('.docTitle a.titleSegment').attr('href'));$('.js-abstractPreviewPane__addToList').attr('href','#'+$doc.data('internal_perm_id'));$('.js-abstractPreviewPane').find('.js-bookmark').data('internalpermid',$doc.find('.js-bookmark').data('internalpermid'));$('.js-abstractPreviewPane').find('.js-bookmark').attr('href',$doc.find('.js-bookmark').attr('href'));if($doc.find('.js-bookmark').hasClass("bookmarked")){$('.js-abstractPreviewPane').find('.js-bookmark i.icon-fixed-width').removeClass(resultButtons.BOOKMARKICON_CLASSES).addClass(resultButtons.BOOKMARKICON_BOOKMARKED);var $bks=$('.js-bookmark[href="'+$doc.find('.js-bookmark').attr('href')+'"]').unbind('click');resultButtons.setupRemove($bks);}else{$('.js-abstractPreviewPane').find('.js-bookmark i.icon-fixed-width').removeClass(resultButtons.BOOKMARKICON_CLASSES).addClass(resultButtons.BOOKMARKICON_NOT_BOOKMARKED);var $bks=$('.js-bookmark[href="'+$doc.find('.js-bookmark').attr('href')+'"]').unbind('click');resultButtons.setupBookmark($bks);}
$('.js-abstractPreviewPane').find('.js-cite').data('internal_perm_id',$doc.data('internal_perm_id'));$('#page1s1').attr("src","/assets/images/blanks1.png");$('#page1s2').attr("src","/assets/images/blanks2.png");$('#page1s3').attr("src","/assets/images/blanks3.png");$('#page1s4').attr("src","/assets/images/blanks4.png");if($doc.data('restricted')==="true"||$doc.data('restricted')===true){$('#page1s1').attr("src","/assets/images/docnas1.png");$('#page1s2').attr("src","/assets/images/docnas2.png");$('#page1s3').attr("src","/assets/images/docnas3.png");$('#page1s4').attr("src","/assets/images/docnas4.png");}else{$('#page1s1').attr("src",$doc.data('s1'));$('#page1s2').attr("src",$doc.data('s2'));$('#page1s3').attr("src",$doc.data('s3'));$('#page1s4').attr("src",$doc.data('s4'));}
var anonUser=$('#user_meta_data').metadata().anonymous;if(anonUser){trackEvent('flyout','anon-update','update',false);}else{trackEvent('flyout','user-update','update',false);}},clear:function(){$('.js-abstractPreviewPane__title').text("Loading title...");$('.js-abstractPreviewPane__abstract').text("Loading abstract...");$('.js-abstractPreviewPane__readArticleLink').attr('href','#');$('.js-abstractPreviewPane__addToList').attr('href',"#");$('.js-abstractPreviewPane').find('.js-bookmark').data('internalpermid',"");$('.js-abstractPreviewPane').find('.js-bookmark').attr('href','#');$('.js-abstractPreviewPane').find('.js-bookmark i.icon-fixed-width').removeClass('icon-bookmark icon-spinner icon-spin icon-remove').addClass('icon-bookmark-empty');$('.js-abstractPreviewPane').find('.js-bookmark').unbind('click');$('.js-cite').data('internal_perm_id',"");$('#page1s1').attr("src","/assets/images/blanks1.png");$('#page1s2').attr("src","/assets/images/blanks2.png");$('#page1s3').attr("src","/assets/images/blanks3.png");$('#page1s4').attr("src","/assets/images/blanks4.png");},}
var dateHandler={getNYearsAgo:function(yearsAgo){var todaysDate=new Date();return new Date(todaysDate.getTime()-yearsAgo*365*24*60*60*1000);},isNYearsAgo:function(dateFrom,dateTo,numYears){if(!dateTo||(dateTo!==DateVerifier.formatJsDate(new Date()))){return false;}
var nYearsAgo=dateHandler.getNYearsAgo(numYears);if(!dateFrom||(dateFrom!==DateVerifier.formatJsDate(nYearsAgo))){return false;}
return true;},setDateInput:function(inputId,calendarInputId,value){$('#'+inputId).val(value);$('#'+calendarInputId).val(value);},setupDateRange:function(value){var dateFrom='';var dateTo='';if(value==='last-year'){dateFrom=DateVerifier.formatJsDate(dateHandler.getNYearsAgo(1));dateTo=DateVerifier.formatJsDate(new Date());}else if(value==='3-year'){dateFrom=DateVerifier.formatJsDate(dateHandler.getNYearsAgo(3));dateTo=DateVerifier.formatJsDate(new Date());}
dateHandler.setDateInput('dateFrom','hiddenDateFrom',dateFrom);dateHandler.setDateInput('dateTo','hiddenDateTo',dateTo);},validateDateFunction:function(inputId,calendarInputId,isToDate){return function(){var formattedDate=DateVerifier.parseDate($('#'+inputId).val(),isToDate);if(formattedDate!==null){dateHandler.setDateInput(inputId,calendarInputId,formattedDate);}else{$('#'+calendarInputId).val('');}};},setupDatePicker:function(){if(dateHandler.isNYearsAgo($('#hiddenDateFrom').val(),$('#hiddenDateTo').val(),1)){$('#dateMode').val('last-year');$('#advancedDateCustom').addClass('hide');}else if(dateHandler.isNYearsAgo($('#hiddenDateFrom').val(),$('#hiddenDateTo').val(),3)){$('#dateMode').val('3-year');$('#advancedDateCustom').addClass('hide');}
$('#dateFrom').blur(dateHandler.validateDateFunction('dateFrom','hiddenDateFrom',false));$('#dateTo').blur(dateHandler.validateDateFunction('dateTo','hiddenDateTo',true));$('#dateMode').change(function(){dateHandler.setupDateRange($(this).val());});}};var DateVerifier={parseDate:function(str,end){var match=/^\s*((\d{1,2})([\.\/\-,]|\s+))?((\d{1,2})([\.\/\-,]|\s+))?(\d{2}(\d{2})?)\s*$/.exec(str);if(match===null)return null;var year=this.convertYear(match[7]);var month=null;var day=null;if(match[2]){month=Number(match[2]);}
if(match[5]){day=Number(match[5]);}
if(month===null&&day===null){if(!end){month=1;day=1;}else{month=12;day=31;}}else if(day===null){if(!end){day=1;}else{day=this.daysInMonth(month,year);}}
var jDate=new Date(year,month-1,day);var valid=jDate.getFullYear()==year&&jDate.getMonth()==(month-1)&&jDate.getDate()==day;if(!valid)return null;return this.formatDate(month,day,year);},formatDate:function(m,d,y){return y+"-"+this.leadingZero(m)+"-"+this.leadingZero(d);},formatJsDate:function(d){return this.formatDate(d.getMonth()+1,d.getDate(),d.getFullYear());},convertYear:function(str){var y=Number(str);if(y<100){if(y<20){return"20"+DateVerifier.leadingZero(y);}else{return"19"+y;}}
return str;},leadingZero:function(num){return(num<10)?"0"+num:""+num;},daysInFebruary:function(year){if(year%400===0)return 29;if(year%100===0)return 28;if(year%4===0)return 29;return 28;},monthArray:[31,28,31,30,31,30,31,31,30,31,30,31],daysInMonth:function(month,year){if(month!=2){return this.monthArray[month-1];}else{return this.daysInFebruary(year);}},compareValidFormattedDates:function(date1,date2){var split1=date1.split("/");var m1=parseInt(split1[0],10);var d1=parseInt(split1[1],10);var y1=parseInt(split1[2],10);var split2=date2.split("/");var m2=parseInt(split2[0],10);var d2=parseInt(split2[1],10);var y2=parseInt(split2[2],10);if(y1!==y2)return y1-y2;if(m1!==m2)return m1-m2;if(d1!==d2)return d1-d2;return 0;}};var emailAlerts={setup:function(){emailAlerts.setupForm('#emailAlertsForm');emailAlerts.subscribeToEmailAlert($('#emailAlertsForm'));},subscribeToEmailAlert:function(formId){$(formId).submit();},setupForm:function(formId){var form=$(formId);var button=form.find('btn');var ajaxUrl='/subscriptions';form.submit(function(e){e.preventDefault();$.ajax({url:ajaxUrl,data:form.serialize(),type:"POST",dataType:"json",beforeSend:function(){form.addClass('hide');form.after('<p class="loading">&nbsp;</p>');},complete:function(){form.next('p.loading').remove();},success:function(response){if(response.msg=='login_success'){window.location.reload();}else if(response.msg=='subscribed'){var $successDiv=$('<div>').addClass('well well-sm alert-success animated bounceIn').css({padding:"8px 35px 8px 14px",borderRadius:"3px",}).html('<strong>Your search has been automatically saved!</strong><br/> View your Saved Searches in <a href="/saved-searches"><strong>My Library</strong></a>.');$('.search-sidebar').append($successDiv);}else if(response.msg=='welcome_email_sent'||response.msg=='success'){form.addClass('hide');$('#emailAlertsSignUp .confirmMsg').addClass('hide');$('#emailAlertsSignUp .successMsg strong').text(form.find('input[name=email]').val());$('#emailAlertsSignUp .successMsg').removeClass('hide');}else if(response.msg=='already_registered'){emailAlerts.toLogin();form.removeClass('hide');$('#emailAlertsLogin .loginTitle .errorMsg').text('Sorry, this email address is already registered.<br />If you\'re an existing user, you may log in to subscribe:').removeClass('hide');}else if(response.msg=='unverified_email'){emailAlerts.toLogin();form.removeClass('hide');$('#emailAlertsLogin .loginTitle .errorMsg').text('This account has already been registered but not validated yet. To validate your account and complete your registration, please check your inbox for a DeepDyve confirmation and click the validation link, then set up your password when prompted.').removeClass('hide');}else if(response.msg=='login_fail'){form.removeClass('hide');form.prev('p.errorMsg').text('Login failed. Please try again.').removeClass('hide');}else if(response.msg=='blank_email'){form.removeClass('hide');form.prev('p.errorMsg').text('Email address missing').removeClass('hide');}else if(response.msg=='subscription_error'||response.msg=='error'){form.removeClass('hide');form.prev('p.errorMsg').text('Connection failed. Please try again later.').removeClass('hide');}else if(response.msg=='null_params'){form.removeClass('hide');form.prev('p.errorMsg').text('System error. Please try again later.').removeClass('hide');}else{form.removeClass('hide');}}});});}};var stdtopro={init:function(){$('#stdtopro').click(function(){$.ajax({type:"GET",url:"/std-to-pro",dataType:'json',data:{},beforeSend:function(){$('#stdtopro').button('loading');},complete:function(){},success:function(response){var userErrorMsg;if(response.msg==='success'){window.location.reload();}else{window.location.reload();}},error:function(){}});});}};var signupModalActions={setup:function(){if($('#modal-signup-form').length>0){$('#modal-signup-form').validate({rules:{email:{required:true,email:true},emailconfirm:{equalTo:'#email2'},password:{minlength:6,required:true}},errorPlacement:function(error,element){error.addClass('help-block').appendTo(element.closest('.controls'));},highlight:function(label){$(label).closest('.control-group').addClass('error').removeClass('success');},success:function(label){$(label).closest('.control-group').addClass('success').removeClass('error');},submitHandler:function(form){signupModalActions.signupForAccount();},messages:{emailconfirm:{equalTo:"Make sure you entered your email correctly."}}});var changeModaltoFreeTrialHandler=function(){$('#bsSignUpModal h3').text('Sign up for your 14-Day Free Trial Now!');$('#freelancerSar').remove();$('#freelancerSarButton').show();$('#bsSignUpModal').unbind('hidden',changeModaltoFreeTrialHandler);};var freelancerSarHandler=function(){$('#bsSignUpModal h3').text('Step 1: Create your Freelancer Account Now');$('<input>').attr({type:'hidden',id:'freelancerSar',name:'freelancerSar',value:'true'}).appendTo('#modal-signup-form');$('#freelancerSarButton').hide();$('#bsSignUpModal').modal('show');$('#bsSignUpModal').unbind('hidden',freelancerSarHandler);$('#bsSignUpModal').on('hidden',changeModaltoFreeTrialHandler);};$('#freelancerSarButton').click(function(e){trackEvent('springerSar','click','pay-now-docview-click',false);$('#bsSignUpModal').on('hidden',freelancerSarHandler);$('#bsSignUpModal').modal('hide');});}},signupForAccount:function(){var freelancerSar='';if($('#freelancerSar').length>0){freelancerSar=$('#freelancerSar').val();}
$.ajax({type:"POST",url:"/docview-signup",dataType:'json',data:{'email':$('#email2').val(),'confirmemail':$('#confirmemail2').val(),'newpassword':$('#password2').val(),'subscriptionType':'freelancer','permId':$('#docPermId').val(),'country':$('#country').val(),'freelancerSar':freelancerSar,'newsletterOptIn':'true',},beforeSend:function(){$('#modalSignUpLink').button('loading');trackEvent("signup-attempt","freemium","",false);},complete:function(){},success:function(response){var userErrorMsg;if(response.msg==='already_registered'){userErrorMsg='This email address is already registered. Please log in to your account or try another.';$('#bsSignUpModal .alert-error').html(userErrorMsg).removeClass('hide');$('#modalSignUpLink').button('reset');trackEvent("signup-failed","freemium",response.msg,false);}else if(response.msg==='password_too_short'){userErrorMsg='Please make sure that your password is at least 6 characters.';$('#bsSignUpModal .alert-error').html(userErrorMsg).removeClass('hide');$('#modalSignUpLink').button('reset');trackEvent("signup-failed","freemium",response.msg,false);}else{_cio.track("signup-for-freelancer-no-slots");trackEvent("signup-confirm","freemium","",false);if(freelancerSar&&freelancerSar==='true'){window.location.reload();}else{setTimeout(function(){window.location.href=$('#ccFormURL2').val();},100);}}},error:function(){var userErrorMsg='An error occurred while trying to sign up. Please try again.';$('#bsSignUpModal .alert-error').html(userErrorMsg).removeClass('hide');$('#modalSignUpLink').button('reset');trackEvent("signup-failed","freemium","ajax_error",false);}});}};var ddxSignupActions={setup:function(){var ddxSignupFormValidator;var $ddxSignupForm=$('#ddx-signup-form');var isValid=function(selector,validator){return $(selector).val()!==''&&validator.element(selector);};if($ddxSignupForm.length){ddxSignupFormValidator=$ddxSignupForm.validate({validClass:"ddx--form-control--success",errorClass:"ddx--form-control--error",errorElement:"label",rules:{email:{required:true,email:true,},emailconfirm:{required:true,equalTo:'#email2',},password:{minlength:6,required:true,},},messages:{email:{required:'Please enter your email address.',email:'Please enter your email address.'},emailconfirm:{required:'Please make sure you entered your email correctly.',email:'Please make sure you entered your email correctly.',equalTo:'Please make sure you entered your email correctly.',},},submitHandler:function(form){ddxSignupActions.signupForAccount();},});$ddxSignupForm.on('blur change paste submit focusin focusout keyup',function(e){if(e.type=='submit')return 0;setTimeout(function(){var allValid=isValid('#email2',ddxSignupFormValidator)&&isValid('#confirmemail2',ddxSignupFormValidator)&&isValid('#password2',ddxSignupFormValidator);$ddxSignupForm.find('button[type="submit"]').prop('disabled',!allValid);},50);});}},signupForAccount:function(){var $form=$('#ddx-signup-form');var $submitBtn=$form.find('button[type="submit"]');function displayError(message){$form.find('.errorMsg').html(message).removeClass('ddx--hide');$submitBtn.html('Sign up&nbsp;<i class="icon icon-chevron-right"></i>');}
function handleSignup(){setTimeout(function(){window.location.href=$('#ccFormURL2').val();},100);}
$.ajax({type:"POST",url:"/docview-signup",dataType:"json",data:{email:$form.find('#email2').val(),confirmemail:$form.find('#confirmemail2').val(),newpassword:$form.find('#password2').val(),subscriptionType:'freelancer',permId:$form.find('#docPermId').val(),country:$form.find('#country').val(),freelancerSar:$form.find('#freelancerSar').val(),newsletterOptIn:'true',},beforeSend:function beforeSend(){$form.find('.errorMsg').addClass('ddx--hide');$submitBtn.prop('disabled',true).html($submitBtn.data('loading-text'));trackEvent("signup-attempt","freemium","",false);},complete:function complete(){},success:function success(response){switch(response.msg){case'already_registered':displayError('<span>This email address is already registered. Please <a class="ddx" href="/login">log in</a> to your account or try another.</span>');trackEvent("signup-failed","freemium",response.msg,false);break;case'password_too_short':displayError('<span>Please make sure that your password is at least 6 characters.</span>span>');trackEvent("signup-failed","freemium",response.msg,false);break;default:_cio.track("signup-for-freelancer-no-slots");trackEvent("signup-confirm","freemium","",false);handleSignup();break;}},error:function error(){displayError('<span>An error occurred while trying to sign up. Please try again.</span>');trackEvent("signup-failed","freemium","ajax_error",false);},});},}
var rentalActions={confirmBubble:null,docTitle:null,setup:function(){$('.openRentalActionLogIn').click(function(e){e.preventDefault();rentalActions.toPane('#purchaseSignUpFlow','#purchaseLoginFlow');rentalActions.showBubble();});$('#purchaseLoginFlow .toSignUp').click(function(e){e.preventDefault();rentalActions.toPane('#purchaseLoginFlow','#purchaseSignUpPlans');});$('#purchaseToLogin a').click(function(e){e.preventDefault();rentalActions.toPane('#purchaseSignUpFlow','#purchaseLoginFlow');});$('#plansToLogin a').click(function(e){e.preventDefault();rentalActions.toPane('#purchaseSignUpPlans','#purchaseLoginFlow');});rentalActions.preLoginForm('#purchaseFormLogin');$('#verifyForm .confirmActions .btn.btn-primary').click(function(e){e.preventDefault();rentalActions.verifyCC($('#purchaseType').val());});$('.docviewPayPalSubmit').click(function(e){e.preventDefault();if($('.docviewPayPalSubmit .loading').length>0)return false;var purchaseType=$(this).attr('href').split('#paypal-')[1];$(this).find('.paypalbutton').hide();$(this).append('<p class="loading"><i class="icon-spinner icon-spin"></i> Redirecting to PayPal...</p>');rentalActions.verifyCC(purchaseType,'paypal');trackEvent('doc-viewer','/paypal/'+purchaseType,docViewer.permId,false);}).popover();$('#paymentForm .confirmActions .btn.btn-primary').click(function(e){e.preventDefault();var metadata=$(this).metadata();var paypal=parseInt(metadata.useSavedPaypalInfo)?'paypal':undefined;rentalActions.payForDoc('rental',paypal);});$('#addToRentalsButton').one('click',function(e){e.preventDefault();rentalActions.addToRentals();});$('#freelancerCorpRentButton').one('click',function(e){e.preventDefault();$('#addToRentalsButton').click();$(this).button('loading');});$('#rental-btn').click(function(e){e.preventDefault();$('#bsPricingModal').modal('hide');$('#bsModalRental').modal('show');});$('#free-trial-flow').click(function(e){e.preventDefault();setTimeout(function(){window.location.href=$('#ccFormURL2').val();},100);});$("#welcomeMessageRentalButton").click(function(e){e.preventDefault();$('#bsWelcomeMessageModal').modal('hide');$('#bsModalRentalFreemium').modal('show');});$("#singleArticleRentalButton").click(function(e){e.preventDefault();$('#bsModalRentalFreemium').modal('hide');$('#bsModalRental').modal('show');});$("#useEmptyRentalSlotLinkFreemium").click(function(e){e.preventDefault();$('#bsModalRentalFreemium').modal('hide');$('#bsModalRental').modal('show');});$("#useRentalSlotLinkFreemiumCompleteEmpty").click(function(e){e.preventDefault();$('#bsModalRental').modal('show');});$("#purchaseDownloadFreemiumComplete").click(function(e){e.preventDefault();$('#'+$(this).attr('href').substr(1)).modal('show');});$("#downloadDialogFreemium").click(function(e){e.preventDefault();$('#bsDownloadModal').modal('hide');$('#bsModalRentalFreemium').modal('show');});$('#downloadDialogEmptyRentals').click(function(e){e.preventDefault();$('#bsDownloadModal').modal('hide');$('#bsModalRental').modal('show');});$(".use-rental-slot").click(function(e){e.preventDefault();rentalActions.useRentalSlot(null,null);});$("#useRentalSlotLink, .useRentalSlotLink").click(function(e){e.preventDefault();rentalActions.useRentalSlot(e,null);});$("#useRentalSlotLinkFreemium").click(function(e){e.preventDefault();rentalActions.useRentalSlot(null,null);});$("#useRentalSlotLinkFreemiumComplete").click(function(e){e.preventDefault();rentalActions.useRentalSlot(null,null);});$(".use-freemium-rental").click(function(e){if(!$("#useFreemiumLink").hasClass('disabled')){e.preventDefault();rentalActions.useFreemiumRental();}});$("#useFreemiumLink").click(function(e){if(!$("#useFreemiumLink").hasClass('disabled')){e.preventDefault();rentalActions.useFreemiumRental();}});$("#useFreemiumLinkOnly").click(function(e){if(!$("#useFreemiumLinkOnly").hasClass('disabled')){e.preventDefault();rentalActions.useFreemiumRental();}});$('#downloadPaymentFormButton').click(function(e){e.preventDefault();rentalActions.payForDoc('download');});$('#downloadPaymentFormButtonRD').click(function(e){e.preventDefault();rentalActions.payForDoc('reprintsDeskDownload');});$('#purchasePrint').click(function(e){_cio.track("print-button-clicked");});$('#printPaymentFormButton').click(function(e){e.preventDefault();rentalActions.payForDoc('print');});rentalActions.docTitle=$('#docTitle').text();if(rentalActions.docTitle){rentalActions.docTitle=trim(rentalActions.docTitle);}else{rentalActions.docTitle='Document Rental';}},toPane:function(hidePane,showPane){hidePane=$(hidePane);showPane=$(showPane);hidePane.addClass('hide');showPane.removeClass('hide');},preLoginForm:function(formId){var form=$(formId);var button=form.find('.btn-primary');var permId=$('#impression_id').metadata().perm_id;form.submit(function(e){e.preventDefault();var ajaxUrl;if(form.is('#purchaseFormSignUp')){ajaxUrl='/docview-signup';}else if(form.is('#purchaseFormLogin')){ajaxUrl='/login-ajax';}else{ajaxUrl='/doc-view-ajax';}
$.ajax({url:ajaxUrl,data:form.serialize()+'&permId='+permId+'&docTitle='+rentalActions.docTitle,type:"POST",dataType:"json",beforeSend:function(){button.button('loading');}}).success(function(response){if(response.msg=='login_success'){trackEvent("rental-confirm","login",permId,false);setTimeout(function(){window.location.reload();},100);}else if(response.msg=='success'){window.location.reload();}else if(response.msg=='unverified_email'){form.next('p.loading').remove();rentalActions.toPane('#purchaseSignUpFlow','#purchaseLoginFlow');form.removeClass('hide');$('#purchaseLoginFlow .errorMsg').text('This account has already been registered but not validated yet. To validate your account and complete your registration, please check your inbox for a DeepDyve confirmation and click the validation link, then set up your password when prompted.').removeClass('hide');}else if(response.msg=='already_registered'){form.next('p.loading').remove();rentalActions.toPane('#purchaseSignUpFlow','#purchaseLoginFlow');form.removeClass('hide');$('#purchaseLoginFlow .errorMsg').text('Sorry, this email address is already registered. If you\'re an existing user, you may log in here:').removeClass('hide');}else if(response.msg=='login_fail'){button.button('reset');form.find('.errorMsg').text('Whoops, login failed. Please try again.').removeClass('hide');}else if(response.msg=='blank_email'){button.button('reset');form.find('.errorMsg').text('Don\'t forget to enter your email address').removeClass('hide');}else if(response.msg=='blank_password'){button.button('reset');form.find('.errorMsg').text('Don\'t forget to enter your password').removeClass('hide');}else if(response.msg=='error'){form.next('p.loading').remove();form.removeClass('hide');form.prev('p.errorMsg').text('Connection failed. Please try again later.').removeClass('hide');}else if(response.msg=='null_params'){form.next('p.loading').remove();form.removeClass('hide');form.prev('p.errorMsg').text('System error. Please try again later.').removeClass('hide');}else{form.next('p.loading').remove();form.removeClass('hide');}});});},verifyCC:function(purchaseType,paypal){var rentalParams=$('#priceMetadata').metadata();var rentalMetadata=rentalParams.rentalMetadata;var rentalSessionId=rentalParams.rentalSessionId;var paidRentalOnly=rentalParams.paidRentalOnly;var docUrl=rentalParams.docUrl;var permId=rentalParams.permId;var paymentType=$('input[name=paymentType]:checked').val();var enableReferenceTxns=false;var price,confirmationModal,ajaxUrl,advertisedPrice,verifyId,couponAllowed,usePdfCoupon,modalDialog,printPages,rentalDays;rentalDays=0;if(purchaseType==='download'){ajaxUrl='/pay-for-download';price=rentalParams.downloadPrice;advertisedPrice=rentalParams.downloadPrice;verifyId=$('#downloadVerifyId').val();confirmationModal=$('#bsDownloadConfirmationModal');couponAllowed=rentalParams.couponAllowed;usePdfCoupon=rentalParams.pdfCoupon;modalDialog='download';}else if(purchaseType==='reprintsDeskDownload'){ajaxUrl='/pay-for-download';price=reprintsDesk.price;advertisedPrice=reprintsDesk.price;verifyId=reprintsDesk.verifyIdRD;confirmationModal=$('#bsDownloadConfirmationRDModal');couponAllowed=rentalParams.couponAllowed;usePdfCoupon=rentalParams.pdfCoupon;modalDialog='downloadRD';}else if(purchaseType==='print'){ajaxUrl='/pay-for-print';price=rentalParams.printPrice;printPages=purchase.print.getSelectedPages('unpaid');advertisedPrice=rentalParams.printPrice;verifyId=$('#printVerifyId').val();confirmationModal=$('#bsPrintConfirmationModal');modalDialog='print';}else{purchaseType='rental';price=rentalParams.price;advertisedPrice=rentalParams.price;verifyId=rentalParams.verifySessionId;confirmationModal=$('#bsModalRentalConfirmation');modalDialog='docPurchase';if($('#enablebundles').length>0){ajaxUrl='/pay-for-bundle';}else if($('#enableSingleArticleRental').length>0){ajaxUrl='/pay-for-rental';price=$('#enableSingleArticleRental').text();advertisedPrice=price;rentalDays=1;}else{ajaxUrl='/cc-info';}}
if(paypal==='paypal'){ajaxUrl='/paypal-purchase';var urlQuery=window.location.href.slice(window.location.href.indexOf('?')+1).split('&');var urlParam;var useDifferentPayment=false;for(var i=0;i<urlQuery.length;i++){urlParam=urlQuery[i].split('=');if(urlParam[0]==='useDifferentPayment'){useDifferentPayment=urlParam[1];break;}}
if(useDifferentPayment){enableReferenceTxns=$('#enableReferenceTxnsCCForm').is(":checked");}else{enableReferenceTxns=$('#enableReferenceTxns'+modalDialog).is(":checked");}
if($('#enablebundles').length>0&&purchaseType==='rental'){purchaseType='rentalpack';}else if($('#enableSingleArticleRental').length>0&&purchaseType==='rental'){price=$('#enableSingleArticleRental').text();advertisedPrice=price;}}
$.ajax({type:'POST',url:ajaxUrl,dataType:'json',data:{'purchaseType':purchaseType,'paymentType':paymentType,'account':$('#account').val(),'expirationMonth':$('#expirationMonth').val(),'expirationYear':$('#expirationYear').val(),'cvv2':$('#cvv2pro').val(),'saveCCInfo':$('#verifyFormSaveCCInfo:checked').val(),'permId':permId,'verifySessionId':verifyId,'verifyId':verifyId,'price':price,'printPages':printPages,'docTitle':rentalActions.docTitle,'docPrice':advertisedPrice,'advertisedPrice':advertisedPrice,'rentalMetadata':rentalMetadata,'rentalSessionId':rentalSessionId,'purchaseMetadata':rentalMetadata,'purchaseSessionId':rentalSessionId,'paidRentalOnly':paidRentalOnly,'docUrl':docUrl,'newCCInfo':true,'usePdfCoupon':usePdfCoupon,'couponAllowed':couponAllowed,'enableReferenceTxns':enableReferenceTxns,'rentalDays':rentalDays,},beforeSend:function(){$('#verifyFormButton').button('loading');},error:function(){if(paypal==='paypal'){$('.paymentFormSelection .paypalbutton').show();$('#verifyFormButton').button('reset');$('.paymentFormSelection .loading').remove();$('.paymentFormSelection .alert-error').removeClass('hide');}else{$('#verifyFormButton').button('reset');$('#verifyForm .confirmActions').removeClass('loading');$('#verifyForm .alert-error').removeClass('hide');}},success:function(response){var userErrorMsg;if(response.msg==='success'||(response.msg==='exception'&&response.exception==='already_purchased')){if(paypal==='paypal'){location.replace(response.paypalRedirectUrl);return false;}
if(purchaseType==='rental'||purchaseType==='rentalpack'){$('#bsModalRentalConfirmation .creditcardPayment').removeClass('hide');$('#bsModalRentalConfirmation .paypalPayment').addClass('hide');confirmationModal.find('.actions .btn.btn-primary').attr('href',$('#nonSecureUrl').attr('href'));}else if(purchaseType==='download'){$('.docDownload').attr('href',response.downloadUrl);}else if(purchaseType==='reprintsDeskDownload'){$('#bsDownloadConfirmationRDModal .creditcardPayment').removeClass('hide');$('#bsDownloadConfirmationRDModal .paypalPayment').addClass('hide');if(typeof response.orderStatusUrl!='undefined'){$('#orderStatusUrl').text(response.orderStatusUrl).attr('href',response.orderStatusUrl);$('#orderStatusUrl').parent().show();}
confirmationModal.find('.actions .btn.btn-primary').attr('href',$('#nonSecureUrl').attr('href'));_cio.track("download_RD");}
trackEvent(purchaseType+"-confirm","verify-cc",permId,false);$('#bsCCFormModal').modal('hide');confirmationModal.modal('show');}else if(paypal==='paypal'){$('.paymentFormSelection .paypalbutton').show();$('#verifyFormButton').button('reset');$('.paymentFormSelection .loading').remove();if(response.msg==='exception'&&response.exception==='previous_order_still_processing'){$('.paymentFormSelection .rd-error').removeClass('hide');}else{$('.paymentFormSelection .generic-pp-error').removeClass('hide');}}else if(response.msg==='exception'){$('#verifyFormButton').button('reset');$('#verifyForm .confirmActions').removeClass('loading');if(response.exception==='blank_account'){userErrorMsg='Please enter a credit card number and try again, or <a href="/contact">contact us</a>.';}else if(response.exception==='anonymous_user'){userErrorMsg='Please log in and try again, or <a href="/contact">contact us</a>.';}else if(response.exception==='blank_expirationMonth'){userErrorMsg='Please enter an expiration month and try again, or <a href="/contact">contact us</a>.';}else if(response.exception==='blank_expirationYear'){userErrorMsg='Please enter an expiration year and try again, or <a href="/contact">contact us</a>.';}else if(response.exception==='invalid_expirationMonth'){userErrorMsg='Please enter the correct expiration month and try again, or <a href="/contact">contact us</a>.';}else if(response.exception==='invalid_expirationYear'){userErrorMsg='Please enter the correct expiration year and try again, or <a href="/contact">contact us</a>.';}else if(response.exception==='blank_firstName'){userErrorMsg='Please enter your first name and try again, or <a href="/contact">contact us</a>.';}else if(response.exception==='blank_lastName'){userErrorMsg='Please enter your last name and try again, or <a href="/contact">contact us</a>.';}else if(response.exception==='blank_zip'){userErrorMsg='Please enter a zip code and try again, or <a href="/contact">contact us</a>.';}else if(response.exception==='blank_country'){userErrorMsg='Please enter your country and try again, or <a href="/contact">contact us</a>.';}else if(response.exception==='blank_cvv2'){userErrorMsg='Please enter the security code on your card and try again, or <a href="/contact">contact us</a>.';}else if(response.exception==='previous_order_still_processing'){userErrorMsg='You have already purchased this PDF and Reprints Desk is still in the process of fulling the order. Please check your order status page for more details.';}else{userErrorMsg='We were unable to process your credit card. Please double check your billing information or <a href="/contact">contact us</a>.';}
$('#verifyForm .alert-error').removeClass('hide').html(userErrorMsg).removeClass('hide');}else{$('#verifyFormButton').button('reset');$('#verifyForm .confirmActions').removeClass('loading');$('#verifyForm .alert-error').removeClass('hide').html(userErrorMsg).removeClass('hide');}}});},payForDoc:function(purchaseType,paymentType){var rentalParams=$('#priceMetadata').metadata();var rentalMetadata=rentalParams.rentalMetadata;var rentalSessionId=rentalParams.rentalSessionId;var paidRentalOnly=rentalParams.paidRentalOnly;var permId=rentalParams.permId;var campaignTxn=false;var useSavedPaypalInfo=false;var thisModalButton;var thisModalButtonMetadata;var ajaxUrl,verifyId,price,advertisedPrice,thisModal,confirmActions,errorMsg,confirmationModal,couponAllowed,docPrice,printPages,usePdfCoupon;if(purchaseType==='download'){ajaxUrl='/pay-for-download';verifyId=$('#downloadVerifyId').val();price=rentalParams.downloadPrice;advertisedPrice=rentalParams.downloadPrice;thisModal=$('#bsDownloadModal');confirmActions=$('#bsDownloadModal .confirmActions');errorMsg=$('#bsDownloadModal .errorMsg');confirmationModal=$('#bsDownloadConfirmationModal');couponAllowed=rentalParams.couponAllowed;usePdfCoupon=rentalParams.pdfCoupon;thisModalButton=$('#downloadPaymentFormButton');}else if(purchaseType==='reprintsDeskDownload'){ajaxUrl='/pay-for-download';verifyId=reprintsDesk.verifyIdRD;price=reprintsDesk.price;advertisedPrice=reprintsDesk.price;thisModal=$('#bsDownloadRDModal');confirmActions=$('#bsDownloadRDModal .confirmActions');errorMsg=$('#bsDownloadRDModal .errorMsg');confirmationModal=$('#bsDownloadConfirmationRDModal');usePdfCoupon=rentalParams.pdfCoupon;couponAllowed=rentalParams.couponAllowed;thisModalButton=$('#downloadPaymentFormButtonRD');}else{purchaseType='rental';verifyId=rentalParams.verifySessionId;price=$('#paymentFormPrice').val();docPrice=rentalParams.price;advertisedPrice=rentalParams.price;thisModal=$('#bsModalRental');confirmActions=$('#paymentForm .confirmActions');errorMsg=$('#paymentForm .errorMsg');confirmationModal=$('#bsModalRentalConfirmation');thisModalButton=$('#paymentFormButton');if($('#enablebundles').length>0){purchaseType='rentalpack';ajaxUrl='/pay-for-bundle';}else if($('#enableSingleArticleRental').length>0){ajaxUrl='/pay-for-rental';price=$('#enableSingleArticleRental').text();advertisedPrice=price;rentalDays=1;}else{ajaxUrl='/pay-for-doc';}}
if(thisModalButton.length>0){thisModalButtonMetadata=thisModalButton.metadata();if(thisModalButtonMetadata){useSavedPaypalInfo=Boolean(thisModalButtonMetadata.useSavedPaypalInfo)===true;campaignTxn=thisModalButtonMetadata.campaignTxn===true;}}
if(paymentType==='paypal'||useSavedPaypalInfo){ajaxUrl='/paypal-purchase';}
$.ajax({type:'POST',url:ajaxUrl,dataType:'json',data:{'permId':permId,'verifySessionId':verifyId,'verifyId':verifyId,'price':price,'printPages':printPages,'docTitle':rentalActions.docTitle,'docPrice':advertisedPrice,'advertisedPrice':advertisedPrice,'rentalMetadata':rentalMetadata,'rentalSessionId':rentalSessionId,'purchaseMetadata':rentalMetadata,'purchaseSessionId':rentalSessionId,'paidRentalOnly':paidRentalOnly,'campaignTxn':campaignTxn,'useSavedPaypalInfo':useSavedPaypalInfo,'usePdfCoupon':usePdfCoupon,'couponAllowed':couponAllowed,'purchaseType':purchaseType},beforeSend:function(){thisModalButton.button('loading');},error:function(){if(paymentType==='paypal'){$('.paymentFormSelection .paypalbutton').show();thisModalButton.button('reset');$('.paymentFormSelection .loading').remove();$('.paymentFormSelection .alert-error').removeClass('hide');}else{thisModalButton.button('reset');confirmActions.removeClass('loading');errorMsg.removeClass('hide').html('We were unable to charge your credit card. Please try a different card using the link below or <a href="/contact">contact us</a>.').removeClass('hide');errorMsg.removeClass('hide').html('We were unable to charge your credit card. Please try a different card using the link below or <a href="/contact">contact us</a>.').removeClass('hide');}},success:function(response){if(response.msg==='success'||(response.msg==='exception'&&response.exception==='already_purchased')){if(paymentType==='paypal'&&!useSavedPaypalInfo){location.replace(response.paypalRedirectUrl);return false;}else if(purchaseType==='rental'||purchaseType==='rentalpack'||purchaseType==='reprintsDeskDownload'){confirmationModal.find('.actions .btn.btn-primary').attr('href',window.location.href.split('#')[0].split('autoClick=')[0]);}else if(purchaseType==='download'){$('.docDownload').attr('href',response.downloadUrl);}
if(purchaseType==='reprintsDeskDownload'){if(typeof response.orderStatusUrl!='undefined'){$('#orderStatusUrl').text(response.orderStatusUrl).attr('href',response.orderStatusUrl);$('#orderStatusUrl').parent().show();_cio.track("download_RD");}}
thisModal.modal('hide');confirmationModal.modal('show');if(response.transactionPaymentType==='paypalSaved'){$('.creditcardPayment').addClass('hide');$('.paypalSavedPayment').removeClass('hide');}else{$('.paypalSavedPayment').addClass('hide');$('.creditcardPayment').removeClass('hide');}
trackEvent(purchaseType+"-confirm","pay",permId,false);}else if(paymentType==='paypal'){$('.paymentFormSelection .paypalbutton').show();thisModalButton.button('reset');$('.paymentFormSelection .loading').remove();$('.paymentFormSelection .alert-error').removeClass('hide');}else if(response.msg==='exception'&&response.exception==='previous_order_still_processing'){var userErrorMsg='You have already purchased this PDF and Reprints Desk is still in the process of fulling the order. Please check your order status page for more details.';thisModalButton.button('reset');confirmActions.removeClass('loading');errorMsg.removeClass('hide').html(userErrorMsg).removeClass('hide');}else{thisModalButton.button('reset');confirmActions.removeClass('loading');errorMsg.removeClass('hide').html('We were unable to charge your credit card. Please try a different card using the link below or <a href="/contact">contact us</a>.').removeClass('hide');}}});},addToRentals:function(){var priceMetadata=$('#priceMetadata').metadata();var campaignTxn=false;var addToRentals=$('#addToRentalsCampaign');if(addToRentals.length>0){var addToRentalsMetadata=addToRentals.metadata();if(addToRentalsMetadata){campaignTxn=addToRentalsMetadata.campaignTxn;}}
var docPrice=priceMetadata.price;var rentalMetadata=priceMetadata.rentalMetadata;var rentalSessionId=priceMetadata.rentalSessionId;var paidRentalOnly=priceMetadata.paidRentalOnly;var permId=$('#impression_id').metadata().perm_id;$.ajax({type:'POST',url:'/pay-for-doc',dataType:'json',data:{'permId':permId,'docTitle':rentalActions.docTitle,'price':priceMetadata.price,'verifyId':priceMetadata.verifySessionId,'verifySessionId':priceMetadata.verifySessionId,'docPrice':docPrice,'rentalMetadata':rentalMetadata,'rentalSessionId':rentalSessionId,'paidRentalOnly':paidRentalOnly,'campaignTxn':campaignTxn===true},beforeSend:function(){$('#addToRentalsButton').button('loading');},success:function(response){if(response.msg==='success'){trackEvent("rental-confirm","add",permId,false);$('#bsModalRentalConfirmation .actions .btn.btn-primary').attr('href',window.location.href.split('#')[0].split('autoClick=')[0]);$('#bsModalRentalFreemium').modal('hide');$('#bsModalRental').modal('hide');$('#bsModalRentalConfirmation').modal('show');}else{$('#addToRentalsButton').button('reset');$('#addToRental .confirmActions').removeClass('loading');if($('#addToRental .confirmActions .errorMsg').length<=0){$('<p class="errorMsg clear">').insertBefore('#addToRental .confirmActions');}
$('#addToRental .confirmActions .errorMsg').text('We apologize but we are experiencing technical difficulties.  Please try again later.');$('#addToRentalsButton').one('click',function(e){e.preventDefault();rentalActions.addToRentals();});}}});},useRentalSlot:function(e,type){var psPdfMetadata=undefined;if($('#ps_pdf_meta_data').length>0){psPdfMetadata=$('#ps_pdf_meta_data').metadata();}
var priceMetadata=$('#priceMetadata').metadata();var confirmRental;if(e){confirmRental=$(e.target).metadata().confirmRental;}
if(typeof confirmRental=='undefined'){confirmRental=true;}
if(type==='print'){$('#purchasePrintConfirm').button('loading');if(priceMetadata.currentlyRenting==='true'){printActions.usePrintSlot(e);return;}}else{$('.use-rental-slot').button('loading');$('#useRentalSlotLink, .useRentalSlotLink').button('loading');$('#useRentalSlotLinkFreemium').button('loading');$('#useRentalSlotLinkFreemiumComplete').button('loading');}
$.ajax({type:"POST",url:"/use-rental-slot",dataType:'json',data:{'permId':priceMetadata.permId,'verifySessionId':priceMetadata.verifySessionId,'docPrice':priceMetadata.price,'rentalMetadata':priceMetadata.rentalMetadata,'rentalSessionId':priceMetadata.rentalSessionId,'paidRentalOnly':priceMetadata.paidRentalOnly},complete:function(){if(psPdfMetadata!==undefined){if(type==='print'){printActions.usePrintSlot(e);}
$('#useRentalSlotLink').html('<i class="icon-file-alt"></i> Opened for Reading');$('.tip').remove();$('.pagination').hide();$('#pspdfkitpreview').hide();$('#pspdfkit').show();rentalActions.loadPSPDFKit('#pspdfkit',$('#ps_pdf_meta_data').metadata().docId,$('#ps_pdf_meta_data').metadata().jwt);}else{if(type==='print'){printActions.usePrintSlot(e);}else{trackEvent("rental-confirm","subscription",priceMetadata.permId,false);$('#bsModalRentalConfirmation .actions .btn.btn-primary').attr('href',window.location.href.split('#')[0].split('autoClick=')[0]);$('#bsDownloadModal').modal('hide');$('#bsModalRental').modal('hide');$('#bsModalRentalFreemium').modal('hide');if(confirmRental){$('#bsModalRentalConfirmation').modal('show');}else{setTimeout(function(){window.location.href=((window.location.href.split('#')[0]).split('autoClick=')[0]);},100);}}}}});},loadPSPDFKit:function(divId,docId,jwt){var defaultItems=PSPDFKit.defaultToolbarItems;var items=defaultItems.filter(function(item){return item.type==='sidebar-thumbnails'||item.type==='sidebar-document-outline'||item.type==='pager'||item.type==='pan'||item.type==='zoom-out'||item.type==='zoom-in'||item.type==='zoom-mode'||item.type==='spacer'||item.type==='search';});const initialViewState=new PSPDFKit.ViewState({currentPageIndex:0,zoom:PSPDFKit.ZoomMode.FIT_TO_WIDTH});PSPDFKit.load({disableTextSelection:true,initialViewState:initialViewState,toolbarItems:items,container:divId,documentId:docId,authPayload:{'jwt':jwt},licenseKey:'WdeZspkLZG4x3buDcBlOKSCk1fPU7viX6nRu_VpBsx6Ds6HYydmM8E1PWtcQiK6ZmjfAKNlcfRndGRmfupXHljbCKAPk6_ZyN775BG0bwRAmXeMSxzHRqftp6uqste65z36PTVEpGYqm-sVZlN_o2HKAuBN4gUfXhGXBpI6IkwS8VIUHMADXn3RWkwgmzFVF4N1w6QejOZNZ0wZf9Uy7CaTT7ljSnM8EtKIXOiE14h9X-mHEeXPhhPn4-ThtyrzBgJk2S1dNVS4jo6dT5hjxQHv3sl_fgroxFQFmv9FMo_m0rgrLvLncLtEKW8zmCwGvdDcMdYX_5dvqZd5AZ7Kj6RKT_ZUeRx5eGJx2jgSP9hJfz3S12OsWPCrv4wzhc8QNUK789QzlOQSp6H7h4ovCLa9vo0hxJGLqwQ1RuFaS6jHQ3ZzjEkWPu-SBL1cONEL1Ps-cVeKvZhhMtp25rpSUPgpjdTED-S5hphLWOPBpRpXiZsIZoyM0xmFx5ov-MMRqkjLoZtdmMei5xdra1GkcxQ==',instant:false}).then(function(instance){$('#bsDownloadModal').modal('hide');$('#bsModalRental').modal('hide');$('#bsModalRentalFreemium').modal('hide');}).catch(function(error){console.error(error.message)})},signupForAccount:function(){$.ajax({type:"POST",url:"/docview-signup",dataType:'json',data:{'email':$('#email').val(),'confirmemail':$('#email').val(),'newpassword':$('#password').val(),'subscriptionType':'freelancer','newsletterOptIn':'true',},beforeSend:function(){$('#modalSignUpLinkDocView').button('loading');$('.animated.bounceInUp.alert').hide();},complete:function(){},success:function(response){var userErrorMsg;if(response.msg==='already_registered'){userErrorMsg='This email address is already registered. Please log in to your account or try another.';if($('.signup-form-inline').length>0){$('.animated.bounceInUp.alert').hide();$('.signup-form-inline .signup-form-container').after('<div class="animated bounceInUp alert">'+userErrorMsg+'</div>');}else{$('#bsModalRental .alert-error').html(userErrorMsg).removeClass('hide');}
$('#modalSignUpLinkDocView').button('reset');}else if(response.msg==='password_too_short'){userErrorMsg='Please make sure that your password is at least 6 characters.';if($('.signup-form-inline').length>0){$('.animated.bounceInUp.alert').hide();$('.signup-form-inline .signup-form-container').after('<div class="animated bounceInUp alert">'+userErrorMsg+'</div>');}else{$('#bsModalRental .alert-error').html(userErrorMsg).removeClass('hide');}
$('#modalSignUpLinkDocView').button('reset');}else{_cio.track("signup-for-freelancer-no-slots");trackEvent("signup-confirm","freemium","",false);setTimeout(function(){window.location.href=$('#ccFormURL').val();},100);}},error:function(){var userErrorMsg='An error occurred while trying to sign up. Please try again.';if($('.signup-form-inline').length>0){$('.animated.bounceInUp.alert').hide();$('.signup-form-inline .signup-form-container').after('<div class="animated bounceInUp alert">'+userErrorMsg+'</div>');}else{$('#bsModalRental .alert-error').html(userErrorMsg).removeClass('hide');}
$('#modalSignUpLinkDocView').button('reset');}});},useFreemiumRental:function(){var priceMetadata=$('#priceMetadata').metadata();$('#useFreemiumLink').button('loading');$('#useFreemiumLinkOnly').button('loading');$.ajax({type:"POST",url:"/freemium-rental",dataType:'json',data:{'permId':priceMetadata.permId,'verifySessionId':priceMetadata.verifySessionId,'docPrice':priceMetadata.price,'rentalMetadata':priceMetadata.rentalMetadata,'rentalSessionId':priceMetadata.rentalSessionId,'paidRentalOnly':priceMetadata.paidRentalOnly},complete:function(){_cio.track("Did-short-rental");trackEvent("rental-confirm","freemium",priceMetadata.permId,false);setTimeout(function(){window.location.href=$('#baseDocUrl').text()+'?shortRental=true';},100);}});}};var shortRental={count:null,init:function(){if($('#doc_meta_data').length>0&&$('#doc_meta_data').metadata().currentlyRenting=='true'&&$('#doc_meta_data').metadata().freemium){count=parseInt($('#useRentalFreemium').text());if(count<=0){docViewer.showFreemiumPurchaseOptions();}else{setInterval(shortRental.timer,60000);}}},timer:function(){if(count>0){count=count-1;}
if(count===1){$('#useRentalFreemium').text(' '+count.toString()+' minute');}else{$('#useRentalFreemium').text(' '+count.toString()+' minutes');}
if(count<=0&&$('#bsModalRentalConfirmation').attr('aria-hidden')=='true'&&$('#bsModalRental').attr('aria-hidden')=='true'&&$('#bsDownloadModal').attr('aria-hidden')=='true'&&($('bsDownloadRDModal').length<=0||($('#bsDownloadRDModal').length>0&&$('#bsDownloadRDModal').attr('aria-hidden')=='true'))){docViewer.showFreemiumPurchaseOptions();}}};var googleUser={init:function(){$('.googleLogin').click(function(e){e.preventDefault();googleUser.login();});$('.googleLogout').click(function(e){e.preventDefault();if(((typeof gapi)==='undefined')){}else{googleUser.auth2.signOut().then(function(){googleUser.logout();});}});},signinCallback:function(authResult){$('.googleLogin').button('reset');if(authResult){var userMetadata;if(authResult.code){userMetadata=$('#user_meta_data').metadata();if(!userMetadata.googleUser){var permId='';if($('#doc_meta_data').length>0){permId=$('#doc_meta_data').metadata().perm_id;}
permId=permId||sessionStorage.getItem('docPermId');var country='';if($('#country').length>0){country=$('#country').val();}
if($('#freelancerSar').length>0){var freelancerSar=$('#freelancerSar').val();}else{var freelancerSar='';}
$.ajax({url:'/google-signup',async:false,data:'code='+authResult.code+'&docPermId='+permId+'&country='+country+'&freelancerSar='+freelancerSar,type:'GET',success:function(resp){if(resp.msg==='success'){if(resp.newUser){var permId='';if($('#doc_meta_data').length>0){permId=$('#doc_meta_data').metadata().perm_id;}
permId=permId||sessionStorage.getItem('docPermId');if(freelancerSar&&freelancerSar==='true'){location.reload();}else{if(permId){location.href='https://'+location.host+'/signup-form?docPermId='+permId;}else{location.href='https://'+location.host+'/signup-form';}}}else{location.reload(true);}}}});}}else{}}else{}},login:function(){if(((gapi)==='undefined')){}else{$('.googleLogin').button('loading');googleUser.auth2.grantOfflineAccess({'redirect_uri':'postmessage'}).then(googleUser.signinCallback);}},logout:function(){$('.googleLogout').button('loading');if(getUrlParameter('plugin')){location.href='http://'+location.host+'/logout?pluginLogout=true';}else{location.href='http://'+location.host+'/logout';}}};var fbUser={init:function(){$('.facebookLogin').click(function(e){e.preventDefault();fbUser.login();});$('.facebookLogout').click(function(e){e.preventDefault();if(((typeof FB)==='undefined')){}else{FB.getLoginStatus(function(response){if(response.status==='connected'){FB.logout(function(response2){fbUser.logout();});}else{fbUser.logout();}},true);}});},login:function(){if(((typeof FB)==='undefined')){}else{$('.facebookLogin').button('loading');FB.login(function(response){if(!response.authResponse){$('.facebookLogin').button('reset');return false;}
if(!response.authResponse.accessToken){$('.facebookLogin').button('reset');return false;}
var country='';if($('#country').length>0){country=$('#country').val();}
var freelancerSar='';if($('#freelancerSar').length>0){freelancerSar=$('#freelancerSar').val();}
var userMetadata=$('#user_meta_data').metadata();if(!userMetadata.facebookUser){var permId='';if($('#doc_meta_data').length>0){permId=$('#doc_meta_data').metadata().perm_id;}
permId=permId||sessionStorage.getItem('docPermId');$.ajax({url:'/facebook-signup',async:false,data:'docPermId='+permId+'&country='+country+'&freelancerSar='+freelancerSar,type:'GET',success:function(resp){if(resp.msg==='success'){if(resp.newUser){var permId='';if($('#doc_meta_data').length>0){permId=$('#doc_meta_data').metadata().perm_id;}
permId=permId||sessionStorage.getItem('docPermId');if(freelancerSar&&freelancerSar==='true'){location.reload();}else{if(permId){location.href='https://'+location.host+'/signup-form?docPermId='+permId;}else{location.href='https://'+location.host+'/signup-form';}}}else{location.reload(true);}}else{location.reload(true);}}});}else{location.reload(true);}},{scope:'email'});}},logout:function(){$('.facebookLogout').button('loading');if(getUrlParameter('plugin')){location.href='http://'+location.host+'/logout?pluginLogout=true';}else{location.href='http://'+location.host+'/logout';}}};var googleAnalytics={init:function(){$('.js-track').each(function(idx,el){var $el=$(el);var triggers=($el.data('track-triggers')||"mouseup touchend").split(/\s/g);$.each(triggers,function(idx,trigger){$el.on(trigger,googleAnalytics.setupTracking.bind($el));});});},setupTracking:function(e){var anonUser=$('#user_meta_data').metadata().anonymous;var trackCat=$(this).attr("data-track-cat");var trackLabel=$(this).attr("data-track-label");var isKeyEvent=e.type==="keydown"||e.type==="keyup";if(isKeyEvent){var keys=String($(this).data("track-keys")||"13").split(/\s/g).map(function(el){return parseInt(el,10);});if(!keys.includes(e.which)){return;}}
if(anonUser){trackEvent(trackCat,'anon-'+e.type,trackLabel,false);}else{trackEvent(trackCat,'user-'+e.type,trackLabel,false);}}};var deepdyve={flashPageView:function(page){var impression_id_params=$('#impression_id').metadata();var params={'event_name':'flash_page_view','impression_id':impression_id_params.impression_id,'async':true,'page':page};},flashNextPage:function(){rentalActions.showBubble();}};var requestReceipt={init:function(){$('#bsRequestReceiptModal').on('show',function(e){requestReceipt.emailReceiptRequestAuto();});},emailReceiptRequestAuto:function(){_cio.track("requested-receipt",{email:$('#user_meta_data').metadata().email});$.ajax({type:"GET",url:"/request-receipt",dataType:'json',data:{'email':$('#user_meta_data').metadata().email,},beforeSend:function(){},complete:function(){},success:function(response){if(response.msg==='success'){}else{}},error:function(){}});}};var undoCancel={init:function(){$('#undoCancelSubmit').click(function(e){e.preventDefault();undoCancel.undoCancel();});},undoCancel:function(){_cio.track("undo-cancel",{email:$('#user_meta_data').metadata().email});$.ajax({type:"GET",url:"/undo-cancel",dataType:'json',beforeSend:function(){$('#undoCancelSubmit').button('loading');},complete:function(){},success:function(response){if(response.msg==='success'){window.location.reload();}else{window.location.reload();}},error:function(){window.location.reload();}});}};var cite={init:function(){$('.js-cite').click(function(e){e.preventDefault();cite.showCiteDialog($(this).data('internal_perm_id'));});$('.cite-apa').focusin(function(){$('.cite-apa').css({'border':'1px solid #0174DF','user-select':'all','-o-user-select':'all','-moz-user-select':'all','-khtml-user-select':'all','-webkit-user-select':'all',});});$('.cite-apa').focusout(function(){$('.cite-apa').css('border-style','none');});$('.cite-mla').focusin(function(){$('.cite-mla').css({'border':'1px solid #0174DF','user-select':'all','-o-user-select':'all','-moz-user-select':'all','-khtml-user-select':'all','-webkit-user-select':'all',});});$('.cite-mla').focusout(function(){$('.cite-mla').css('border-style','none');});},showCiteDialog:function(permId){$('#bsCiteModal'+(permId?('-'+permId):'')).modal('show');},};var increasePrints={init:function(){$('#incPrintsSubmit').click(function(){increasePrints.increasePrints(function(success,number){if(success){printPagesLeft=number;$('#incPrintsSubmit').addClass('hide');$('#spanPrintPagesLeft').html(printPagesLeft);$('#clearAllPages').click();}});});},increasePrints:function(callback){$.ajax({type:"GET",url:"/increase-prints",dataType:'json',beforeSend:function(){$('#incPrintsSubmit').button('loading');},complete:function(){},success:function(response){if(response.msg==='success'){if(typeof(callback)==typeof(Function)){return callback(true,response.number);}else{window.location.reload();}}else{if(typeof(callback)==typeof(Function)){return callback(false,response.number);}else{window.location.reload();}}},error:function(){window.location.reload();}});}};var hibernatePlan={init:function(){$('#hibernatePlanSubmit').click(function(e){e.preventDefault();hibernatePlan.hibernatePlanRequest();});$('#undoHibernateBtn').click(function(e){e.preventDefault();hibernatePlan.cancelHibernateRequest();});$('.reactivateAccountBtn').click(function(e){e.preventDefault();hibernatePlan.reactivateAccount();});},hibernatePlanRequest:function(){_cio.track("requested-hibernate-plan",{email:$('#user_meta_data').metadata().email});$.ajax({type:"GET",url:"/hibernate?cmd=hibernate",dataType:'json',beforeSend:function(){$('#hibernatePlanSubmit').button('loading');},complete:function(){},success:function(response){if(response.msg==='success'){$('#hibernatePlanSubmit').hide();$('#hibernateOfferModal .successMsg').slideDown(200);$('#hibernateOfferModal .closeBtn').hide();$('.refreshPageBtn').click(function(){window.location.reload();});}else{$('#hibernateOfferModal .successMsg').removeClass('alert-success').addClass('alert-error').html('<strong>Error</strong> There was an error processing your request. Please <span class="refreshPageBtn">reload the page</span> and try again.').slideDown(200);$('#hibernatePlanSubmit').button('reset').addClass('refreshPageBtn').text('Reload page');$('.refreshPageBtn').click(function(){window.location.reload();});}},error:function(){$('#hibernateOfferModal .successMsg').removeClass('alert-success').addClass('alert-error').html('<strong>Error</strong> There was an error processing your request. Please <span class="refreshPageBtn">reload the page</span> and try again.').slideDown(200);$('#hibernatePlanSubmit').button('reset').addClass('refreshPageBtn').text('Reload page');$('.refreshPageBtn').click(function(){window.location.reload();});}});},cancelHibernateRequest:function(){_cio.track("canceled-hibernate-request",{email:$('#user_meta_data').metadata().email});$.ajax({type:"GET",url:"/hibernate?cmd=cancel",dataType:'json',beforeSend:function(){$('#undoHibernateBtn').button('loading');},complete:function(){},success:function(response){if(response.msg==='success'){$('.hibernateAlert').removeClass('alert-warning alert-info').addClass('alert-success animate bounceInUp').html("<strong>Ok!</strong> We'll no longer put your subscription on hold. You'll continue to have uninterrupted access to DeepDyve <button class='btn btn-default refreshPageBtn'>Ok</button>").slideDown(200);$('.refreshPageBtn').click(function(){window.location.reload();});}else{$('.hibernateAlert').removeClass('alert-warning alert-info alert-success').addClass('alert-error animate bounceInUp').html('<strong>Error</strong> There was an error processing your request. Please <span class="refreshPageBtn">reload the page</span> and try again.').slideDown(200);$('.refreshPageBtn').click(function(){window.location.reload();});}},error:function(){$('.hibernateAlert').removeClass('alert-warning alert-success').addClass('alert-error animate bounceInUp').html('<strong>Error</strong> There was an error processing your request. Please <span class="refreshPageBtn">reload the page</span> and try again.').slideDown(200);$('.refreshPageBtn').click(function(){window.location.reload();});}});},reactivateAccount:function(){_cio.track("Resumed hibernated plan",{email:$('#user_meta_data').metadata().email});$.ajax({type:"GET",url:"/hibernate?cmd=resume",dataType:'json',beforeSend:function(){$('.reactivateAccountBtn').button('loading');},complete:function(){},success:function(response){if(response.msg==='success'){$('.hibernateAlert').removeClass('alert-warning alert-error alert-info').addClass('alert-success animate bounceInUp').html('<strong>Ok!</strong> Your DeepDyve subscription is now active. <button class="btn btn-primary refreshPageBtn">Continue</button>').show();$('#resumeSubscriptionDialog .modal-footer .btn').hide();$('.refreshPageBtn').click(function(){window.location.reload();});}else{$('.hibernateAlert').removeClass('alert-warning alert-success').addClass('alert-error animate bounceInUp').html('<strong>Error</strong> There was an error processing your request. Please <span class="refreshPageBtn">reload the page</span> and try again.').show();}
$('.refreshPageBtn').click(function(){window.location.reload();});},error:function(){$('.hibernateAlert').removeClass('alert-warning alert-success').addClass('alert-error animate bounceInUp').html('<strong>Error</strong> There was an error processing your request. Please <span class="refreshPageBtn">reload the page</span> and try again.').show();$('.refreshPageBtn').click(function(){window.location.reload();});}});}};var bulkActions={init:function(){$('.js-onboarding-serp-selectAll, .js-onboarding-serp-dropDown').tooltip();$('.js-onboarding-serp-dropDown').on('click',function(){$('#bsSignUpModal').modal('show');});if($('.js-bulkAction-addToList').length>0){bulkActions.render();}
$('.js-bulkAction-delete').on('click',bulkActions._removeFromList);$('.js-bulkAction-addToList').on('change',bulkActions.render);$('.js-bulkAction-addToList-selectAll').on('change',bulkActions.render);},_updateSelectAll:function(event){var selectedCount=$('input.js-bulkAction-addToList:checked').length;var $checkboxes=$('input.js-bulkAction-addToList');var $selectAll=$('input.js-bulkAction-addToList-selectAll');if(event&&event.target===$selectAll[0]){$selectAll.prop('indeterminate',false);}else{$selectAll.prop('indeterminate',selectedCount>0&&$checkboxes.length>selectedCount);$selectAll.attr('checked',selectedCount>0&&$checkboxes.length===selectedCount);}},_updateText:function(){$('.js-bulkAction-selectedCount').text($('input.js-bulkAction-addToList:checked').length+' selected');},_updateCheckboxes:function(){var $checkboxes=$('input.js-bulkAction-addToList');var $selectAll=$('input.js-bulkAction-addToList-selectAll');if(!$selectAll.prop('indeterminate')){$checkboxes.prop('checked',$selectAll.prop('checked'));}},_updateDocuments:function(){var $selectedCheckboxes=$('input.js-bulkAction-addToList:checked');var $unselectedCheckboxes=$('input.js-bulkAction-addToList:not(:checked)');$selectedCheckboxes.closest('.doc').addClass('is-selected');$unselectedCheckboxes.closest('.doc').removeClass('is-selected');},_revealActionButtons:function(){var selectedCount=$('input.js-bulkAction-addToList:checked').length;$('.js-bulkAction-buttons').toggleClass('hidden',selectedCount===0);$('.js-AppRoot--ListContainer').toggleClass('hidden',selectedCount===0);},_removeFromList:function(event){var permidPromises=Array.from(document.querySelectorAll('input.js-bulkAction-addToList')).filter(function(el){return el.checked}).map(function(el){return el.dataset.docid}).map(function(id){return ddapi.listsinfo.removedocsfromlist(id).then(function(res){if(res.data&&!res.data.success)throw new Error('Network request failed');return res;});});Promise.resolve(permidPromises).then(function(permidPromises){$(event.target).html('<i class="icon-spinner icon-spin"></i>');return Promise.all(permidPromises).then(function(res){res.forEach(console.log);}).catch(function(err){}).then(function(res){$(event.target).html('remove selected');window.location.reload();});});},render:function(event){bulkActions._updateSelectAll(event);bulkActions._updateCheckboxes();bulkActions._updateDocuments();bulkActions._updateText();bulkActions._revealActionButtons();}}
var journalSearchResults={init:function(){if($('.journalSearchResults').length>0){$('.journalSearchResults .moreBtn').click(function(e){e.preventDefault();journalSearchResults.getMore();});var matches=$('.journalSearchResults').metadata().numMatchedJournals;if(matches<=10){$('.journalSearchResults .moreBtn').hide();if(matches===0){$('.journalSearchResults ul').hide();$('.journalSearchResults').append('<p>No matches</p>');}}else{$('.journalSearchResults .moreBtn').css('display','inline-block');}}},getMore:function(){_cio.track("loaded-more-journals-serp");var num=$('#numMatchedJournals').text();var query=$('.journalSearchResults').metadata().query;var params='query='+query+'&n='+num+'&skip=10';$('.journalSearchResults .moreBtn').button('loading');$.ajax({type:"GET",url:"/search-journals",dataType:'json',data:params,beforeSend:function(){},complete:function(){},success:function(response){if(response.msg==='success'){$('.journalSearchResults .moreBtn').hide();var journalList=$('.journalSearchResults ul');var obj=response.results;var journalName;var journalUrl;for(var key in obj){journalName=obj[key].highlighted_journal_title;journalUrl=obj[key].journal_url;journalList.append('<li><p><a href="/browse/journals/'+journalUrl+'">'+journalName+'</a></p></li>');}}else{$('.journalSearchResults .moreBtn').button('reset');}},error:function(){$('.journalSearchResults .moreBtn').button('reset');}});}};var inviteFriends={init:function(){$('#inviteModalForm').submit(function(e){e.preventDefault();});$('#inviteModalForm').validate({rules:{userName:{required:true},invitedName:{minlength:2,required:true},invitedEmail:{required:true,email:true}},highlight:function(label){$(label).closest('.control-group').addClass('error');},success:function(label){$(label).closest('.control-group').addClass('success');},submitHandler:function(form){inviteFriends.emailInviteFriend();}});},emailInviteFriend:function(){_cio.track("invited-friend",{invitedName:$('#invitedName').val(),invitedEmail:$('#invitedEmail').val(),userTag:$('#userTag').val(),userName:$('#userName').val()});$('#inviteSubmitButton').button('loading');$('#inviteModal .systemMsg').addClass('alert-success').slideDown();window.setTimeout(function(){$('#invitedEmail').val('');$('#invitedName').val('');$('#inviteSubmitButton').button('reset');$('#inviteModal .systemMsg').removeClass('alert-success').hide();$('#inviteModal').modal('hide');},5000);}};var formHelpers={init:function(){$('.noEnterSubmit').keypress(function(e){if(e.which==13)e.preventDefault();});}};var groupPlanPage={init:function(){if($('#groupPlanInfoForm').length<1){return;}
$('#groupPlanInfoForm').submit(function(e){e.preventDefault();});$('#groupPlanInfoForm').validate({rules:{inputFirstName:"required",inputEmail:{required:true,email:true},inputCompany:{required:true},numResearchers:{required:true}},errorPlacement:function(error,element){error.addClass('help-block').appendTo(element.closest('.controls'));},highlight:function(label){$(label).closest('.control-group').addClass('error').removeClass('success');},success:function(label){$(label).closest('.control-group').addClass('success').removeClass('error');},submitHandler:function(form){groupPlanPage.submitGroupPlanInfo();$('#groupPlanInfoBtn').prop('disabled',true);}});},submitGroupPlanInfo:function(){$.post("/groupplans",{firstName:$('#inputFirstName').val(),email:$('#inputEmail').val(),company:$('#inputCompany').val(),numResearchers:$('#numResearchers').val()});$('#groupPlanInfoForm .systemMsg').text("We've got your request and will be emailing you soon!").addClass('alert-success').slideDown();}};var sharing={init:function(){$('#shareFB').click(function(e){_cio.track("Shared-on-facebook");});$('#shareTT').click(function(e){_cio.track("Shared-on-twitter");});},};var searchAlertActions={templateSource:Handlebars.compile('<li id="searchAlert-{{saId}}" class="{{optionalClass}}">'+'<div class="saved-search-section">'+'{{#if isNew}}'+'<div class="badge pull-left badge-info" style="margin: 8px 8px 8px -56px">'+'new'+'</div>'+'{{/if}}'+'<div class="saved-search-del">'+'<a href="#saId{{saId}}" class="removeSearchAlert"><i class="icon-minus icon-fixed-width ss-del-icon" data-name="{{query}}" href="#saId{{saId}}"></i></a>'+'</div>'+'<div class="saved-search-query">'+'<a class="readingListLink" title="{{queryUrl}}" href="{{queryUrl}}" target="_blank" data-said="{{saId}}">{{query}}</a>'+'</div>'+'<div class="saved-search-source">'+'<span class="savedSearchSource">Saved from {{source}}</span>'+'</div>'+'</div>'+'</li>'),init:function(){if($('.userSearchAlerts').length===0){return;}
$.ajax({type:"GET",url:"/manage-search-alerts",dataType:'json',beforeSend:function(){},complete:function(){},success:function(response){$('.userSearchAlerts').html('');var parts=[];var len=response.results.length;var newItems=parseInt($('.newSavedSearchCount').text(),10);var item;var i;var currentSearchAlertId=getUrlVars().saId;for(i=0;i<len;i++){var isNew=i<newItems;var currentItem=response.results[i];var optionalClass='';if(currentSearchAlertId&&currentSearchAlertId===currentItem.id){optionalClass='active';}
var queryUrl=currentItem.testUrl;if(currentItem.type==='pubmed'){queryUrl="https://www.ncbi.nlm.nih.gov"+currentItem.testUrl;}
if(currentItem.type==='googleScholar'){queryUrl="https://scholar.google.com"+currentItem.testUrl;}
var source="DeepDyve";if(currentItem.type==='pubmed'){source="Pubmed";}
if(currentItem.type==='googleScholar'){source="Google Scholar";}
var date="Unknown Date";if(currentItem.createdOn!=="1969-12-31 00:00:00.0"){date=currentItem.createdOn;}
parts.push(searchAlertActions.templateSource({'saId':currentItem.id,'optionalClass':optionalClass,'query':currentItem.query,'queryUrl':queryUrl,'source':source,'isNew':isNew}));}
$('.userSearchAlerts').append(parts.join(''));$('.removeSearchAlert').click(function(e){e.preventDefault();$('#removeSearchAlertModalButton').attr('href',$(e.target).attr('href'));$('#removeSearchAlertName').empty();$('#removeSearchAlertName').html(" "+decode($(e.target).attr('data-name')));$('#bsRemoveSearchAlertConfirmationModal').modal('show');});if(len<1){$('.searchAlerts-blankStateInstructions').slideDown();}},error:function(){}});$('#removeSearchAlertModalButton').click(function(e){e.preventDefault();searchAlertActions.removeSearchAlert($(e.target).attr('href'));});},removeSearchAlert:function(id){var searchAlertId=id.replace("#saId","");var urlSearchAlertId=getUrlVars().saId;$.ajax({type:"POST",url:"/manage-search-alerts",dataType:'json',data:{'cmd':'remove','id':searchAlertId,},beforeSend:function(){$('#removeSearchAlertModalButton').button('loading');},complete:function(){},success:function(response){if(response.success){if(urlSearchAlertId===searchAlertId){window.location.href='/saved-searches';}else{$('#searchAlert-'+searchAlertId).remove();$('#removeSearchAlertModalButton').button('reset');$('#bsRemoveSearchAlertConfirmationModal').modal('hide');$('#listMessage').html('Your saved search has successfully been removed!').show();}}else{var userErrorMsg='An error occurred while trying to remove your saved search. Please try again.';$('#bsRemoveSearchAlertConfirmationModal .alert-error').html(userErrorMsg).removeClass('hide');$('#removeSearchAlertModalButton').button('reset');}},error:function(){var userErrorMsg='An error occurred while trying to remove your saved search. Please try again.';$('#bsRemoveSearchAlertConfirmationModal .alert-error').html(userErrorMsg).removeClass('hide');$('#removeSearchAlertModalButton').button('reset');}});}};var readingListActions={init:function(){readingListActions.getReadingLists();$('#removeReadingListModalButton').click(function(e){e.preventDefault();readingListActions.removeList($(e.target).attr('href'));});$('.editrl').click(function(e){e.preventDefault();if($(e.target).parent('.editrl').length>0){$('#bsAddDocToReadingListModal .systemMsg').hide();readingListActions.setupModReadingListModal($(e.target).parent().attr('href'));}else{$('#bsAddDocToReadingListModal .systemMsg').hide();readingListActions.setupModReadingListModal($(e.target).attr('href'));}});$('.removeDoc').click(function(e){e.preventDefault();if($(e.target).parent('.removeDoc').length>0){readingListActions.removeDocFromList($(e.target).parent().attr('href'),e);}else{readingListActions.removeDocFromList($(e.target).attr('href'),e);}});$('.removeExtDoc').click(function(e){e.preventDefault();if($(e.target).parent('.removeExtDoc').length>0){readingListActions.removeExtDocFromList($(e.target).parent().attr('href'),e);}else{readingListActions.removeExtDocFromList($(e.target).attr('href'),e);}});$('#bsAddReadingListModal').on('shown',function(){$('#addReadingListName').focus();});$('#bsModifyReadingListModal').on('shown',function(){$('#renameReadingListName').select();});readingListActions.setupFormValidation();},setupFormValidation:function(){$('#bsAddReadingListModal form, #bsModifyReadingListModal form, #bsAddDocToReadingListModal form').submit(function(e){e.preventDefault();});$('#bsAddReadingListModal form').validate({rules:{addReadingListName:{required:true}},messages:{addReadingListName:{required:'Make sure to give your list a name'}},errorPlacement:function(error,element){error.addClass('help-block').appendTo(element.closest('.controls'));},highlight:function(label){$(label).closest('.control-group').addClass('error');},success:function(label){$(label).closest('.control-group').addClass('success');},submitHandler:function(form){readingListActions.addList($('#addReadingListName').val());}});$('#bsModifyReadingListModal form').validate({rules:{renameTitle:{required:true}},messages:{renameTitle:{required:'Make sure to give your list a name'}},errorPlacement:function(error,element){error.addClass('help-block').appendTo(element.closest('.controls'));},highlight:function(label){$(label).closest('.control-group').addClass('error');},success:function(label){$(label).closest('.control-group').addClass('success');},submitHandler:function(form){readingListActions.renameList($('#renameReadingListName').val(),$('#modifyReadingListModalButton').attr('data-listid'));}});$('#bsAddDocToReadingListModal form').validate({rules:{addReadingListAndDocName:{required:true}},messages:{addReadingListAndDocName:{required:'Make sure to give your list a name'}},errorPlacement:function(error,element){error.addClass('help-block').appendTo(element.closest('.controls'));},highlight:function(label){$(label).closest('.control-group').addClass('error');},success:function(label){$(label).closest('.control-group').addClass('success');},submitHandler:function(form){readingListActions.createAndAddDocToList($('#bsAddDocToReadingListModal form .permId').val(),$('#addReadingListAndDocName').val());}});},setupModReadingListModal:function(id){var permId=id.replace("#","");$('#addReadingListAndDocName').val('');$('#bsAddDocToReadingListModal .btn').button('reset');$.ajax({type:"POST",url:"/listsinfo",dataType:'json',data:{'cmd':'getlistswithpermid','permids':permId,},beforeSend:function(){},complete:function(){},success:function(response){var obj=response.lists;$('#associatedReadingLists').empty();if(obj===undefined||obj===null||obj===''||obj=='undefined'){$('#pickListHeader').hide();$('#addToListLabel').hide();$('#bsAddDocToReadingListModal hr').hide();}else{$('#pickListHeader').show();$('#addToListLabel').show();$('#bsAddDocToReadingListModal hr').show();for(var key in obj){var html='<li><label class="checkbox addToList"><input type="checkbox" value="'+key+'"';if(obj[key].hasDoc==="true"){html+=' data-docid="'+obj[key].docId+'" ';html+=' checked ';}
html+='>'+obj[key].name+' <i class="icon-spin icon-spinner hide"></i></label></li>';$('#associatedReadingLists').append(html);}
$('.addToList').change(function(e){e.preventDefault();var docId=$(e.target).attr('data-docid');var listId=$(e.target).val();if($(e.target).prop('checked')){$(e.target).prop('disabled',true);$(e.target).parent().find('.icon-spinner').css('display','inline-block');readingListActions.addDocToList(permId,listId,e);}else{$(e.target).prop('disabled',true);$(e.target).parent().find('.icon-spinner').css('display','inline-block');readingListActions.removeDocFromList(docId,e,permId);}});}
$('#bsAddDocToReadingListModal form .permId').val(permId);$('#bsAddDocToReadingListModal').modal('show');},error:function(){}});},addList:function(listName){$.ajax({type:"POST",url:"/editlists",dataType:'json',data:{'cmd':'addlist','name':listName,},beforeSend:function(){$('#addReadingListModalButton').button('loading');trackEvent('article-lists','add-list:attempt','list-modal',false);},complete:function(){},success:function(response){if(response.success){$('#addReadingListModalButton').button('reset');$('#bsAddReadingListModal').modal('hide');$('#listMessage').html('Your list has successfully been created!').show();$('#addReadingListName').val('');$('.userReadingList').empty();trackEvent('article-lists','add-list:success','list-modal',false);readingListActions.getReadingLists();if($('#ddSearchResults').length){window.location.reload();}}else{var userErrorMsg='An error occurred while trying to add your reading list. Please try again.';$('#bsAddReadingListModal .alert-error').html(userErrorMsg).removeClass('hide');$('#addReadingListName').focus();$('#addReadingListModalButton').button('reset');trackEvent('article-lists','add-list:error','list-modal',false);}},error:function(){var userErrorMsg='An error occurred while trying to add your reading list. Please try again.';$('#bsAddReadingListModal .alert-error').html(userErrorMsg).removeClass('hide');$('#addReadingListName').focus();$('#addReadingListModalButton').button('reset');trackEvent('article-lists','add-list:error','list-modal',false);}});},addDocToList:function(permId,listId,e){$.ajax({type:"POST",url:"/editlists",dataType:'json',data:{'cmd':'adddocstolist','id':listId,'permids':permId,},beforeSend:function(){$('#addDocModalButton').button('loading');trackEvent('article-lists','add-docs:attempt','list-modal',false);},complete:function(){},success:function(response){if(response.success){$(e.target).prop('checked',true);readingListActions.setupModReadingListModal(permId);$('#bsAddDocToReadingListModal .systemMsg').html('Your article has been added! You can see your lists at your <a href="/lists">DeepDyve Homepage</a>.').show();trackEvent('article-lists','add-docs:success','list-modal',false);}else{var userErrorMsg='Sorry, an error occurred while trying to add this article to your reading list. Please try again.';$('#bsAddDocToReadingListModal .alert-error').html(userErrorMsg).removeClass('hide');$('#addDocModalButton').button('reset');trackEvent('article-lists','add-docs:error','list-modal',false);}},error:function(){var userErrorMsg='Sorry, an error occurred while trying to add this article to your reading list. Please try again.';$('#bsModifyReadingListModal .alert-error').html(userErrorMsg).removeClass('hide');$('#addDocModalButton').button('reset');trackEvent('article-lists','add-docs:error','list-modal',false);}});},createAndAddDocToList:function(permId,listName){$.ajax({type:"POST",url:"/editlists",dataType:'json',data:{'cmd':'adddocstonewlist','name':listName,'permids':permId,},beforeSend:function(){$('#openAddListDialogButton').button('loading');trackEvent('article-lists','create-and-add:attempt','list-modal',false);},complete:function(){},success:function(response){if(response.success){$('#bsAddDocToReadingListModal').modal('hide');$('#openAddListDialogButton').button('reset');$('#listMessage').html('Your article has successfully been added to your new list! Find your lists in <a href="/my-lists">My Library</a>.').show();$('.userReadingList').empty();trackEvent('article-lists','create-and-add:success','list-modal',false);readingListActions.getReadingLists();}else{var userErrorMsg='An error occurred while trying to add your reading list. Please try again.';$('#bsAddDocToReadingListModal .alert-error').html(userErrorMsg).removeClass('hide');$('#openAddListDialogButton').button('reset');trackEvent('article-lists','create-and-add:error','list-modal',false);}},error:function(){var userErrorMsg='An error occurred while trying to add your reading list. Please try again.';$('#bsAddDocToReadingListModal .alert-error').html(userErrorMsg).removeClass('hide');$('#openAddListDialogButton').button('reset');trackEvent('article-lists','create-and-add:error','list-modal',false);}});},getReadingLists:function(){function readingListItem(activeListId){return function readingListItem(key,value){var encodedValue=encode(value);var liHTML=$("<li>").addClass(key==activeListId?'active':null);var contents=$("<div class='dropdown listItemDropdown'>"+"<a href='#"+key+"' data-toggle='collapse' data-target='."+key+"'><i class='icon-cog icon-fixed-width'></i></a>"+"</div>"+"<a class='' title='"+value+"' href='/my-lists?listId="+key+"&listName="+encodedValue+"' data-listid='"+key+"'>"+"<i class='icon-tag icon-large icon-fixed-width'></i>"+
value+"</a>"+"<ul class='nav expanded-list-item margin0 collapse "+key+"'>"+"<li><a href='/cite-list?listId="+key+"&listName="+value+"'>Cite</a></li>"+"<li><a href='#"+key+"' class='renameList' data-name='"+encodedValue+"'>Rename</a></li>"+"<li><a href='#"+key+"' class='removeList' data-name='"+encodedValue+"'>Delete</a></li>"+"</ul>");return liHTML.html(contents);};}
function appendEach(target,callback){return function(key,val){return target.append(callback(key,val));};}
var listId=getUrlVars().listId;$.ajax({type:"POST",url:"/listsinfo",dataType:'json',data:{'cmd':'getlists',},beforeSend:function(){},complete:function(){},success:function(response){if(!response.success){return;}
var obj=response.lists;var target=$('.userReadingList');target.html('');$.each(obj,appendEach(target,readingListItem(listId)));$('.removeList').click(function(e){e.preventDefault();$('#removeReadingListModalButton').attr('href',$(e.target).attr('href'));$('#removeListName').empty();$('#removeListName').html(": "+decode($(e.target).attr('data-name')));$('#bsRemoveListConfirmationModal').modal('show');});$('.renameList').click(function(e){e.preventDefault();$('#modifyReadingListModalButton').attr('data-listid',$(e.target).attr('href'));$('#renameReadingListName').val(decode($(e.target).attr('data-name')));$('#bsModifyReadingListModal').modal('show');});if(obj.length<1){$('.lists-blankStateInstructions').slideDown();}},error:function(){}});},removeList:function(id){var listId=id.replace("#","");$.ajax({type:"POST",url:"/editlists",dataType:'json',data:{'cmd':'removelist','id':listId,},beforeSend:function(){$('#removeReadingListModalButton').button('loading');trackEvent('article-lists','delete-list:attempt','list-modal',false);},complete:function(){},success:function(response){if(response.success){trackEvent('article-lists','delete-list:success','list-modal',false);var selectedList=$('.userReadingList .selected .readingListLink');if(selectedList.length>0&&selectedList.attr('data-listid')==listId){var readingLists=$('.userReadingList .readingListLink');var reload=false;if(readingLists.length>1){readingLists.each(function(index){if(reload){window.location.href=$(this).attr('href');reload=false;}else{if($(this).parent().hasClass('selected')&&index===(readingLists.length-1)){window.location.href=readingLists.attr('href');}else if($(this).parent().hasClass('selected')){reload=true;}}});}else{window.location.href="/bookmarks";}}else{$('.userReadingList').empty();readingListActions.getReadingLists();}
$('#removeReadingListModalButton').button('reset');$('#bsRemoveListConfirmationModal').modal('hide');$('#listMessage').html('Your list has successfully been removed!').show();}else{var userErrorMsg='An error occurred while trying to remove your reading list. Please try again.';$('#bsRemoveListConfirmationModal .alert-error').html(userErrorMsg).removeClass('hide');$('#removeReadingListModalButton').button('reset');trackEvent('article-lists','delete-list:error','list-modal',false);}},error:function(){var userErrorMsg='An error occurred while trying to remove your reading list. Please try again.';$('#bsRemoveListConfirmationModal .alert-error').html(userErrorMsg).removeClass('hide');$('#removeReadingListModalButton').button('reset');trackEvent('article-lists','delete-list:error','list-modal',false);}});},renameList:function(name,id){var listId=id.replace("#","");var listName=name;$.ajax({type:"POST",url:"/editlists",dataType:'json',data:{'cmd':'renamelist','id':listId,'name':listName,},beforeSend:function(){$('#modifyReadingListModalButton').button('loading');trackEvent('article-lists','rename-list:attempt','list-modal',false);},complete:function(){},success:function(response){if(response.success){$('.userReadingList').empty();readingListActions.getReadingLists();$('#bsModifyReadingListModal').modal('hide');$('#modifyReadingListModalButton').button('reset');$('#listMessage').html('Your list has successfully been renamed!').show();trackEvent('article-lists','rename-list:success','list-modal',false);}else{var userErrorMsg='An error occurred while trying to rename your reading list. Please try again.';$('#bsModifyReadingListModal .alert-error').html(userErrorMsg).removeClass('hide');$('#modifyReadingListModalButton').button('reset');trackEvent('article-lists','rename-list:error','list-modal',false);}},error:function(){var userErrorMsg='An error occurred while trying to rename your reading list. Please try again.';$('#bsModifyReadingListModal .alert-error').html(userErrorMsg).removeClass('hide');$('#modifyReadingListModalButton').button('reset');trackEvent('article-lists','rename-list:error','list-modal',false);}});},removeDocFromList:function(id,e,permId){var docId=id.replace("#","");var listId=$(e.target).val();var urlListId=location.search.replace(/^.*listId=(\d+).*$/,'$1');$.ajax({type:"POST",url:"/editlists",dataType:'json',data:{'cmd':'removedocsfromlist','docid':docId,},beforeSend:function(){trackEvent('article-lists','remove-from-list:attempt','list-modal',false);},complete:function(){},success:function(response){if(response.success){$(e.target).prop('checked',false);$(e.target).closest('.doc').addClass('animated bounceOutRight');var timeout=window.setTimeout(function(){$(e.target).closest('.doc').slideUp();},600);readingListActions.setupModReadingListModal(permId);if(listId===urlListId){$('#bsAddDocToReadingListModal').on('hide',function(){window.location.reload();});}
$('#bsAddDocToReadingListModal .systemMsg').html('The article has successfully been removed from your list!').show();trackEvent('article-lists','remove-from-list:success','list-modal',false);}else{var userErrorMsg='An error occurred while trying to remove this doc your reading list. Please try again.';$('#bsModifyReadingListModal .alert-error').html(userErrorMsg).removeClass('hide');trackEvent('article-lists','remove-from-list:error','list-modal',false);}},error:function(){var userErrorMsg='An error occurred while trying to remove this doc from your reading list. Please try again.';$('#bsModifyReadingListModal .alert-error').html(userErrorMsg).removeClass('hide');trackEvent('article-lists','remove-from-list:error','list-modal',false);}});},removeExtDocFromList:function(id,e,permId){var docId=id.replace("#","");var listId=$(e.target).val();var urlListId=location.search.replace(/^.*listId=(\d+).*$/,'$1');$.ajax({type:"POST",url:"/editlists",dataType:'json',data:{'cmd':'removeextdocsfromlist','docid':docId,},beforeSend:function(){trackEvent('article-lists','remove-ext-from-list:attempt','list-modal',false);},complete:function(){},success:function(response){if(response.success){$(e.target).prop('checked',false);$(e.target).closest('.doc').addClass('animated bounceOutRight');var timeout=window.setTimeout(function(){$(e.target).closest('.doc').slideUp();},600);readingListActions.setupModReadingListModal(permId);if(listId===urlListId){$('#bsAddDocToReadingListModal').on('hide',function(){window.location.reload();});}
$('#bsAddDocToReadingListModal .systemMsg').html('The article has successfully been removed from your list!').show();trackEvent('article-lists','remove-ext-from-list:success','list-modal',false);}else{var userErrorMsg='An error occurred while trying to remove this doc your reading list. Please try again.';$('#bsModifyReadingListModal .alert-error').html(userErrorMsg).removeClass('hide');trackEvent('article-lists','remove-ext-from-list:error','list-modal',false);}},error:function(){var userErrorMsg='An error occurred while trying to remove this doc from your reading list. Please try again.';$('#bsModifyReadingListModal .alert-error').html(userErrorMsg).removeClass('hide');trackEvent('article-lists','remove-ext-from-list:error','list-modal',false);}});}};var specialOffer={init:function(e){if($('#specialOfferLogin').length>0){specialOffer.loginForm('#specialOfferLogin');$('#loginDialog').on('show',function(){if($('#specialOfferLoginEmailField').val().length>0){$('#specialOfferLoginPassword').focus();}});}},loginForm:function(formId){var form=$(formId);var button=form.find('.btn-primary');form.submit(function(e){e.preventDefault();var ajaxUrl='/login-ajax';$.ajax({url:ajaxUrl,data:form.serialize(),type:"POST",dataType:"json",beforeSend:function(){button.button('loading');}}).success(function(response){if(response.msg=='login_success'){window.location.href='https://'+window.location.hostname+'/signup-form?subscriptionType=professional_c_360';}else if(response.msg=='success'){window.location.href='https://'+window.location.hostname+'/signup-form?subscriptionType=professional_c_360';}else if(response.msg=='unverified_email'){button.button('reset');form.find('errorMsg').text('This account has already been registered but not validated yet. To validate your account and complete your registration, please check your inbox for a DeepDyve confirmation and click the validation link, then set up your password when prompted.').removeClass('hide');}else if(response.msg=='already_registered'){button.button('reset');form.find('.errorMsg').text('Sorry, this email address is already registered. If you\'re an existing user, you may log in here:').removeClass('hide');}else if(response.msg=='login_fail'){button.button('reset');form.find('.errorMsg').text('Whoops, login failed. Please try again.').removeClass('hide');}else if(response.msg=='blank_email'){button.button('reset');form.find('.errorMsg').text('Don\'t forget to enter your email address').removeClass('hide');}else if(response.msg=='blank_password'){button.button('reset');form.find('.errorMsg').text('Don\'t forget to enter your password').removeClass('hide');}else if(response.msg=='error'){button.button('reset');form.find('.errorMsg').text('Connection failed. Please try again later.').removeClass('hide');}else if(response.msg=='null_params'){button.button('reset');form.find('.errorMsg').text('System error. Please try again later.').removeClass('hide');}else if(response.msg=='need_to_use_fb_login'){button.button('reset');form.find('.errorMsg').text('You need to log in using Facebook below').removeClass('hide');}else if(response.msg=='need_to_use_google_login'){button.button('reset');form.find('.errorMsg').text('You need to log in using Google below').removeClass('hide');}else{form.next('p.loading').remove();button.button('reset');form.removeClass('hide');}});});}};var printActions={usePrintSlot:function(e){var printPages=purchase.print.getSelectedPages('unpaid');var priceMetadata=$('#priceMetadata').metadata();var userMetadata=$('#user_meta_data').metadata();$.ajax({type:"POST",url:"/use-print-slot",dataType:'json',async:false,data:{'permId':priceMetadata.permId,'purchaseSessionId':priceMetadata.rentalSessionId,'printPages':printPages,},beforeSend:function(){},complete:function(){trackEvent("use-print-slot","subscription",priceMetadata.permId,false);},success:function(response){var userErrorMsg;if(response.msg==="success"){userErrorMsg='<h5>Ready to Print.</h5><p>Click this button and <strong>new window</strong> will be opened to print your article pages.</p>'+'<p><a href=\''+
$('#baseDocUrl').text()+'?print=true\''+'target=\'_new\' class=\'btn btn-large btn-primary\' id=\'purchasePrintPrint\'><i class=\'icon-print\'></i> Print pages <i class=\'icon-share-alt\'></i></a>';$('#bsPrintModalNew .alert-error').html(userErrorMsg).removeClass('hide alert-error').addClass('alert-success animated bounceIn');$('#bsPrintModalNew .btn').hide();$('#purchasePrintPrint').show();_cio.track("printed-pages");$('#purchasePrintDone').click(function(e){e.preventDefault();var printPagesArray=printPages.split(",");var printPagesLeft=userMetadata.printPagesLeft-printPagesArray.length;if(printPagesLeft<=0){_cio.track("used-all-prints");}
window.location.reload();}).show();}else if(response.msg==='no-prints-left'){userErrorMsg=response.errormsg;$('#bsPrintModalNew .alert-error').html(userErrorMsg).removeClass('hide');}else{userErrorMsg='An error occurred while trying to print pages. Please try again.';$('#bsPrintModalNew .alert-error').html(userErrorMsg).removeClass('hide');}
$('#purchasePrintConfirm').button('reset');},error:function(){var userErrorMsg='An error occurred while trying to print pages. Please try again.';$('#bsPrintModalNew .alert-error').html(userErrorMsg).removeClass('hide');$('#purchasePrintConfirm').button('reset');}});}};function encode(toEncode){return encodeURIComponent(toEncode).replace(/!/g,'%21').replace(/'/g,'%27').replace(/\(/g,'%28').replace(/\)/g,'%29').replace(/\*/g,'%2A');}
function decode(toEncode){return decodeURIComponent(toEncode).replace(/%21/g,'!').replace(/%27/g,'\'').replace(/%28/g,'\(').replace(/%29/g,'\)').replace(/%2A/g,'\*');}
var contactForm={init:function(e){if($('.contactForm').length>0){$('.contactForm form').submit(function(){$('.contactForm .submit').button('loading');});}
if($('.contactForm-footer').length>0){$('.contactForm-footer-form').submit(function(e){e.preventDefault();$('.contactForm-footer .submit').button('loading');$.ajax({url:"/contact-ajax",data:$('.contactForm-footer form').serialize(),type:"POST",complete:function(r){$('.contactForm-footer-form').hide();$('.contactForm-footer-msg').addClass('animated bounceIn').show();}});});$('.contactForm-footer-placeholder').click(function(){$('.contactForm-footer-placeholder').hide();$('.contactForm-footer-form').show();$('.contactForm-footer-msg').focus();});}}};var relatedJournals={init:function(e){if($('.js-relatedJournals').length<1||$('.js-landing--LP').length>0){return;}
var journalId=$('.js-journalMetadata').metadata().journalId;var maxListLength=5;$.ajax({url:"/get-related-subject-areas-journals",data:'cmd=journal&journalId='+journalId,dataType:"json",type:"GET",success:function(response){if(response.results&&response.results.length>0){var resultsList='<span class="dd-relatedJournals-list js-relatedJournals-list">';$.each(response.results,function(i,journal){if(i>=maxListLength){return false;}
resultsList+='<span class="journalName"><a href="/browse/journals/'+journal.journalUrl+'">'+journal.journalTitle+'</a></span>';if(i<response.results.length-1&&i<maxListLength-1){resultsList+=', ';}});resultsList+='</span>';$('.js-relatedJournals-list').replaceWith(resultsList);$('.js-relatedJournals').show();}}});}};var relatedJournalsLP={init:function(e){if($('.js-landing--LP, js-relatedJournals').length<1){return;}
var journalId=$('.js-journalMetadata').metadata().journalId;var maxListLength=5;$.ajax({url:"/get-related-subject-areas-journals",data:'cmd=journal&journalId='+journalId,dataType:"json",type:"GET",success:function(response){if(response.results&&response.results.length>0){var resultsList='<div style="border-left: 1px solid #E5E5E5;"><ul class="nav nav-pills nav-stacked dd-relatedJournals-list js-relatedJournals-list">';$.each(response.results,function(i,journal){if(i>=maxListLength){return false;}
resultsList+='<li style="border-top-left-radius:0px;border-bottom-right-radius:0px;" class="journalName"><a href="/browse/journals/'+journal.journalUrl+'">'+journal.journalTitle+'</a></li>';});resultsList+='</ul></div>';$('.js-relatedJournals-list').replaceWith(resultsList);$('.js-relatedJournals').toggle();}}});}};$(document).ready(function(){requestReceipt.init();hibernatePlan.init();
shortRental.init();groupPlanPage.init();inviteFriends.init();sharing.init();bulkActions.init();readingListActions.init();searchAlertActions.init();journalSearchResults.init();formHelpers.init();specialOffer.init();contactForm.init();undoCancel.init();increasePrints.init();cite.init();relatedJournals.init();relatedJournalsLP.init();stdtopro.init();wosLink.init();signupFlowFreelancerButton.init();anonPlanMatrixFreelancerButton.init();anonPlanMatrixProfessionalButton.init();linkoutSerp.init();abstractPreviewPane.init();});;var Search=(function(){"use strict";var allQueryFields='#queryField, #advancedQuery, #footerQueryField';function Search(params){if(params===undefined){console.error('Search needs defined params.');return;};this.query=params.query===undefined?"":typeof params.query==='string'?params.query:String(params.query);this.requiredwords=params.requiredwords===undefined?"":typeof params.requiredwords==='string'?params.requiredwords:String(params.requiredwords);this.excludedwords=params.excludedwords===undefined?"":typeof params.excludedwords==='string'?params.excludedwords:String(params.excludedwords);this.optionalwords=params.optionalwords===undefined?"":typeof params.optionalwords==='string'?params.optionalwords:String(params.optionalwords);this.exactphrase=params.exactphrase===undefined?"":typeof params.exactphrase==='string'?params.exactphrase:String(params.exactphrase);this.titlewords=params.titlewords===undefined?"":typeof params.titlewords==='string'?params.titlewords:String(params.titlewords);this.author=params.author===undefined?"":typeof params.author==='string'?params.author:String(params.author);this.journal_journal_name_split=params.journal_journal_name_split===undefined?"":typeof params.journal_journal_name_split==='string'?params.journal_journal_name_split:String(params.journal_journal_name_split);this.dateFrom=params.dateFrom;this.dateTo=params.dateFrom;}
function broadcast_update(val,targets){$(targets).trigger('ddSearch.'+val);};function formatTerm(words,prepend){words=words.trim();var buffer=[];var terms=[];for(var i=0,len=words.length;i<len;i++){if(words.charAt(i)==="\""){for(var j=i+1;j<len;j++){if(words.charAt(j)==="\""){break;}
buffer.push(words[j]);}
i=j;terms.push("\""+buffer.join("").trim()+"\"");buffer=[];}else{for(var k=i;k<len;k++){if(words.charAt(k).match(/\s/))break;buffer.push(words[k]);}
i=k;terms.push(buffer.join("").trim());buffer=[];}}
terms.push(buffer.join("").trim());buffer=[];return terms.filter(function(t){return t!=="";}).map(function(t){return prepend+t;}).join(" ");}
Search.prototype.get_query=function(){return this.combine_boolean_terms();};Search.prototype.get_requiredwords=function(){return this.requiredwords.length===0?"":formatTerm(this.requiredwords,"");}
Search.prototype.get_excludedwords=function(){return this.requiredwords.length===0?"":formatTerm(this.excludedwords,"-");}
Search.prototype.get_optionalwords=function(){return this.optionalwords.length===0?"":"+("+formatTerm(this.optionalwords,"OR ").slice(3)+")";}
Search.prototype.get_exactphrase=function(){var phr=this.exactphrase.trim();return phr.length===0?"":"\""+phr+"\"";}
Search.prototype.clear_all=function(){this.query="";this.requiredwords="";this.excludedwords="";this.optionalwords="";this.exactphrase="";}
Search.prototype.combine_boolean_terms=function(){var required=this.get_requiredwords();var optional=this.get_optionalwords();var excluded=this.get_excludedwords();var exact=this.get_exactphrase();if(required!==""||optional!==""||excluded!==""){return[this.get_requiredwords(),this.get_optionalwords(),this.get_exactphrase(),this.get_excludedwords()].filter(function(v){return v!==""&&v!==undefined&&v!=="\"\""}).join(" ");}else{return[formatTerm(this.requiredwords,""),exact,].filter(function(v){return v!==""&&v!==undefined&&v!=="\"\""}).join(" ");}};Search.prototype.parseFromString=function(str){return parseQuery(str);}
Search.prototype.update_query=function(str){this.query=str;this.update_search_model('requiredwords',str);};Search.prototype.update_query_with_event=function(jqEvent){this.update_query($(jqEvent.target).val());};Search.prototype.update_search_model=function(key,val){if(this.hasOwnProperty(key)){this[key]=val;}else{console.error("Search parameter not defined in model.");}}
Search.prototype.update_search_model_with_event=function(jqEvent){var key=$(jqEvent.target).attr('id');var val=$(jqEvent.target).val();this.update_search_model(key,val);broadcast_update("update_query",allQueryFields);}
return Search;}());var SearchModel=new Search({query:$('#queryField').val(),});var advancedSearch={queryFields:'#advancedQuery, #queryField',setupAdvancedFilters:function(){var $mainSearch=$('#mainSearch');var $advancedSearch=$('#advancedSearch');$(".js-queryPreviewToggle").on('click',function(){if($('#queryPreviewSection .collapse.in').length){$('#queryPreviewSection .collapse.in').removeClass('in');}else{$('#queryPreviewSection .collapse').addClass('in');}})
$(".js-helpTextToggle").on('click',function(){if($('#advancedSearchForm .exampleText.hide').length){$('#advancedSearchForm .exampleText.hide').removeClass('hide');}else{$('#advancedSearchForm .exampleText').addClass('hide');}})
$mainSearch.find('.btn').button();$mainSearch.find('.btn').button('reset');$('.mobileSearchButton').click(function(e){$mainSearch.addClass('expandFocus').focus();});$('.advancedFilters').on('click',function(e){e.preventDefault();$('#advancedSearch').modal('show');});$mainSearch.on('mouseenter focusin',function(e){$(this).addClass('expandFocus');$(this).find('.advancedSearchLink').slideDown(150).css({display:'flex'}).removeClass('hide');}).on('mouseleave focusout',function(e){if($(this).has(":focus").length>0)return;$(this).find('.advancedSearchLink').slideUp(0).css({display:'none'}).addClass('hide');$(this).removeClass('expandFocus');})
$mainSearch.on('ddSearch.update_query',function(e){if($(e.target)===$(this).find(advancedSearch.queryFields))return;$(this).find(advancedSearch.queryFields).val(SearchModel.get_query.apply(SearchModel));}).on('change',advancedSearch.queryFields,SearchModel.update_query_with_event.bind(SearchModel));$advancedSearch.find('.btn').button();$advancedSearch.find('.btn').button('reset');$advancedSearch.modal({show:false}).on('shown',function(e){trackEvent('advanced-search','click','open',false);$advancedSearch.css({display:'flex'});SearchModel.update_query.apply(SearchModel,[$mainSearch.find("#queryField").val()]);$advancedSearch.trigger('ddSearch.update_query');$(this).find('#requiredwords').val(SearchModel.get_query.apply(SearchModel));$(this).find('#excludedwords').val("");SearchModel.update_search_model.apply(SearchModel,['excludedwords',""]);$(this).find('#optionalwords').val("");SearchModel.update_search_model.apply(SearchModel,['optionalwords',""]);$(this).find('#exactphrase').val("");SearchModel.update_search_model.apply(SearchModel,['exactphrase',""]);$('#requiredwords').focus();}).on('hidden',function(e){$advancedSearch.css({display:'none'});$advancedSearch.trigger('ddSearch.update_query');SearchModel.update_search_model.apply(SearchModel,['excludedwords',""]);SearchModel.update_search_model.apply(SearchModel,['optionalwords',""]);SearchModel.update_search_model.apply(SearchModel,['exactphrase',""]);$('#mainSearch').focus();});$advancedSearch.on('ddSearch.update_query',function(e){if($(e.target)===$(this).find(advancedSearch.queryFields))return;$(this).find(advancedSearch.queryFields).val(SearchModel.get_query.apply(SearchModel));$(this).find('.queryPreview').text(SearchModel.get_query.apply(SearchModel));}).on('change','input',SearchModel.update_search_model_with_event.bind(SearchModel)).on('change','#dateMode',function(){if($(this).val()=='custom'){$('#advancedDateCustom').removeClass('hide');}else{$('#advancedDateCustom').addClass('hide');}
$('#dateFrom').val('');$('#dateTo').val('');}).on('click','#advancedFiltersActions .clear',function(e){e.preventDefault();advancedSearch.resetFilters();});},resetFilters:function(){$('#advancedContent .field').val('');if($('#advancedSearch').hasClass('custom')){$('#dataSourcesList input').removeAttr('checked');}else{$('#dataSourcesList input').attr('checked','checked');}
$('#dateMode').val('none');$('#hiddenDateFrom').val('');$('#hiddenDateTo').val('');$('#advancedDateCustom').addClass('hide');SearchModel.clear_all.apply(SearchModel);$('#queryField').val('');$('#advancedSearch').trigger('ddSearch.update_query');},minFields:["advancedQuery","required","titlewords","author","mlt","journal_journal_name"],checkMinFields:function(){var i;var len;for(i=0,len=this.minFields.length;i<len;i++){if($.trim($("#"+this.minFields[i]).val())!==""){return true;}}
return false;},};var setupSearch={sidebarFilters:function(){$('.collapseSidebar').on('click',function(){$('.search-sidebar').toggleClass('hidden-phone');if($('.collapseSidebar').text()==="Show Filters"){$('.collapseSidebar').text("Hide Filters");}else{$('.collapseSidebar').text("Show Filters");}});$('.js-myJournalsFilterTooltip').tooltip({placement:'right',trigger:'click hover focus',delay:{show:350,hide:100},container:'body',title:'Search only in the journals you follow using My Journals in My Library!',});},searchSuggest:function(field){$.getJSON('/get-all-journals',{'url':'on'},function(data){if(typeof data.response==='undefined'){return;}
var SHArray=[];var i=1;var SHItem=$.cookie('SH'+i);while(SHItem!==null){if(i>15){$.cookie('SH'+i,null);}else{SHArray.push(SHItem);}
i++;SHItem=$.cookie('SH'+i);}
$(field).ddautocomplete(removeDuplicate(SHArray),data.response.docs,{matchContains:"word",max:150,cacheLength:5000,selectFirst:false,scroll:false,formatResult:function(str){return str;},formatItem2:function(item){return item.journal_display_name+' - '+setupSearch.getRentalState(item.internal_rental_state);},formatMatch2:function(item){return item.journal_display_name+' - '+setupSearch.getRentalState(item.internal_rental_state);},formatResult2:function(item){return item.journal_display_name+' - '+setupSearch.getRentalState(item.internal_rental_state);}});});},getRentalState:function(r){if(r==='rentable'){return'<div class="dd_ac_available">Available</div>';}
if(r==='free'){return'<div class="dd_ac_available">Free</div>';}
if(r==='restricted'){return'<div class="dd_ac_notAvailable">Preview Only</div>';}
if(r==='rentable_free'){return'<div class="dd_ac_available">Available</div>';}
return'<div class="dd_ac_notAvailable">Mixed Availability</div>';},executeSpellChecker:function(){$('#spellingSuggest a').click(function(e){e.preventDefault();SearchModel.update_query.apply(SearchModel,[$(this).text()]);$('#advancedSearchForm').submit();});},searchForm:function(form){var field=form.find('input[type="search"]');setupSearch.searchSuggest(field);field.keydown(function(e){if(e.keyCode==13){form.submit();return false;}});form.submit(function(e){e.preventDefault();SearchModel.update_query.apply(SearchModel,[field.val()]);setupSearch.submitSearch(form,field);});},submitSearch:function(form,field){if(form===$('#advancedSearchForm')){SearchModel.update_search_model.apply(SearchModel,['requiredwords',$('#requiredwords').val()]);SearchModel.update_search_model.apply(SearchModel,['excludedwords',$('#excludedwords').val()]);SearchModel.update_search_model.apply(SearchModel,['optionalwords',$('#optionalwords').val()]);SearchModel.update_search_model.apply(SearchModel,['exactphrase',$('#exactphrase').val()]);$('#advancedSearch').trigger('ddSearch.update_query');}
if(advancedSearch.checkMinFields()||(!field.hasClass('defaultText')&&field.val()!=='')){form.find('button').addClass('active').button('loading');$('#mainSearch #searchSubmit').button('loading');trackEvent('advanced-search','click','search',false);$('#advancedSearchForm').submit();}else{$('#queryField, #queryField.homepage').focus();}},footerSearch:function(form){var field=form.find('input');form.submit(function(e){e.preventDefault();$('#queryField').removeClass('defaultText').val(field.val());setupSearch.submitSearch(form,field);});},advancedSearchForm:function(form){form.submit(function(e){var field=$('#advancedQuery');field.val(SearchModel.get_query.apply(SearchModel));if(advancedSearch.checkMinFields()){var SHCount;if($.cookie('SHCount')===null){SHCount=1;}else{SHCount=(Number($.cookie('SHCount'))%15)+1;}
$.cookie('SHCount',SHCount,{path:'/'});if(field.val().length<250){$.cookie('SH'+SHCount,field.val(),{path:'/'});}
if(form.serialize().length>2500){form.attr('method','post');}else{form.attr('method','get');}}else{e.preventDefault();$('#mainSearch').focus();}});}};;function debounce(e,t,r){function n(t){var r=u,n=c;return u=c=void 0,m=t,b=e.apply(n,r)}function o(e){var r=e-v;return void 0===v||r>=t||r<0||y&&e-m>=l}function i(){var e=now();if(o(e))return a(e);s=setTimeout(i,function(e){var r=t-(e-v);return y?nativeMin(r,l-(e-m)):r}(e))}function a(e){return s=void 0,p&&u?n(e):(u=c=void 0,b)}function f(){var e=now(),r=o(e);if(u=arguments,c=this,v=e,r){if(void 0===s)return function(e){return m=e,s=setTimeout(i,t),j?n(e):b}(v);if(y)return s=setTimeout(i,t),n(v)}return void 0===s&&(s=setTimeout(i,t)),b}var u,c,l,b,s,v,m=0,j=!1,y=!1,p=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);return t=toNumber(t)||0,isObject(r)&&(j=!!r.leading,l=(y="maxWait"in r)?nativeMax(toNumber(r.maxWait)||0,t):l,p="trailing"in r?!!r.trailing:p),f.cancel=function(){void 0!==s&&clearTimeout(s),m=0,u=v=c=s=void 0},f.flush=function(){return void 0===s?b:a(now())},f}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function isObjectLike(e){return!!e&&"object"==typeof e}function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&objectToString.call(e)==symbolTag}function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return NAN;if(isObject(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(reTrim,"");var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}var FUNC_ERROR_TEXT="Expected a function",NAN=NaN,symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};function throttle(n,e,i){var t=!0,r=!0;if("function"!=typeof n)throw new TypeError(FUNC_ERROR_TEXT);return isObject(i)&&(t="leading"in i?!!i.leading:t,r="trailing"in i?!!i.trailing:r),debounce(n,e,{leading:t,maxWait:e,trailing:r})}function isObject(n){var e=typeof n;return!!n&&("object"==e||"function"==e)}var debounce=debounce,FUNC_ERROR_TEXT="Expected a function";function paymentSignup(){$.ajax({url:"/update-user-info",async:false,data:$('#activationForm').serialize(),type:"POST",complete:function(r){}});$('#paypalSubscription').submit();}
var homepage={init:function(){if($('body').hasClass('homepage')||$('body').hasClass('entryPage')){$('.nav .js-scrollToLink').click(function(e){e.preventDefault();var target=$(this.hash);target=target.length?target:$('[name='+this.hash.slice(1)+']');if(target.length){$('html,body').animate({scrollTop:target.offset().top-100},250);return false;}});}}};var ddxRegistrationFlow={_validClass:'ddx--form-control--success',_errorClass:'ddx--form-control--error',init:function(){var $userProfile=$('#ddx--signup-form-userprofile');var $researchArea=$('#ddx--signup-form-researcharea');var $plugin=$('#ddx--signup-form-plugin');var $selectPlan=$('#ddx--signup-form-plan');var $selectPricingPlan=$('#ddx--signup-form-pricing-plan');var $ccForm=$('#signup');var $promo=$('#ddx--signup-form-promo');if($userProfile.length){this.userProfile(1);}
if($researchArea.length){this.updateJournalCounts();this.researchArea(2);}
if($plugin.length){this.plugin(3);}
if($selectPlan.length){this.selectPlan(4,false);}
if($selectPricingPlan.length){this.selectPricingPlan(5,false);}
if($ccForm.length){this.ccForm(5,true);}
if($promo.length){this.promo(4,true);}},stepper:function(stepNumber,last){window.scrollTo(0,0);if(!last){$('.ddx--stepper__step'+stepNumber).toggleClass('ddx--hide');}},updateJournalCounts:function(){$.get('/get-subj-area-num-journals').then(function(data){try{var json=JSON.parse(JSON.parse(data));}catch(err){$('.ddx--subject-area__journal-count').toggleClass('ddx--hide');return false;}
if('success'in json){if(!json.success){$('.ddx--subject-area__journal-count').toggleClass('ddx--hide');return false;}}
if('data'in json){$.each(json.data,function(k,v){var countText=String(v)+' journal'+(v>1?'s':'');$('#'+k+' + label .ddx--subject-area__journal-count').text(countText);})}});return false;},userProfile:function(stepNumber){var $userProfile=$('#ddx--signup-form-userprofile');var isValid=function(selector,validator){return $(selector).val()!==''&&validator.element(selector);};var userProfileValidator=$userProfile.validate({validClass:this._validClass,errorClass:this._errorClass,errorElement:'label',rules:{firstname:{minlength:2,required:true,},lastname:{minlength:2,required:true,},occupation:{required:true,},},messages:{firstname:{required:'This field is required.',},lastname:{required:'This field is required.',},occupation:{required:'This field is required.',},},success:function(label){},submitHandler:function(form,event){event.preventDefault();$.ajax({url:'/update-user-info',async:true,type:'POST',data:{email:$('#user_meta_data').metadata().email,firstName:$userProfile.find('#firstname').val(),lastName:$userProfile.find('#lastname').val(),occupation:$userProfile.find('#occupation').val(),organizationSize:$userProfile.find('#orgsize').val(),jobTitle:$userProfile.find('#jobtitle').val(),},beforeSend:function(jqXHR){var $submitBtn=$userProfile.find('button[type="submit"]');$submitBtn.attr('disabled',true).html($submitBtn.data('loading-text'));},complete:undefined,success:function(){$('.ddx--stepper__step'+String(stepNumber)).toggleClass('ddx--hide');ddxRegistrationFlow.stepper(Number(stepNumber)+1);trackEvent('ddx--signup-steps','next','userProfile',false);},error:undefined,});}});$(function(e){var isEmpty=function(selector){return $(selector).val()==""||$(selector).val()==undefined||$(selector+' :selected').val()=='Organization Size (Optional)'
$(selector+' :selected').val()=='Occupation';};var allValid=(!isEmpty('#firstname')&&isValid('#firstname',userProfileValidator))&&(!isEmpty('#lastname')&&isValid('#lastname',userProfileValidator))&&(!isEmpty('#occupation')&&isValid('#occupation',userProfileValidator));!isEmpty('#orgsize')&&isValid('#orgsize',userProfileValidator);!isEmpty('#jobtitle')&&isValid('#jobtitle',userProfileValidator);$userProfile.find('button[type="submit"]').prop('disabled',!allValid);});$userProfile.on('blur change paste submit',function(e){if(e.type=='submit')return 0;var isEmpty=function(selector){return $(selector).val()==""||$(selector).val()==undefined||$(selector+' :selected').val()=='Organization Size (Optional)'
$(selector+' :selected').val()=='Occupation';};setTimeout(function(){var allValid=(!isEmpty('#firstname')&&isValid('#firstname',userProfileValidator))&&(!isEmpty('#lastname')&&isValid('#lastname',userProfileValidator))&&(!isEmpty('#occupation')&&isValid('#occupation',userProfileValidator));$userProfile.find('button[type="submit"]').prop('disabled',!allValid);},50);});},researchArea:function(stepNumber){var $researchAreaForm=$('#ddx--signup-form-researcharea');var $submitBtn=$researchAreaForm.find('button[type="submit"]');var $subjectArea=$('#ddx-subject-area');var $active=[];var chosen=[];$subjectArea.on('change',function(){$('html,body').animate({scrollTop:$('#ddx-subject-area').offset().top-10,},200,'swing');if($active.length){$active.addClass('ddx--hide').off('.chooseItems').find(':checked').prop('checked',false);chosen=[];}
$active=$('#'+$(this).val()+"-container");$active.removeClass('ddx--hide');$active.on('change.chooseItems',function(e){if($(e.target).is(':checked')){if(chosen.length>=4){$('#'+chosen.pop()).prop('checked',false);}
chosen.push(e.target.id);}else{chosen=chosen.filter(function(item){return item!==e.target.id;});}
$submitBtn.prop('disabled',chosen.length===0);});});$researchAreaForm.on('submit',function(event){event.preventDefault();$.ajax({url:'/edit-user-subject-areas?cmd=addsubjectareas',async:true,type:'POST',data:{subjectAreas:chosen,},beforeSend:function(jqXHR){$submitBtn.prop('disabled',true).html($submitBtn.data('loading-text'));},complete:undefined,success:function(){$('.ddx--stepper__step'+String(stepNumber)).toggleClass('ddx--hide');ddxRegistrationFlow.stepper(Number(stepNumber)+1);trackEvent('ddx--signup-steps','next','selectResearchArea',false);},error:undefined,});});},plugin:function(stepNumber){var $pluginForm=$('#ddx--signup-form-plugin');var $submitBtn=$pluginForm.find('button[type="submit"]');var $installBtn=$pluginForm.find('.js-required-step-pluginButton');if($.cookie('AB_signup_flow_2017_09_19')!=='promo'){$submitBtn.prop('disabled',false);}else{$installBtn.one('click',function(e){$submitBtn.prop('disabled',false);});}
$pluginForm.on('submit',function(event){event.preventDefault();$submitBtn.prop('disabled',true).html($submitBtn.data('loading-text'));$('.ddx--stepper__step'+String(stepNumber)).toggleClass('ddx--hide');ddxRegistrationFlow.stepper(Number(stepNumber)+1);trackEvent('ddx--signup-steps','next','installPlugin',false);});},selectPlan:function(stepNumber){var $pluginForm=$('#ddx--signup-form-plan');var $submitBtn=$pluginForm.find('button[type="submit"]');$submitBtn.prop('disabled',false);$pluginForm.on('submit',function(event){event.preventDefault();$submitBtn.prop('disabled',true).html($submitBtn.data('loading-text'));$('.ddx--stepper__step'+String(stepNumber)).toggleClass('ddx--hide');ddxRegistrationFlow.stepper(Number(stepNumber)+1);trackEvent('ddx--signup-steps','next','selectPlan',false);});},selectPricingPlan:function(stepNumber){var $planForm=$('#ddx--signup-form-pricing-plan');var $submitBtn=$planForm.find('button[type="submit"]');var $ccForm=$('#signup');function capitalize(str){return String(str).charAt(0).toUpperCase()+String(str).slice(1);}
$planForm.on('change',function(event){var $checked=$('[name="selectplan"]:checked');$ccForm.find('#annual').prop('checked',$checked.val()==='annual');var $notChecked=$planForm.find(':not(:checked) + label');$notChecked.each(function(idx,el){$(el).html($(el).data('initial-text'));});var $checkedLabel=$planForm.find(':checked + label');$checkedLabel.html($checkedLabel.data('selected-text'));$('.summaryMonthly').hide();$('.summaryAnnual').hide();$('.summary'+capitalize($checked.val())).show();$submitBtn.prop('disabled',!$checked.length);});$planForm.one('click','.ddx--control',function(event){$('html,body').animate({scrollTop:$('#signup').offset().top,},200,'swing');});$planForm.on('submit',function(event){event.preventDefault();$('.ddx--stepper__step'+String(stepNumber)).toggleClass('ddx--hide');ddxRegistrationFlow.stepper(Number(stepNumber)+1);trackEvent('ddx--signup-steps','next','selectPricingPlan',false);});},ccForm:function(stepNumber,last){var $ccForm=$('#signup');var $submitBtn=$ccForm.find('button[type="submit"]');var ccFormValidator=ccUtilities.setupCCForm();var ccIsActive=function(){return $('#cc').hasClass('active');}
var isValid=function(selector,validator){return $(selector).val()!==''&&validator.element(selector);};var activateSubmitButton=function(event){if(event.type=='submit')return 0;setTimeout(function(){if(ccIsActive()){var allValid=isValid('#account',ccFormValidator)&&isValid('#cvv2pro',ccFormValidator)&&isValid('#confirmCheckbox',ccFormValidator)&&isValid('#expirationMonth',ccFormValidator)&&isValid('#expirationYear',ccFormValidator);$submitBtn.prop('disabled',!allValid);}else{var allValid=isValid('#confirmCheckbox',ccFormValidator);$submitBtn.prop('disabled',!allValid);};},200);};$ccForm.on('blur change paste submit',activateSubmitButton);$('#showPP, #showCC').on('click',activateSubmitButton);$ccForm.on('submit',function(event){$submitBtn.attr('disabled',true).html($submitBtn.data('loading-text'));trackEvent('ddx--signup-steps','next','ccPayment',false);});},promo:function(stepNumber,last){var $promoForm=$('#ddx--signup-form-promo');var $submitBtn=$promoForm.find('button[type="submit"]');$promoForm.on('submit',function(event){$submitBtn.attr('disabled',true).html($submitBtn.data('loading-text'));trackEvent('ddx--signup-steps','next','promo',false);});},};var professionalSignupForm={init:function(){$('#showCC').on('show',function(){$('#paymentType').val('cc');$('#billingInfo').val('true');$('#account').attr('disabled',false);$('#cvv2pro').attr('disabled',false);});$('#showPP').on('show',function(){$('#paymentType').val('paypal');$('#billingInfo').val('false');$('#account').attr('disabled',true);$('#cvv2pro').attr('disabled',true);});if($('#signup').length>0){ccUtilities.setupCCForm();$('#signup').on('submit',function(){$('#signupButton').button('loading');$('.signupButton').button('loading');});$('#signup .btn').button('reset');if($('.signup-form-safari').length>0){$(document).ready(function(){$('#annual').prop('checked',true);$('.selectAnnual').addClass('selected');$('.selectMonthly').removeClass('selected');if($('.std-user').length>0){$('.summaryMonthlyStd').hide();$('.summaryAnnualStd').show();$('.summaryMonthly').hide();$('.summaryAnnual').hide();}else{$('.summaryMonthlyStd').hide();$('.summaryAnnualStd').hide();$('.summaryMonthly').hide();$('.summaryAnnual').show();}
$('#monStd').show().removeClass('selected');$('#annStd').show().addClass('selected');$('#monPro').show().removeClass('selected');$('#annPro').show().removeClass('selected');$('.selectedMsg.mStd').removeClass('selected');$('.selectedMsg.aStd').addClass('selected');$('.selectedMsg.mPro').removeClass('selected');$('.selectedMsg.aPro').removeClass('selected');$('.selected-check-monthlyStd').removeClass('selected');$('.selected-check-annualStd').addClass('selected');$('.selected-check-monthlyPro').removeClass('selected');$('.selected-check-annualPro').removeClass('selected');});$('.standard-plan .panel-std #monStd').click(function(){$('#annual').prop('checked',false);$('#monStd').show().addClass('selected');$('#annStd').show().removeClass('selected');$('#monPro').show().removeClass('selected');$('#annPro').show().removeClass('selected');$('.selectedMsg.mStd').addClass('selected');$('.selectedMsg.aStd').removeClass('selected');$('.selectedMsg.mPro').removeClass('selected');$('.selectedMsg.aPro').removeClass('selected');$('.selected-check-monthlyStd').addClass('selected');$('.selected-check-annualStd').removeClass('selected');$('.selected-check-monthlyPro').removeClass('selected');$('.selected-check-annualPro').removeClass('selected');$('.summaryMonthlyStd').show();$('.summaryAnnualStd').hide();$('.summaryMonthly').hide();$('.summaryAnnual').hide();});$('.standard-plan .panel-std #annStd').click(function(){$('#annual').prop('checked',true);$('#monStd').show().removeClass('selected');$('#annStd').show().addClass('selected');$('#monPro').show().removeClass('selected');$('#annPro').show().removeClass('selected');$('.selectedMsg.mStd').removeClass('selected');$('.selectedMsg.aStd').addClass('selected');$('.selectedMsg.mPro').removeClass('selected');$('.selectedMsg.aPro').removeClass('selected');$('.selected-check-monthlyStd').removeClass('selected');$('.selected-check-annualStd').addClass('selected');$('.selected-check-monthlyPro').removeClass('selected');$('.selected-check-annualPro').removeClass('selected');$('.summaryMonthlyStd').hide();$('.summaryAnnualStd').show();$('.summaryMonthly').hide();$('.summaryAnnual').hide();});$('.pro-plan .panel-pro #monPro').click(function(){$('#annual').prop('checked',false);$('#monStd').show().removeClass('selected');$('#annStd').show().removeClass('selected');$('#monPro').show().addClass('selected');$('#annPro').show().removeClass('selected');$('.selectedMsg.mStd').removeClass('selected');$('.selectedMsg.aStd').removeClass('selected');$('.selectedMsg.mPro').addClass('selected');$('.selectedMsg.aPro').removeClass('selected');$('.selected-check-monthlyStd').removeClass('selected');$('.selected-check-annualStd').removeClass('selected');$('.selected-check-monthlyPro').addClass('selected');$('.selected-check-annualPro').removeClass('selected');$('.summaryMonthlyStd').hide();$('.summaryAnnualStd').hide();$('.summaryMonthly').show();$('.summaryAnnual').hide();});$('.pro-plan .panel-pro #annPro').click(function(){$('#annual').prop('checked',true);$('#monStd').show().removeClass('selected');$('#annStd').show().removeClass('selected');$('#monPro').show().removeClass('selected');$('#annPro').show().addClass('selected');$('.selectedMsg.mStd').removeClass('selected');$('.selectedMsg.aStd').removeClass('selected');$('.selectedMsg.mPro').removeClass('selected');$('.selectedMsg.aPro').addClass('selected');$('.selected-check-monthlyStd').removeClass('selected');$('.selected-check-annualStd').removeClass('selected');$('.selected-check-monthlyPro').removeClass('selected');$('.selected-check-annualPro').addClass('selected');$('.summaryMonthlyStd').hide();$('.summaryAnnualStd').hide();$('.summaryMonthly').hide();$('.summaryAnnual').show();});$('.selectAnnual').click(function(){$('#annual').prop('checked',true);$('.selectAnnual').addClass('selected');$('.selectMonthly').removeClass('selected');$('.selectIndividual').removeClass('selected');$('.summaryIndividual').hide();$('.summaryMonthly').hide();$('.summaryAnnual').show();$('#subscriptionType').val('professional_c_360');});$('.selectMonthly').click(function(){$('#annual').prop('checked',false);$('.selectAnnual').removeClass('selected');$('.selectMonthly').addClass('selected');$('.selectIndividual').removeClass('selected');$('.summaryIndividual').hide();$('.summaryMonthly').show();$('.summaryAnnual').hide();$('#subscriptionType').val('professional_c_360');});}
if($('.js-annualBilling-toggle').length>0){$('.js-annualBilling-toggle').click(function(){$('#annual').prop('checked',true);$('.summaryMonthly').hide();$('.summaryAnnual').show();});$('.js-monthlyBilling-toggle').click(function(){$('#annual').prop('checked',false);$('.summaryMonthly').show();$('.summaryAnnual').hide();});$('.js-annualBilling-toggle').click();$('.js-switchToMonthly-link').click(function(e){e.preventDefault();$('.js-monthlyBilling-toggle').click();});$('.js-switchToAnnual-link').click(function(e){e.preventDefault();$('.js-annualBilling-toggle').click();});}
$('#annual').click(function(e){if($('#annual').is(":checked")===true){$('.summaryMonthly').hide();$('.summaryAnnual').show();}else{$('.summaryMonthly').show();$('.summaryAnnual').hide();}});$('#monthlyStd').click(function(e){$('.summaryMonthlyStd').show();$('.summaryAnnualStd').hide();$('.summaryMonthly').hide();$('.summaryAnnual').hide();});$('#annualStd').click(function(e){$('.summaryMonthlyStd').hide();$('.summaryAnnualStd').show();$('.summaryMonthly').hide();$('.summaryAnnual').hide();});$('#monthlyPro').click(function(e){$('.summaryMonthlyStd').hide();$('.summaryAnnualStd').hide();$('.summaryMonthly').show();$('.summaryAnnual').hide();});$('#annualPro').click(function(e){$('.summaryMonthlyStd').hide();$('.summaryAnnualStd').hide();$('.summaryMonthly').hide();$('.summaryAnnual').show();});professionalSignupForm.setupSubjectAreasRecommendedJournals();}},setupSubjectAreasRecommendedJournals:function(){$(".js-subjectArea-select-lvl1").change(function(){var newSubjectArea;var level="sa1";$(".js-subjectArea-lvl2").hide();newSubjectArea=$(".js-subjectArea-select-lvl1").find(":selected").val();$(".js-subjectArea-"+newSubjectArea).show();professionalSignupForm.getSubjectAreaRecommendedJournals(newSubjectArea,level);});$(".js-subjectArea-select-lvl2").change(function(){var newSubjectArea;var level="sa2";newSubjectArea=$(".js-subjectArea-select-lvl2:visible").find(":selected").val();if(newSubjectArea==="null"){$(".js-subjectArea-select-lvl1").change();return;}
professionalSignupForm.getSubjectAreaRecommendedJournals(newSubjectArea,level);});},getSubjectAreaRecommendedJournals:function(subjectArea,level){if(!subjectArea){return;}
if(!level){return;}
var maxListLength=7;$.ajax({url:"/get-related-subject-areas-journals",data:"cmd="+level+"&saUrl="+subjectArea,dataType:"json",type:"GET",success:function(response){if(response.results&&response.results.length>0){var resultsList='';$.each(response.results,function(i,journal){if(i>=maxListLength){return false;}
resultsList+='<li class="journalName notfollowed \{journal_id: \''+
journal.journalId+'\',  journal_name: \''+
journal.journalTitle+'\'}"> <span class="followIcon"> <i class="icon-plus-sign-alt icon-fixed-width"></i> </span>'+
journal.journalTitle+'</li>';});$('#subjectAreaJournalsList').html(resultsList);relatedJournalList.activate();$('#subjectAreaJournalsList').show();}}});}};var relatedJournalList={clickHandler:function(){var journal_name=$(this).metadata().journal_name;var journal_id=$(this).metadata().journal_id;journalFollow.follow(journal_id,true,'onboarding-related-journal-list');if($('#activationForm, .js-signupConfirm-signupForm').length>0){$('.followedJournalList').append('<li class="animated bounceInUp"><i class="icon-check-sign text-success"></i> '+journal_name+'</li>');$(this).addClass('animated bounceOutUp').delay(300).slideUp(200);$('#continueBttn').removeClass('disabled').removeAttr('disabled');}},activate:function(){if($('.relatedJournalList').length>0){$('.relatedJournalList .journalName').unbind('click',relatedJournalList.clickHandler);$('.relatedJournalList .journalName').click(relatedJournalList.clickHandler);}}};var signupConfirm={init:function(){var currentStep=1;var totalSteps=$('.js-signupConfirm-step').length;var startingProgress=30;if($('.js-signupConfirm').length>0||$('.js-signupConfirm-signupForm').length>0){relatedJournalList.activate();if($('.recommendedArticlesList').length>0){MLT.getRelatedArticles($('.recommendedArticlesList'),'simpleBookmark');}
$('.js-signupConfirm-nextBtn').click(function(e){e.preventDefault();window.scrollTo(0,0);$('.js-signupConfirm .panel-header').hide();if(currentStep===(totalSteps-1)){$('.js-signupConfirm-nextBtn-section').hide();$('.js-signupConfirm-finishBtn, .js-signupForm-lastStep').show();$('.js-signupConfirm-step-'+currentStep).addClass('animated bounceOutLeft');}
$('.js-signupConfirm-step').addClass('animated bounceOutLeft').hide();$('.js-signupConfirm-progress .bar').css('width',((100-startingProgress)*(currentStep+1)/totalSteps+startingProgress)+'%');currentStep++;$('.js-signupConfirm-step-'+currentStep).show().removeClass('bounceOutLeft').addClass('animated bounceInRight');trackEvent('signup-steps','next',currentStep,false);});signupConfirm.initReadLater();}},initReadLater:function(){var permId='WysKb9YCPo';var title='How to Read a Paper';$.ajax({type:'POST',url:'/editsaved',dataType:'json',data:'cmd=adddoc&id='+permId,beforeSend:function(){},complete:function(){},success:function(response){if(response.success===true){trackEvent('bookmark','add',permId,false);_cio.track("Bookmarked-article",{permid:permId,articletitle:title});_cio.track("Bookmarked-article-howToReadIntro");}}});}};var ccUtilities={setupCCForm:function(){$('#account').on('keypress',function(){var cctype=ccUtilities.getCardType($('#account').val());$('.credit-card-icon').attr('id',cctype);if(cctype==='amex'){$('#account').attr('maxlength','15');$('#cvv2pro').attr('maxlength','4');}else if(cctype==='mastercard'){$('#account').attr('maxlength','16');$('#cvv2pro').attr('maxlength','3');}else{$('#account').attr('maxlength','16');$('#cvv2pro').attr('maxlength','3');}});return $('#signup, #verifyForm, #ccUpdate').validate({groups:{expiration:"expirationMonth expirationYear"},rules:{email:{required:true,email:true},confirmemail:{equalTo:'#email',required:true,email:true},newpassword:{minlength:6,required:true},account:{creditcard:true,minlength:15,required:true},cvv2:{digits:true,required:true,minlength:3},confirmCheckbox:{required:true},expirationMonth:{required:true,min:{param:new Date().getMonth(),depends:function(el){return parseInt($('#expirationYear').val())<=new Date().getFullYear();},},},expirationYear:{required:true,min:{param:new Date().getFullYear(),depends:function(el){return parseInt($('#expirationMonth').val())<=new Date().getMonth();},},},},messages:{confirmemail:{equalTo:'Make sure you typed your email correctly.'},cvv2:{minlength:'Please enter at least 3 digits.'},expirationMonth:{min:'Please enter an expiration date in the future.',},expirationYear:{min:'Please enter an expiration date in the future.',},},errorPlacement:function(error,element){error.appendTo(element.closest('.control-group').find('.help-block, .help-inline'));element.closest('.control-group').find('.help-block, .help-inline').removeClass('hide');element.closest('.control-group').addClass('error').removeClass('success');},highlight:function(label){$(label).closest('.control-group').addClass('error').removeClass('success');},success:function(label){$(label).closest('.control-group').addClass('success').removeClass('error');},invalidHandler:function(event,validator){window.setTimeout(function(){$('#signup .btn').button('reset');},50);}});},getCardType:function(cardNumber){var types,i;types={};for(i=40;i<=49;i++){types[i]='visa';}
for(i=50;i<=59;i++){types[i]='mastercard';}
types[34]=types[37]='amex';types[60]=types[62]=types[64]=types[65]='discover';types[35]='jcb';types[30]=types[36]=types[38]=types[39]='diners';return types[cardNumber.slice(0,2)]||null;}};var directory={setup:function(){if($('.contentSideNarrow').length>0){directory.adjustDirectoryMenuHeight();$(window).resize(function(){directory.adjustDirectoryMenuHeight();});}},adjustDirectoryMenuHeight:function(){if($('.contentSideNarrow').height()<$('.contentMainWide').height()){$('.contentSideNarrow').height($('.contentMainWide').height()+20);}},applySmoothScrolling:function(){$('.directoryAnchors a, .backTop a').click(function(e){e.preventDefault();$.scrollTo('a[name='+$(this).attr('href').substr(1)+']',500);});}};var searchTypeToggle={setup:function(){$('#searchTypeToggle a').click(function(e){e.preventDefault();var searchType=$(this).attr('href').substr(1);$('#searchTypeField').val(searchType);$('#advancedSearchForm').submit();});}};var contentMenu={setup:function(){$('#featuredContent .hide').removeClass('hide').hide();$('#featuredContent #featuredSubjects ul li a').click(function(e){e.preventDefault();$(this).parent('li').siblings('.selected').removeClass('selected');$(this).parent('li').addClass('selected');var activeID=$(this).attr('href').substr(1);var subActiveID=$('#'+activeID).find('.selected a').attr('href').substr(1);contentMenu.showArticles(subActiveID);$('#featuredJournals ul').hide();$('#'+activeID).fadeIn();});$('#featuredContent #featuredJournals ul li a').click(function(e){e.preventDefault();$(this).parent('li').siblings('.selected').removeClass('selected');$(this).parent('li').addClass('selected');contentMenu.showArticles($(this).attr('href').substr(1));});},showArticles:function(articlesDiv){$('#featuredArticles div').hide();$('#'+articlesDiv).fadeIn();}};var featuredContent={pos:0,paneWidth:700,panes:5,interval:'',setup:function(){if($('#featuredJournals').length>0){if($('#featuredJournals .scrollerMeta').length>0){featuredContent.paneWidth=parseInt($('#featuredJournals .scrollerMeta').attr('title').split('x')[0]);featuredContent.panes=parseInt($('#featuredJournals .scrollerMeta').attr('title').split('x')[1]);}
$('#featuredJournals ul').css('width',featuredContent.paneWidth*featuredContent.panes+'px');featuredContent.updateControls();$('#featuredJournals .scrollPrev a').click(function(e){e.preventDefault();featuredContent.adjustPos('-');});$('#featuredJournals .scrollNext a').click(function(e){e.preventDefault();featuredContent.adjustPos('+');});}},autoRotate:function(){if(featuredContent.pos>=featuredContent.paneWidth*(featuredContent.panes-1)){featuredContent.pos=0;featuredContent.updateControls();featuredContent.scrollPane('0px');}else{featuredContent.adjustPos('+');}},adjustPos:function(direction){if(direction==='-')featuredContent.pos-=featuredContent.paneWidth;else featuredContent.pos+=featuredContent.paneWidth;featuredContent.updateControls();featuredContent.scrollPane(direction+'='+featuredContent.paneWidth+'px');},scrollPane:function(position){$('#featuredJournals .scrollerPane').scrollTo(position,featuredContent.paneWidth,{axis:'x',easing:'easeOutQuad'});},updateControls:function(){if(featuredContent.pos<=0){$('#featuredJournals .scrollPrev a').fadeOut(200);featuredContent.pos=0;}else{$('#featuredJournals .scrollPrev a').fadeIn(400);}
if(featuredContent.pos>=featuredContent.paneWidth*(featuredContent.panes-1)){$('#featuredJournals .scrollNext a').fadeOut(200);featuredContent.pos=featuredContent.paneWidth*(featuredContent.panes-1);}else{$('#featuredJournals .scrollNext a').fadeIn(400);}}};var accountProgress={init:function(){$('#accountProgress').popover({html:true,title:function(){return $('#accountProgressPopoverTitle').html();},content:function(){return $('#accountProgressPopoverContent').html();},trigger:'manual',placement:'bottom'}).mouseenter(function(e){if(!$('#userDropdown').is(':visible')&&!$('#userLinksDiv .popover').is(':visible')){$(this).popover('show');}});$(document).click(function(){$('#accountProgress').popover('hide');});$('.aspLink').click(function(e){e.preventDefault();var id=$(this).attr('id');var target=id.replace('aspLink','asp');accountProgress.toggleInstructions($('#'+target));});},toggleInstructions:function(target){var iconElement=$('.aspLink .aspToggle',target);$('.aspInstructions',target).slideToggle();if(iconElement.hasClass('collapsed')){$.scrollTo(target,500);}else if(iconElement.hasClass('expanded')){}
iconElement.toggleClass('collapsed icon-chevron-right expanded icon-chevron-down');return false;},expandInstructions:function(target){if(!$('.aspInstructions',target).is(':visible')){accountProgress.toggleInstructions(target);}
$.scrollTo(target,500);}};var accountSettings={init:function(){if($('#accountForm').length>0){$('#accountForm :input').change(accountSettings.enableAccountForm);$('#accountForm :input').click(accountSettings.enableAccountForm);$('.js-gravatar-tooltip').tooltip();}},enableAccountForm:function(){$('#accountForm .cancel').show();$('#accountForm .submit').removeAttr('disabled').removeClass('disabled').click(function(){$(this).button('loading');});}};var homeNav={init:function(){if($('.homeNav').length>0){$('.js-homeNavToggle').click(function(e){e.preventDefault();homeNav.toggle(e);});$('.homeNav .js-tooltip').tooltip();$('.js-open-next').on('click',function(event){event.preventDefault();var $this=$(this);$('.js-open-next').each(function(e){var $$this=$(this);if($$this.is($this)){return;}
$$this.next().slideUp("normal","linear",function(el){});$$this.find('.icon-chevron-down.animateme').addClass('rotate90');});var nextSib=$this.next();nextSib.slideToggle("normal","linear",function(el){});$this.find('.icon-chevron-down.animateme').toggleClass('rotate90');});}},};var docTools={init:function(){docTools.setupAuthors($('.doc .additionalAuthors'));},setupAuthors:function(authors){authors.each(function(){var additionalAuthors=$(this);additionalAuthors.addClass('hide');$('<a href="#" class="moreAuthors">... [+]</a>').insertAfter(additionalAuthors).click(function(e){e.preventDefault();additionalAuthors.removeClass('hide');$(this).addClass('hide');});});}};var loginPage={init:function(){if($('form#login').length>0){$('form#login').submit(function(){$('form#login .btn-primary').button('loading');});}}};var saveNumPerPage={init:function(){if($('#numPerPage').length>0){$('#numPerPage').on('change',saveNumPerPage._save);}},_save:function(event){var num=$('#numPerPage').find(":selected").text();$.cookie('numPerPage',num,{path:'/'});}}
var onboarding={init:function(){var isBigEnough=$(window).width()>767;var showPluginInterrupt=$.cookie("showPluginInterrupt")==1;var installedPluginVersion=$.cookie("pv")===null?0:$.cookie("pv");var showWhichNext=$('#searchOrganizeAccessBoxes').length?"plugin":"boxes";if(isBigEnough&&showPluginInterrupt&&installedPluginVersion===0){$('#bsPluginPromoInterruptModal').modal({show:true});$.cookie("showPluginInterrupt","0",{path:"/"});}
$.cookie("pluginOrBoxes",showWhichNext,{path:"/"});var featureTipBoxSearch=$(".three-box-featureTip--Search");var featureTipBoxOrganize=$(".three-box-featureTip--Organize");var featureTipBoxAccess=$(".three-box-featureTip--Access");if(featureTipBoxSearch.length){$("#featureTipInterruptSearch").modal({show:false});featureTipBoxSearch.on("click",function(event){$("#featureTipInterruptSearch").modal("show");});}
if(featureTipBoxOrganize.length){$("#featureTipInterruptOrganize").modal({show:false});featureTipBoxOrganize.on("click",function(event){$("#featureTipInterruptOrganize").modal("show");});}
if(featureTipBoxAccess.length){$("#featureTipInterruptAccess").modal({show:false});featureTipBoxAccess.on("click",function(event){$("#featureTipInterruptAccess").modal("show");});}}};var fullTextShare={init:function(){if($(".share_full_text").length===0){return false}
fullTextShare.validator();$("#fullTextShareButton").on('click',function(){$("#bsFullTextShareModal").modal("show");});},validator:function(){fullTextShare.validator=$("#bsFullTextShareModal form").validate({rules:{fullTextShare_0:{minlength:4,email:true,required:true,},fullTextShare_1:{minlength:4,email:true,},fullTextShare_2:{minlength:4,email:true,},fullTextShare_3:{minlength:4,email:true,},fullTextShare_4:{minlength:4,email:true,},fullTextShare_msg:{},},submitHandler:fullTextShare.submitFn,})},submitFn:function(form,event){event.preventDefault();var recipients=[];var msg="";var permId="";$('input.fullTextShare').each(function(idx,el){var val=$(el).val().trim();if(val){recipients.push(val);}});recipients=$.unique(recipients);msg=$('textarea.fullTextShare_msg').val()||undefined;permId=$("#doc_meta_data").metadata().perm_id;$('#removeSearchAlertModalButton').button('loading');$.ajax({url:'/use-article-shares',type:'POST',accepts:'application/json',dataType:'json',data:{permId:permId,recipients:recipients,msg:msg,},success:function(data){if(data.success){$("#bsFullTextShareModal").modal('hide');$("#bsFullTextShareModalSuccess").modal('show');$("#bsFullTextShareModalSuccess").modal('show');$('.shareUrl').text(data.shareUrl)}else{$("#bsFullTextShareModal").modal('hide');$("#bsFullTextShareModalError").modal('show');$('#bsFullTextShareModal .shareUrl').toggleClass('hidden');$('#bsFullTextShareModal .error').text("We encountered an error generating your shareable url. Please try again later.");}},error:function(){$("#bsFullTextShareModal").modal('hide');$("#bsFullTextShareModalError").modal('show');$('#bsFullTextShareModal .shareUrl').toggleClass('hidden');$('#bsFullTextShareModal .error').text("We encountered an error generating your shareable url. Please try again later.");},complete:function(){$('#removeSearchAlertModalButton').button('reset');$("#bsFullTextShareModal form").get(0).reset();}});},}
$(document).ready(function(){homeNav.init();setupSearch.searchForm($('#mainSearch'));setupSearch.advancedSearchForm($('#advancedSearchForm'));setupSearch.sidebarFilters();saveNumPerPage.init();advancedSearch.setupAdvancedFilters($('#queryField'));emailAlerts.setup();resultButtons.setup();$('select.selectLinks').selectLinks();fbUser.init();googleUser.init();googleAnalytics.init();docTools.init();$('.js-journalName').tooltip({placement:'bottom',container:'body',html:true,});dateHandler.setupDatePicker();directory.setup();signupModalActions.setup();ddxSignupActions.setup();$('.toggle').toggleContent();searchTypeToggle.setup();accountSettings.init();professionalSignupForm.init();signupConfirm.init();$('.tipTrigger').tipBubble();$('.smoothAnchor').smoothAnchor();if($('#newUserHeroIntroDocBG').length>0){$('#newUserHeroIntroDocBG').height($(document).height()-$('.newUserHeroIntro').height());}
if($('#testimonialCarousel').length>0){$('#testimonialCarousel').carousel({'interval':7000});$('#testimonialCarousel').carousel('cycle');}
if($('#pubLogos').length>0){$('#pubLogos').carousel({'interval':5000});$('#pubLogos').carousel('cycle');}
if($('#featuredJournalsCarousel').length>0){$('#featuredJournalsCarousel').carousel({'interval':5000});$('#featuredJournalsCarousel').carousel('cycle');}
if($('#docViewer').length>0&&$('#impression_id').length>0){var params=$('#impression_id').metadata();rentalActions.setup();window.setInterval(function(){logEvent({'event_name':'doc_view_interval','async':true,'impression_id':params.impression_id,'perm_id':params.perm_id});},30000);var paramsDataSource=$('#doc_meta_data').metadata().dataSource;var paramsPrice=$('#doc_meta_data').metadata().price;var paramsPerm_id=$('#doc_meta_data').metadata().perm_id;var paramsCurrentlyRenting=$('#doc_meta_data').metadata().currentlyRenting;var paramsTitle=$('#doc_meta_data').metadata().title;var paramsJournal=$('#doc_meta_data').metadata().journal;var rentalState=$('#next-page-event-data').metadata().internal_rental_state;var paramsReferrer=$('#doc_meta_data').metadata().referrer;var paramsRentalLinkReferrer=$('#doc_meta_data').metadata().rentalLinkReferrer;}
$('#planSelection form').each(function(){var form=$(this);form.find('.submitButton').click(function(e){e.preventDefault();form.submit();});});fullTextShare.init();accountProgress.init();onboarding.init();$('a[rel*=external], a[rel*=blank]').attr('target','_blank');if($('.downloadUrl').length>0){window.setTimeout(function(){$('.downloadUrl').click(function(e){e.preventDefault();$('#bsDownloadUrlRefreshModal').modal('show');});},1000*60*30);}
$('.js-featureTip .close a, .featureTip .close a, .systemMessage .close a, .featureTip a.close-btn, .dd-tooltip a.js-hideTooltip').click(function(e){e.preventDefault();$.cookie($(this).attr('href').substr(1),true,{expires:999,path:'/'});$(this).parents('.js-featureTip, .featureTip, .systemMessage, .dd-tooltip').toggle(600);});if($('.dd-startBySearching-tip').length){$.cookie('showStartBySearching','false',{path:'/',expires:-5});$('.navbar__search.queryField').on('focus',function(){$('.dd-startBySearching-tip').hide(600);});}
if($('.js-saved-searches-homeNav').data('showonboardingtip')){$('.js-saved-searches-homeNav').popover({container:'body',placement:'right',html:true,delay:0,content:'<p><strong>New saved searches!</strong></p>'+'<p>Check out your latest saved searches.</p>'}).popover('show');$.cookie('showHasNewSavedSearches',false);}
journalFollow.init();$("#resultPage").click(logClick);$('.SwitchToAnnual').click(function(){_cio.track('Clicked-annual-button');});$('#bsSwitchToAnnualModal .btn-primary').click(function(){$(this).button('loading');});$('#shareTT, #shareFB, #shareEmail').click(function(){_cio.track('Clicked-share');});$('#removeAccount').click(function(e){$(this).button('loading');$.ajax({url:'/remove-account',async:false,type:'GET',complete:function(r){FB.getLoginStatus(function(response){if(response.status==='connected'){FB.api("/me/permissions","DELETE",function(response){_cio.track('Removed-account');location.href='http://'+location.host+'/home';});}else{_cio.track('Removed-account');location.href='http://'+location.host+'/home';}},true);}});return false;});$('#removeCCInfo').click(function(e){$(this).button('loading');$.ajax({url:'/remove-cc-info',async:false,type:'GET',complete:function(r){_cio.track('Removed-ccinfo');location.reload(true);}});return false;});loginPage.init();homepage.init();ddxRegistrationFlow.init();});$(window).load(function(){$.getScript("/assets/scripts/ui.deferred.js");});